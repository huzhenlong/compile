!function(e,t,o,a){var n,r={id:"parentId",iClass:"fa-users",isReadOnly:!0,index:0},i={id:"vertical-timeline-last",iClass:"fa-user",isReadOnly:!0,selectAble:!1},s=function(t){var o=this;return o.defaults={modalId:"smartGroupModal",modalTitle:TxtContent.smartGroup,modalWrapId:"smartGroupModalWrap",tableId:"sgTable",modalSaveId:"smartGroupModalSaveId",modalOkId:"smartGroupModalOkId",modalCancelId:"smartGroupModalCancelId",modalSave:TxtContent.save,modalOk:TxtContent.confirm,modalCancel:TxtContent.cancel,scene:"modal",extendData:{selectAble:!0,selected:!1,parentId:""},func:function(e,a){e.append("parentId",o.getParentId()),XREWIN.loadingType="toast",SMARTGROUP.addSmartGroupNode(e,function(){XREWIN.loadingType="";var e=this.data.split(",");"1"==e.code,a.count=e[1],a.id=e[0],n.row.add(a).draw(),(new s).smartGroupModalSave(t.groupKey)})}},o.options=e.extend({},o.defaults,t),o.init()};s.prototype={init:function(){var t=this,o=e("body").find("#"+t.options.modalId);if(t.options.$obj){var a=t.options.$obj.find("#"+t.options.modalWrapId+t.options.groupKey);return 0==a.length&&t.options.showForm&&"flat"==t.options.showForm&&(t.buildFlat(),t.loadSmartGroupModal()),t}return 0==o.length&&(t.buildModal(),t.tabClosePop()),t},buildFlat:function(){var e=this,t=e.options.$obj.append(e.modalBody()),o=t.find("#"+e.options.modalWrapId+e.options.groupKey);o.smartGroupFilter({scene:e.options.scene,func:e.options.func,groupKey:e.options.groupKey}),o.append(e.createDataTable()),e.addTableData()},tabClosePop:function(){var t;e(".sg-tabs-container .nav li").on("click",function(){var o=e(this).index();t&&t!=o&&e("body").smartGroupFilter().closePopFun(),t=o})},loadSmartGroupModal:function(){var e=this;SMARTGROUP.getSmartGroup({data:e.options.groupKey},function(){var e,t=JSON.parse(this.data.content),o=[];if(t){r=t.shift(),i=t.pop();for(var a=0;a<t.length;a++){var s=t[a].childrenItem;if(s&&s.length>0){e=s.length-1;for(var l=0;l<s.length;l++)s[l].count=0==l?t[a].count:s[l].count,s[l].index=t[a].index+l,o.push(s[l]);a++}t[a].index=e?t[a].index+e:t[a].index,o.push(t[a])}}n&&n.rows.add(o).draw()})},show:function(){var t=this;e("#"+t.options.modalId).modal("show"),t.loadSmartGroupModal()},hide:function(){var t=this;e("#"+t.options.modalId).modal("hide"),n.clear().draw()},buildModal:function(){var t=this,o=e(t.modalWrap()),a=o.find(".modal-content");a.append(t.modalHeader()),a.append(t.modalBody()),a.append(t.modalBtn());var n=e("body").append(o),r=n.find("#"+t.options.modalWrapId+t.options.groupKey);r.empty(),r.smartGroupFilter({scene:t.options.scene,func:t.options.func,groupKey:t.options.groupKey}),r.append(t.createDataTable()),t.addTableData(),n.find("#"+t.options.modalOkId).on("click",function(){t.smartGroupModalOk()}),n.find("#"+t.options.modalCancelId).on("click",function(){t.hide(),t.options.btnCancelModalHide&&t.options.btnCancelModalHide.modal("show")})},modalWrap:function(){var e=this;return'<div class="modal" id="'+e.options.modalId+'" role="dialog" aria-hidden="true"><div class="modal-dialog"><div class="modal-content sg-content"></div></div></div>'},modalHeader:function(){var e=this;return'<div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">'+e.options.modalTitle+"</h4></div>"},modalBody:function(){var e=this;return'<div class="modal-body sg-modal-body"><div class="clearfix" id="'+e.options.modalWrapId+e.options.groupKey+'"></div></div>'},modalBtn:function(){var e=this;return'<div class="modal-footer"><button id="'+e.options.modalOkId+'" class="btn btn-info">'+e.options.modalOk+'</button><button id="'+e.options.modalCancelId+'" class="btn btn-default" data-dismiss="modal">'+e.options.modalCancel+"</button></div>"},createDataTable:function(){var e=this;return'<table class="table row-bordered table-hover" id="'+e.options.tableId+e.options.groupKey+'"></table>'},smartGroupModalSave:function(t){var o=this,a=n.data(),s=[r];if(a){var l=a.length;i.index=l+1;for(var d=0;l>d;d++){var c=e.extend(a[d],o.options.extendData,{index:d+1});s.push(c)}s.push(i)}SMARTGROUP.updateSmartGroup({content:JSON.stringify(s),key:t})},smartGroupModalOk:function(){var e=this;"function"==typeof e.options.modalOkFunc&&e.options.modalOkFunc(),e.smartGroupModalSave(e.options.groupKey),e.hide()},addTableData:function(){var t=this;n=e("#"+t.options.tableId+t.options.groupKey).DataTable({stateSave:!0,aLengthMenu:[5,10],iDeferLoading:5,searching:!1,ordering:!1,tableTools:{sSwfPath:"js/plugins/dataTables/swf/copy_csv_xls_pdf.swf"},language:{url:"/localisation/dataTables/zh-cn.json"},columns:[{title:"类型",data:"iClass",render:function(e,t,o,a){return'<i class="fa '+e+'"></i>'}},{title:"条件",data:"text"},{title:"数量",data:"count"},{title:"操作",data:"id",render:function(e,t,o,a){return'<button class="btn btn-white btn-xs" name="btnDelOp" data-id="'+e+'" title="删除" ><i class="fa fa-trash"></i></button>'}}]}),n.on("draw.dt",function(o,a,r,i){e(this).find("button[name=btnDelOp]").off().on("click",function(){var o=e(this);swal({title:TxtContent.isDel,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:TxtContent.confirm,cancelButtonText:TxtContent.cancel},function(){SMARTGROUP.delSmartGroupNode({data:o.data("id")},function(){n.row(o.parents("tr")).remove().draw(),(new s).smartGroupModalSave(t.options.groupKey)})})})})},getParentId:function(){var e="",t=n.data(),o=t.length;return e=t&&o>0?t[o-1].id:"parentId"}},e.fn.smartGroupModal=function(e){var t=this,o=new s(e);return t.on("click",function(){o.show()}),t},t.SGTableModal||(t.SGTableModal=s)}(jQuery,window,document),function(e,t,o){"object"==typeof module&&"object"==typeof module.exports?module.exports=function(e,t){return o(e,t)}:o(e,t)}("undefined"!=typeof window?window.jQuery:{},"undefined"!=typeof window?window:this,function(e,t){function o(e){var t,o=this;for(t in e)e.hasOwnProperty(t)&&(o[t]=e[t]);return o}function a(){ke(this,a.baseDefaults)}function n(e){return"string"===Te(e)}function r(e){return!isNaN(he(e))&&!isNaN(we(e))}function i(e){return e&&e.getContext?e.getContext("2d"):ve}function s(e){var t,o,a;for(t in e)e.hasOwnProperty(t)&&(a=e[t],o=Te(a),"string"===o&&r(a)&&"text"!==t&&(e[t]=we(a)));void 0!==e.text&&(e.text=String(e.text))}function l(e){return e=ke({},e),e.masks=e.masks.slice(0),e}function d(e,t){var o;e.save(),o=l(t.transforms),t.savedTransforms.push(o)}function c(e,t){0===t.savedTransforms.length?t.transforms=l(Ge):(e.restore(),t.transforms=t.savedTransforms.pop())}function u(e,t,o,a){o[a]&&(Ce(o[a])?t[a]=o[a].call(e,o):t[a]=o[a])}function p(e,t,o){u(e,t,o,"fillStyle"),u(e,t,o,"strokeStyle"),t.lineWidth=o.strokeWidth,o.rounded?t.lineCap=t.lineJoin="round":(t.lineCap=o.strokeCap,t.lineJoin=o.strokeJoin,t.miterLimit=o.miterLimit),o.strokeDash||(o.strokeDash=[]),t.setLineDash&&t.setLineDash(o.strokeDash),t.webkitLineDash=t.mozDash=o.strokeDash,t.lineDashOffset=t.webkitLineDashOffset=t.mozDashOffset=o.strokeDashOffset,t.shadowOffsetX=o.shadowX,t.shadowOffsetY=o.shadowY,t.shadowBlur=o.shadowBlur,t.shadowColor=o.shadowColor,t.globalAlpha=o.opacity,t.globalCompositeOperation=o.compositing,o.imageSmoothing&&(t.imageSmoothingEnabled=t.mozImageSmoothingEnabled=o.imageSmoothingEnabled)}function m(e,t,o){o.mask&&(o.autosave&&d(e,t),e.clip(),t.transforms.masks.push(o._args))}function f(e,t){t._transformed&&e.restore()}function h(e,t,o){var a;o.closed&&t.closePath(),o.shadowStroke&&0!==o.strokeWidth?(t.stroke(),t.fill(),t.shadowColor="transparent",t.shadowBlur=0,t.stroke()):(t.fill(),"transparent"!==o.fillStyle&&(t.shadowColor="transparent"),0!==o.strokeWidth&&t.stroke()),o.closed||t.closePath(),f(t,o),o.mask&&(a=g(e),m(t,a,o))}function w(e,t,o,a,n){o._toRad=o.inDegrees?Fe/180:1,o._transformed=ge,t.save(),o.fromCenter||o._centered||a===xe||(n===xe&&(n=a),o.x+=a/2,o.y+=n/2,o._centered=ge),o.rotate&&X(t,o,ve),1===o.scale&&1===o.scaleX&&1===o.scaleY||Y(t,o,ve),(o.translate||o.translateX||o.translateY)&&H(t,o,ve)}function g(t){var o,a=Ae.dataCache;return a._canvas===t&&a._data?o=a._data:(o=e.data(t,"jCanvas"),o||(o={canvas:t,layers:[],layer:{names:{},groups:{}},eventHooks:{},intersecting:[],lastIntersected:ve,cursor:e(t).css("cursor"),drag:{layer:ve,dragging:ye},event:{type:ve,x:ve,y:ve},events:{},transforms:l(Ge),savedTransforms:[],animating:ye,animated:ve,pixelRatio:1,scaled:ye},e.data(t,"jCanvas",o)),a._canvas=t,a._data=o),o}function y(e,t,o){var a;for(a in De.events)De.events.hasOwnProperty(a)&&(o[a]||o.cursors&&o.cursors[a])&&v(e,t,o,a);t.events.mouseout||(e.bind("mouseout.jCanvas",function(){var o,a=t.drag.layer;for(a&&(t.drag={},_(e,t,a,"dragcancel")),o=0;o<t.layers.length;o+=1)a=t.layers[o],a._hovered&&e.triggerLayerEvent(t.layers[o],"mouseout");e.drawLayers()}),t.events.mouseout=ge)}function v(e,t,o,a){De.events[a](e,t),o._event=ge}function x(e,t,o){var a,n,r;if(o.draggable||o.cursors){for(a=["mousedown","mousemove","mouseup"],r=0;r<a.length;r+=1)n=a[r],v(e,t,o,n);o._event=ge}}function k(e,t,o,a){var r=t.layer.names;a?a.name!==xe&&n(o.name)&&o.name!==a.name&&delete r[o.name]:a=o,n(a.name)&&(r[a.name]=o)}function b(e,t,o,a){var n,r,i,s,l,d=t.layer.groups;if(a){if(a.groups!==xe&&o.groups!==ve)for(i=0;i<o.groups.length;i+=1)if(r=o.groups[i],n=d[r]){for(l=0;l<n.length;l+=1)if(n[l]===o){s=l,n.splice(l,1);break}0===n.length&&delete d[r]}}else a=o;if(a.groups!==xe&&a.groups!==ve)for(i=0;i<a.groups.length;i+=1)r=a.groups[i],n=d[r],n||(n=d[r]=[],n.name=r),s===xe&&(s=n.length),n.splice(s,0,o)}function T(e){var t,o,a,n;for(t=ve,o=e.intersecting.length-1;o>=0;o-=1)if(t=e.intersecting[o],t._masks){for(n=t._masks.length-1;n>=0;n-=1)if(a=t._masks[n],!a.intersects){t.intersects=ye;break}if(t.intersects&&!t.intangible)break}return t&&t.intangible&&(t=ve),t}function C(e,t,o,a){o&&o.visible&&o._method&&(a?o._next=a:o._next=ve,o._method.call(e,o))}function N(e,t,o){var a,n,r,i,s,l,d,c,u,p;if(i=t.drag,n=i.layer,s=n&&n.dragGroups||[],a=t.layers,"mousemove"===o||"touchmove"===o){if(i.dragging||(i.dragging=ge,n.dragging=ge,n.bringToFront&&(a.splice(n.index,1),n.index=a.push(n)),n._startX=n.x,n._startY=n.y,n._endX=n._eventX,n._endY=n._eventY,_(e,t,n,"dragstart")),i.dragging)for(u=n._eventX-(n._endX-n._startX),p=n._eventY-(n._endY-n._startY),n.dx=u-n.x,n.dy=p-n.y,"y"!==n.restrictDragToAxis&&(n.x=u),"x"!==n.restrictDragToAxis&&(n.y=p),_(e,t,n,"drag"),c=0;c<s.length;c+=1)if(d=s[c],l=t.layer.groups[d],n.groups&&l)for(r=0;r<l.length;r+=1)l[r]!==n&&("y"!==n.restrictDragToAxis&&"y"!==l[r].restrictDragToAxis&&(l[r].x+=n.dx),"x"!==n.restrictDragToAxis&&"x"!==l[r].restrictDragToAxis&&(l[r].y+=n.dy))}else"mouseup"!==o&&"touchend"!==o||(i.dragging&&(n.dragging=ye,i.dragging=ye,_(e,t,n,"dragstop")),t.drag={})}function F(t,o,a){var n;o.cursors&&(n=o.cursors[a]),-1!==e.inArray(n,We.cursors)&&(n=We.prefix+n),n&&t.css({cursor:n})}function L(e,t){e.css({cursor:t.cursor})}function O(e,t,o,a,n){a[o]&&t._running&&!t._running[o]&&(t._running[o]=ge,a[o].call(e[0],t,n),t._running[o]=ye)}function S(t,o){return!(t.disableEvents||t.intangible&&-1!==e.inArray(o,Ee))}function _(e,t,o,a,n){S(o,a)&&("mouseout"!==a&&F(e,o,a),O(e,o,a,o,n),O(e,o,a,t.eventHooks,n),O(e,o,a,De.eventHooks,n))}function M(t,a,r,i){var l,d,c,u=a._layer?r:a;return a._args=r,(a.draggable||a.dragGroups)&&(a.layer=ge,a.draggable=ge),a._method||(i?a._method=i:a.method?a._method=e.fn[a.method]:a.type?a._method=e.fn[Pe.drawings[a.type]]:a._method=function(){}),a.layer&&!a._layer?(l=e(t),d=g(t),c=d.layers,(u.name===ve||n(u.name)&&d.layer.names[u.name]===xe)&&(s(a),u=new o(a),u.canvas=t,u.layer=ge,u._layer=ge,u._running={},u.data!==ve?u.data=ke({},u.data):u.data={},u.groups!==ve?u.groups=u.groups.slice(0):u.groups=[],k(l,d,u),b(l,d,u),y(l,d,u),x(l,d,u),a._event=u._event,u._method===e.fn.drawText&&l.measureText(u),u.index===ve&&(u.index=c.length),c.splice(u.index,0,u),a._args=u,_(l,d,u,"add"))):a.layer||s(a),u}function I(e){var t,o;for(o=0;o<We.props.length;o+=1)t=We.props[o],e[t]=e["_"+t]}function R(e,t){var o,a;for(a=0;a<We.props.length;a+=1)o=We.props[a],e[o]!==xe&&(e["_"+o]=e[o],We.propsObj[o]=ge,t&&delete e[o])}function P(e,t,o){var a,n,r,i;for(a in o)if(o.hasOwnProperty(a)&&(n=o[a],Ce(n)&&(o[a]=n.call(e,t,a)),"object"===Te(n)&&Ne(n))){for(r in n)n.hasOwnProperty(r)&&(i=n[r],t[a]!==xe&&(t[a+"."+r]=t[a][r],o[a+"."+r]=i));delete o[a]}return o}function A(e){var t;for(t in e)e.hasOwnProperty(t)&&-1!==t.indexOf(".")&&delete e[t]}function G(t){var o,a,n=[],r=1;return t.match(/^([a-z]+|#[0-9a-f]+)$/gi)&&("transparent"===t&&(t="rgba(0, 0, 0, 0)"),a=ce.head,o=a.style.color,a.style.color=t,t=e.css(a,"color"),a.style.color=o),t.match(/^rgb/gi)&&(n=t.match(/(\d+(\.\d+)?)/gi),t.match(/%/gi)&&(r=2.55),n[0]*=r,n[1]*=r,n[2]*=r,n[3]!==xe?n[3]=we(n[3]):n[3]=1),n}function W(e){var t,o=3;for("array"!==Te(e.start)&&(e.start=G(e.start),e.end=G(e.end)),e.now=[],1===e.start[3]&&1===e.end[3]||(o=4),t=0;o>t;t+=1)e.now[t]=e.start[t]+(e.end[t]-e.start[t])*e.pos,3>t&&(e.now[t]=Le(e.now[t]));1!==e.start[3]||1!==e.end[3]?e.now="rgba( "+e.now.join(",")+" )":(e.now.slice(0,3),e.now="rgb( "+e.now.join(",")+" )"),e.elem.nodeName?e.elem.style[e.prop]=e.now:e.elem[e.prop]=e.now}function E(t){var o;for(o=0;o<t.length;o+=1)e.fx.step[t[o]]=W}function D(e){return Pe.touchEvents[e]&&(e=Pe.touchEvents[e]),e}function j(e){return Pe.mouseEvents[e]&&(e=Pe.mouseEvents[e]),e}function z(e){De.events[e]=function(t,o){function a(e){i.x=e.offsetX,i.y=e.offsetY,i.type=n,i.event=e,t.drawLayers({resetFire:ge}),e.preventDefault()}var n,r,i;i=o.event,n="mouseover"===e||"mouseout"===e?"mousemove":e,r=D(n),o.events[n]||(r!==n?t.bind(n+".jCanvas "+r+".jCanvas",a):t.bind(n+".jCanvas",a),o.events[n]=ge)}}function $(e){var t;for(t=0;t<e.length;t+=1)z(e[t])}function B(e,t,o){var a,n,r,i,s,l,d,c;a=o._args,a&&(n=g(e),r=n.event,r.x!==ve&&r.y!==ve&&(l=r.x*n.pixelRatio,d=r.y*n.pixelRatio,i=t.isPointInPath(l,d)||t.isPointInStroke&&t.isPointInStroke(l,d)),s=n.transforms,a.eventX=r.x,a.eventY=r.y,a.event=r.event,c=n.transforms.rotate,l=a.eventX,d=a.eventY,0!==c?(a._eventX=l*_e(-c)-d*Se(-c),a._eventY=d*_e(-c)+l*Se(-c)):(a._eventX=l,a._eventY=d),a._eventX/=s.scaleX,a._eventY/=s.scaleY,i&&n.intersecting.push(a),a.intersects=!!i)}function X(e,t,o){t._toRad=t.inDegrees?Fe/180:1,e.translate(t.x,t.y),e.rotate(t.rotate*t._toRad),e.translate(-t.x,-t.y),o&&(o.rotate+=t.rotate*t._toRad)}function Y(e,t,o){1!==t.scale&&(t.scaleX=t.scaleY=t.scale),e.translate(t.x,t.y),e.scale(t.scaleX,t.scaleY),e.translate(-t.x,-t.y),o&&(o.scaleX*=t.scaleX,o.scaleY*=t.scaleY)}function H(e,t,o){t.translate&&(t.translateX=t.translateY=t.translate),e.translate(t.translateX,t.translateY),o&&(o.translateX+=t.translateX,o.translateY+=t.translateY)}function V(e){for(;0>e;)e+=2*Fe;return e}function q(e,t){return e.x+e.radius*_e(t)}function K(e,t){return e.y+e.radius*Se(t)}function U(e,t,o,a){var n,r,i,s,l,d,c,u,p,m,f;o===a?(p=0,m=0):(p=o.x,m=o.y),a.inDegrees||360!==a.end||(a.end=2*Fe),a.start*=o._toRad,a.end*=o._toRad,a.start-=Fe/2,a.end-=Fe/2,f=Fe/180,a.ccw&&(f*=-1),n=q(a,a.start+f),r=K(a,a.start+f),i=q(a,a.start),s=K(a,a.start),Z(e,t,o,a,n,r,i,s),t.arc(a.x+p,a.y+m,a.radius,a.start,a.end,a.ccw),l=q(a,a.end+f),d=K(a,a.end+f),c=q(a,a.end),u=K(a,a.end),Q(e,t,o,a,c,u,l,d)}function J(e,t,o,a,n,r,i,s){var l,d,c,u,p,m,f;a.arrowRadius&&!o.closed&&(f=Me(s-r,i-n),f-=Fe,p=o.strokeWidth*_e(f),m=o.strokeWidth*Se(f),l=i+a.arrowRadius*_e(f+a.arrowAngle/2),d=s+a.arrowRadius*Se(f+a.arrowAngle/2),c=i+a.arrowRadius*_e(f-a.arrowAngle/2),u=s+a.arrowRadius*Se(f-a.arrowAngle/2),t.moveTo(l-p,d-m),t.lineTo(i-p,s-m),t.lineTo(c-p,u-m),t.moveTo(i-p,s-m),t.lineTo(i+p,s+m),t.moveTo(i,s))}function Z(e,t,o,a,n,r,i,s){a._arrowAngleConverted||(a.arrowAngle*=o._toRad,a._arrowAngleConverted=ge),a.startArrow&&J(e,t,o,a,n,r,i,s)}function Q(e,t,o,a,n,r,i,s){a._arrowAngleConverted||(a.arrowAngle*=o._toRad,a._arrowAngleConverted=ge),a.endArrow&&J(e,t,o,a,n,r,i,s)}function ee(e,t,o,a){var n,r,i;for(n=2,Z(e,t,o,a,a.x2+o.x,a.y2+o.y,a.x1+o.x,a.y1+o.y),a.x1!==xe&&a.y1!==xe&&t.moveTo(a.x1+o.x,a.y1+o.y);ge&&(r=a["x"+n],i=a["y"+n],r!==xe&&i!==xe);)t.lineTo(r+o.x,i+o.y),n+=1;n-=1,Q(e,t,o,a,a["x"+(n-1)]+o.x,a["y"+(n-1)]+o.y,a["x"+n]+o.x,a["y"+n]+o.y)}function te(e,t,o,a){var n,r,i,s,l;for(n=2,Z(e,t,o,a,a.cx1+o.x,a.cy1+o.y,a.x1+o.x,a.y1+o.y),a.x1!==xe&&a.y1!==xe&&t.moveTo(a.x1+o.x,a.y1+o.y);ge&&(r=a["x"+n],i=a["y"+n],s=a["cx"+(n-1)],l=a["cy"+(n-1)],r!==xe&&i!==xe&&s!==xe&&l!==xe);)t.quadraticCurveTo(s+o.x,l+o.y,r+o.x,i+o.y),n+=1;n-=1,Q(e,t,o,a,a["cx"+(n-1)]+o.x,a["cy"+(n-1)]+o.y,a["x"+n]+o.x,a["y"+n]+o.y)}function oe(e,t,o,a){var n,r,i,s,l,d,c,u;for(n=2,r=1,Z(e,t,o,a,a.cx1+o.x,a.cy1+o.y,a.x1+o.x,a.y1+o.y),a.x1!==xe&&a.y1!==xe&&t.moveTo(a.x1+o.x,a.y1+o.y);ge&&(i=a["x"+n],s=a["y"+n],l=a["cx"+r],d=a["cy"+r],c=a["cx"+(r+1)],u=a["cy"+(r+1)],i!==xe&&s!==xe&&l!==xe&&d!==xe&&c!==xe&&u!==xe);)t.bezierCurveTo(l+o.x,d+o.y,c+o.x,u+o.y,i+o.x,s+o.y),n+=1,r+=2;n-=1,r-=2,Q(e,t,o,a,a["cx"+(r+1)]+o.x,a["cy"+(r+1)]+o.y,a["x"+n]+o.x,a["y"+n]+o.y)}function ae(e,t,o){return t*=e._toRad,t-=Fe/2,o*_e(t)}function ne(e,t,o){return t*=e._toRad,t-=Fe/2,o*Se(t)}function re(e,t,o,a){var n,r,i,s,l,d,c,u,p,m,f,h,w;for(o===a?(s=0,l=0):(s=o.x,l=o.y),n=1,d=u=m=h=a.x+s,c=p=f=w=a.y+l,Z(e,t,o,a,d+ae(o,a.a1,a.l1),c+ne(o,a.a1,a.l1),d,c),a.x!==xe&&a.y!==xe&&t.moveTo(d,c);ge&&(r=a["a"+n],i=a["l"+n],r!==xe&&i!==xe);)m=h,f=w,h+=ae(o,r,i),w+=ne(o,r,i),1===n&&(u=h,p=w),t.lineTo(h,w),n+=1;Q(e,t,o,a,m,f,h,w)}function ie(e,t,o){isNaN(he(o.fontSize))||(o.fontSize+="px"),t.font=o.fontStyle+" "+o.fontSize+" "+o.fontFamily}function se(t,o,a,n){var r,i,s,l=Ae.propCache;if(l.text===a.text&&l.fontStyle===a.fontStyle&&l.fontSize===a.fontSize&&l.fontFamily===a.fontFamily&&l.maxWidth===a.maxWidth&&l.lineHeight===a.lineHeight)a.width=l.width,a.height=l.height;else{for(a.width=o.measureText(n[0]).width,s=1;s<n.length;s+=1)i=o.measureText(n[s]).width,i>a.width&&(a.width=i);r=t.style.fontSize,t.style.fontSize=a.fontSize,a.height=we(e.css(t,"fontSize"))*n.length*a.lineHeight,t.style.fontSize=r}}function le(e,t){var o,a,n,r,i,s,l=t.text,d=t.maxWidth,c=l.split("\n"),u=[];for(n=0;n<c.length;n+=1){if(r=c[n],i=r.split(" "),o=[],a="",1===i.length||e.measureText(r).width<d)o=[r];else{for(s=0;s<i.length;s+=1)e.measureText(a+i[s]).width>d&&(""!==a&&o.push(a),a=""),a+=i[s],s!==i.length-1&&(a+=" ");o.push(a)}u=u.concat(o.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n"))}return u}var de,ce=t.document,ue=t.Image,pe=t.Array,me=t.getComputedStyle,fe=t.Math,he=t.Number,we=t.parseFloat,ge=!0,ye=!1,ve=null,xe=void 0,ke=e.extend,be=e.inArray,Te=function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},Ce=e.isFunction,Ne=e.isPlainObject,Fe=fe.PI,Le=fe.round,Oe=fe.abs,Se=fe.sin,_e=fe.cos,Me=fe.atan2,Ie=pe.prototype.slice,Re=e.event.fix,Pe={},Ae={dataCache:{},propCache:{},imageCache:{}},Ge={rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0,masks:[]},We={},Ee=["mousedown","mousemove","mouseup","mouseover","mouseout","touchstart","touchmove","touchend"],De={events:{},eventHooks:{},future:{}};a.baseDefaults={align:"center",arrowAngle:90,arrowRadius:0,autosave:ge,baseline:"middle",bringToFront:ye,ccw:ye,closed:ye,compositing:"source-over",concavity:0,cornerRadius:0,count:1,cropFromCenter:ge,crossOrigin:ve,cursors:ve,disableEvents:ye,draggable:ye,dragGroups:ve,groups:ve,data:ve,dx:ve,dy:ve,end:360,eventX:ve,eventY:ve,fillStyle:"transparent",fontStyle:"normal",fontSize:"12pt",fontFamily:"sans-serif",fromCenter:ge,height:ve,imageSmoothing:ge,inDegrees:ge,intangible:ye,index:ve,letterSpacing:ve,lineHeight:1,layer:ye,mask:ye,maxWidth:ve,miterLimit:10,name:ve,opacity:1,r1:ve,r2:ve,radius:0,repeat:"repeat",respectAlign:ye,restrictDragToAxis:null,rotate:0,rounded:ye,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowStroke:ye,shadowX:0,shadowY:0,sHeight:ve,sides:0,source:"",spread:0,start:0,strokeCap:"butt",strokeDash:ve,strokeDashOffset:0,strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:ve,sx:ve,sy:ve,text:"",translate:0,translateX:0,translateY:0,type:ve,visible:ge,width:ve,x:0,y:0},de=new a,o.prototype=de,De.extend=function(t){return t.name&&(t.props&&ke(de,t.props),e.fn[t.name]=function a(e){var n,r,s,l,d,c=this;for(r=0;r<c.length;r+=1)n=c[r],s=i(n),s&&(l=new o(e),d=M(n,l,e,a),p(n,s,l),t.fn.call(n,s,l));return c},t.type&&(Pe.drawings[t.type]=t.name)),e.fn[t.name]},e.fn.getEventHooks=function(){var e,t,o=this,a={};return 0!==o.length&&(e=o[0],t=g(e),a=t.eventHooks),a},e.fn.setEventHooks=function(t){var o,a,n,r=this;for(a=0;a<r.length;a+=1)o=e(r[a]),n=g(r[a]),ke(n.eventHooks,t);return r},e.fn.getLayers=function(e){var t,o,a,n,r,i=this,s=[];if(0!==i.length)if(t=i[0],o=g(t),a=o.layers,Ce(e))for(r=0;r<a.length;r+=1)n=a[r],e.call(t,n)&&s.push(n);else s=a;return s},e.fn.getLayer=function(e){var t,o,a,r,i,s,l=this;if(0!==l.length)if(t=l[0],o=g(t),a=o.layers,s=Te(e),e&&e.layer)r=e;else if("number"===s)0>e&&(e=a.length+e),r=a[e];else if("regexp"===s){for(i=0;i<a.length;i+=1)if(n(a[i].name)&&a[i].name.match(e)){r=a[i];break}}else r=o.layer.names[e];return r},e.fn.getLayerGroup=function(e){var t,o,a,n,r,i=this,s=Te(e);if(0!==i.length)if(t=i[0],"array"===s)r=e;else if("regexp"===s){o=g(t),a=o.layer.groups;for(n in a)if(n.match(e)){r=a[n];break}}else o=g(t),r=o.layer.groups[e];return r},e.fn.getLayerIndex=function(e){var t=this,o=t.getLayers(),a=t.getLayer(e);return be(a,o)},e.fn.setLayer=function(t,o){var a,n,i,l,d,c,u,p=this;for(n=0;n<p.length;n+=1)if(a=e(p[n]),i=g(p[n]),l=e(p[n]).getLayer(t)){k(a,i,l,o),b(a,i,l,o),s(o);for(d in o)o.hasOwnProperty(d)&&(c=o[d],u=Te(c),"object"===u&&Ne(c)?(l[d]=ke({},c),s(l[d])):"array"===u?l[d]=c.slice(0):"string"===u?0===c.indexOf("+=")?l[d]+=we(c.substr(2)):0===c.indexOf("-=")?l[d]-=we(c.substr(2)):!isNaN(c)&&r(c)&&"text"!==d?l[d]=we(c):l[d]=c:l[d]=c);y(a,i,l),x(a,i,l),e.isEmptyObject(o)===ye&&_(a,i,l,"change",o)}return p},e.fn.setLayers=function(t,o){var a,n,r,i,s=this;for(n=0;n<s.length;n+=1)for(a=e(s[n]),r=a.getLayers(o),i=0;i<r.length;i+=1)a.setLayer(r[i],t);return s},e.fn.setLayerGroup=function(t,o){var a,n,r,i,s=this;for(n=0;n<s.length;n+=1)if(a=e(s[n]),r=a.getLayerGroup(t))for(i=0;i<r.length;i+=1)a.setLayer(r[i],o);return s},e.fn.moveLayer=function(t,o){var a,n,r,i,s,l=this;for(n=0;n<l.length;n+=1)a=e(l[n]),r=g(l[n]),i=r.layers,s=a.getLayer(t),s&&(s.index=be(s,i),i.splice(s.index,1),i.splice(o,0,s),0>o&&(o=i.length+o),s.index=o,_(a,r,s,"move"));return l},e.fn.removeLayer=function(t){var o,a,n,r,i,s=this;for(a=0;a<s.length;a+=1)o=e(s[a]),n=g(s[a]),r=o.getLayers(),i=o.getLayer(t),i&&(i.index=be(i,r),r.splice(i.index,1),delete i._layer,k(o,n,i,{name:ve}),b(o,n,i,{groups:ve}),_(o,n,i,"remove"));return s},e.fn.removeLayers=function(t){var o,a,n,r,i,s,l=this;for(a=0;a<l.length;a+=1){for(o=e(l[a]),n=g(l[a]),r=o.getLayers(t),s=0;s<r.length;s+=1)i=r[s],o.removeLayer(i),s-=1;n.layer.names={},n.layer.groups={}}return l},e.fn.removeLayerGroup=function(t){var o,a,n,r,i,s,l=this;if(t!==xe)for(a=0;a<l.length;a+=1)if(o=e(l[a]),n=g(l[a]),r=o.getLayers(),i=o.getLayerGroup(t))for(i=i.slice(0),s=0;s<i.length;s+=1)o.removeLayer(i[s]);return l},e.fn.addLayerToGroup=function(t,o){var a,n,r,i=this,s=[o];for(n=0;n<i.length;n+=1)a=e(i[n]),r=a.getLayer(t),r.groups&&(s=r.groups.slice(0),-1===be(o,r.groups)&&s.push(o)),a.setLayer(r,{groups:s});return i},e.fn.removeLayerFromGroup=function(t,o){var a,n,r,i,s=this,l=[];for(n=0;n<s.length;n+=1)a=e(s[n]),r=a.getLayer(t),r.groups&&(i=be(o,r.groups),-1!==i&&(l=r.groups.slice(0),l.splice(i,1),a.setLayer(r,{groups:l})));return s},We.cursors=["grab","grabbing","zoom-in","zoom-out"],We.prefix=function(){var e=me(ce.documentElement,""),t=(Ie.call(e).join("").match(/-(moz|webkit|ms)-/)||""===e.OLink&&["","o"])[1];return"-"+t+"-"}(),e.fn.triggerLayerEvent=function(t,o){var a,n,r,i=this;for(n=0;n<i.length;n+=1)a=e(i[n]),r=g(i[n]),t=a.getLayer(t),t&&_(a,r,t,o);return i},e.fn.drawLayer=function(t){var o,a,n,r,s=this;for(o=0;o<s.length;o+=1)n=e(s[o]),a=i(s[o]),a&&(r=n.getLayer(t),C(n,a,r));return s},e.fn.drawLayers=function(t){var o,a,n,r,s,d,c,u,p,m,f,h,w,y=this,v=t||{};for(u=v.index,u||(u=0),a=0;a<y.length;a+=1)if(o=e(y[a]),n=i(y[a])){for(m=g(y[a]),v.clear!==ye&&o.clearCanvas(),r=m.layers,c=u;c<r.length;c+=1)if(s=r[c],s.index=c,v.resetFire&&(s._fired=ye),C(o,n,s,c+1),s._masks=m.transforms.masks.slice(0),s._method===e.fn.drawImage&&s.visible){w=!0;break}if(w)break;p=c,s=T(m),f=m.event,h=f.type,m.drag.layer&&N(o,m,h),d=m.lastIntersected,d===ve||s===d||!d._hovered||d._fired||m.drag.dragging||(m.lastIntersected=ve,d._fired=ge,d._hovered=ye,_(o,m,d,"mouseout"),L(o,m)),s&&(s[h]||(h=j(h)),s._event&&s.intersects&&(m.lastIntersected=s,(s.mouseover||s.mouseout||s.cursors)&&!m.drag.dragging&&(s._hovered||s._fired||(s._fired=ge,s._hovered=ge,_(o,m,s,"mouseover"))),s._fired||(s._fired=ge,f.type=ve,_(o,m,s,h)),!s.draggable||s.disableEvents||"mousedown"!==h&&"touchstart"!==h||(m.drag.layer=s))),s!==ve||m.drag.dragging||L(o,m),p===r.length&&(m.intersecting.length=0,m.transforms=l(Ge),m.savedTransforms.length=0)}return y},e.fn.addLayer=function(e){var t,a,n,r=this;for(t=0;t<r.length;t+=1)a=i(r[t]),a&&(n=new o(e),n.layer=ge,M(r[t],n,e));return r},We.props=["width","height","opacity","lineHeight"],We.propsObj={},e.fn.animateLayer=function(){function t(e,t,o){return function(){I(o),A(o),t.animating&&t.animated!==o||e.drawLayers(),o._animating=ye,t.animating=ye,t.animated=ve,u[4]&&u[4].call(e[0],o),_(e,t,o,"animateend")}}function o(e,t,o){return function(a,n){var r,i,s,l=!1;"_"===n.prop[0]&&(l=!0,n.prop=n.prop.replace("_",""),o[n.prop]=o["_"+n.prop]),-1!==n.prop.indexOf(".")&&(r=n.prop.split("."),i=r[0],s=r[1],o[i]&&(o[i][s]=n.now)),o._pos!==n.pos&&(o._pos=n.pos,o._animating||t.animating||(o._animating=ge,t.animating=ge,t.animated=o),t.animating&&t.animated!==o||e.drawLayers()),u[5]&&u[5].call(e[0],a,n,o),_(e,t,o,"animate",n),l&&(n.prop="_"+n.prop)}}var a,n,r,s,l,d,c=this,u=Ie.call(arguments,0);for("object"===Te(u[2])?(u.splice(2,0,u[2].duration||ve),u.splice(3,0,u[3].easing||ve),u.splice(4,0,u[4].complete||ve),u.splice(5,0,u[5].step||ve)):(u[2]===xe?(u.splice(2,0,ve),u.splice(3,0,ve),u.splice(4,0,ve)):Ce(u[2])&&(u.splice(2,0,ve),u.splice(3,0,ve)),u[3]===xe?(u[3]=ve,u.splice(4,0,ve)):Ce(u[3])&&u.splice(3,0,ve)),n=0;n<c.length;n+=1)a=e(c[n]),r=i(c[n]),r&&(s=g(c[n]),l=a.getLayer(u[0]),l&&l._method!==e.fn.draw&&(d=ke({},u[1]),d=P(c[n],l,d),R(d,ge),R(l),l.style=We.propsObj,e(l).animate(d,{duration:u[2],easing:e.easing[u[3]]?u[3]:ve,complete:t(a,s,l),step:o(a,s,l)}),_(a,s,l,"animatestart")));return c},e.fn.animateLayerGroup=function(t){var o,a,n,r,i=this,s=Ie.call(arguments,0);for(a=0;a<i.length;a+=1)if(o=e(i[a]),n=o.getLayerGroup(t))for(r=0;r<n.length;r+=1)s[0]=n[r],o.animateLayer.apply(o,s);return i},e.fn.delayLayer=function(t,o){var a,n,r,i,s=this;for(o=o||0,n=0;n<s.length;n+=1)a=e(s[n]),r=g(s[n]),i=a.getLayer(t),i&&(e(i).delay(o),_(a,r,i,"delay"));return s},e.fn.delayLayerGroup=function(t,o){var a,n,r,i,s,l=this;for(o=o||0,n=0;n<l.length;n+=1)if(a=e(l[n]),r=a.getLayerGroup(t))for(s=0;s<r.length;s+=1)i=r[s],a.delayLayer(i,o);return l},e.fn.stopLayer=function(t,o){var a,n,r,i,s=this;for(n=0;n<s.length;n+=1)a=e(s[n]),r=g(s[n]),i=a.getLayer(t),i&&(e(i).stop(o),_(a,r,i,"stop"));return s},e.fn.stopLayerGroup=function(t,o){var a,n,r,i,s,l=this;for(n=0;n<l.length;n+=1)if(a=e(l[n]),r=a.getLayerGroup(t))for(s=0;s<r.length;s+=1)i=r[s],a.stopLayer(i,o);return l},E(["color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","fillStyle","outlineColor","strokeStyle","shadowColor"]),Pe.touchEvents={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},Pe.mouseEvents={touchstart:"mousedown",touchend:"mouseup",touchmove:"mousemove"},$(["click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","touchstart","touchmove","touchend","contextmenu"]),e.event.fix=function(t){var o,a,n;return t=Re.call(e.event,t),a=t.originalEvent,a&&(n=a.changedTouches,t.pageX!==xe&&t.offsetX===xe?(o=e(t.currentTarget).offset(),o&&(t.offsetX=t.pageX-o.left,t.offsetY=t.pageY-o.top)):n&&(o=e(t.currentTarget).offset(),o&&(t.offsetX=n[0].pageX-o.left,t.offsetY=n[0].pageY-o.top))),t},Pe.drawings={arc:"drawArc",bezier:"drawBezier",ellipse:"drawEllipse","function":"draw",image:"drawImage",line:"drawLine",path:"drawPath",polygon:"drawPolygon",slice:"drawSlice",quadratic:"drawQuadratic",rectangle:"drawRect",text:"drawText",vector:"drawVector",save:"saveCanvas",restore:"restoreCanvas",rotate:"rotateCanvas",scale:"scaleCanvas",translate:"translateCanvas"},e.fn.draw=function je(t){var a,n,r,s,l=this,d=new o(t);if(Pe.drawings[d.type]&&"function"!==d.type)l[Pe.drawings[d.type]](t);else for(n=0;n<l.length;n+=1)a=e(l[n]),r=i(l[n]),r&&(d=new o(t),s=M(l[n],d,t,je),d.visible&&d.fn&&d.fn.call(l[n],r,d));return l},e.fn.clearCanvas=function ze(e){var t,a,n,r=this,s=new o(e);for(t=0;t<r.length;t+=1)a=i(r[t]),a&&(s.width===ve||s.height===ve?(a.save(),a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,r[t].width,r[t].height),a.restore()):(n=M(r[t],s,e,ze),w(r[t],a,s,s.width,s.height),a.clearRect(s.x-s.width/2,s.y-s.height/2,s.width,s.height),f(a,s)));return r},e.fn.saveCanvas=function $e(e){var t,a,n,r,s,l,c=this;for(t=0;t<c.length;t+=1)if(a=i(c[t]))for(s=g(c[t]),n=new o(e),r=M(c[t],n,e,$e),l=0;l<n.count;l+=1)d(a,s);return c},e.fn.restoreCanvas=function Be(e){var t,a,n,r,s,l,d=this;for(t=0;t<d.length;t+=1)if(a=i(d[t]))for(s=g(d[t]),n=new o(e),r=M(d[t],n,e,Be),l=0;l<n.count;l+=1)c(a,s);return d},e.fn.rotateCanvas=function Xe(e){var t,a,n,r,s,l=this;for(t=0;t<l.length;t+=1)a=i(l[t]),a&&(s=g(l[t]),n=new o(e),r=M(l[t],n,e,Xe),n.autosave&&d(a,s),X(a,n,s.transforms));return l},e.fn.scaleCanvas=function Ye(e){var t,a,n,r,s,l=this;for(t=0;t<l.length;t+=1)a=i(l[t]),a&&(s=g(l[t]),n=new o(e),r=M(l[t],n,e,Ye),n.autosave&&d(a,s),Y(a,n,s.transforms));return l},e.fn.translateCanvas=function He(e){var t,a,n,r,s,l=this;for(t=0;t<l.length;t+=1)a=i(l[t]),a&&(s=g(l[t]),n=new o(e),r=M(l[t],n,e,He),n.autosave&&d(a,s),H(a,n,s.transforms));return l},e.fn.drawRect=function Ve(e){var t,a,n,r,s,l,d,c,u,m,f=this;for(t=0;t<f.length;t+=1)a=i(f[t]),a&&(n=new o(e),r=M(f[t],n,e,Ve),n.visible&&(w(f[t],a,n,n.width,n.height),p(f[t],a,n),a.beginPath(),n.width&&n.height&&(s=n.x-n.width/2,l=n.y-n.height/2,u=Oe(n.cornerRadius),u?(d=n.x+n.width/2,c=n.y+n.height/2,n.width<0&&(m=s,s=d,d=m),n.height<0&&(m=l,l=c,c=m),0>d-s-2*u&&(u=(d-s)/2),0>c-l-2*u&&(u=(c-l)/2),a.moveTo(s+u,l),a.lineTo(d-u,l),a.arc(d-u,l+u,u,3*Fe/2,2*Fe,ye),a.lineTo(d,c-u),a.arc(d-u,c-u,u,0,Fe/2,ye),a.lineTo(s+u,c),a.arc(s+u,c-u,u,Fe/2,Fe,ye),a.lineTo(s,l+u),a.arc(s+u,l+u,u,Fe,3*Fe/2,ye),n.closed=ge):a.rect(s,l,n.width,n.height)),B(f[t],a,n),h(f[t],a,n)));return f},e.fn.drawArc=function qe(e){var t,a,n,r,s=this;for(t=0;t<s.length;t+=1)a=i(s[t]),a&&(n=new o(e),r=M(s[t],n,e,qe),n.visible&&(w(s[t],a,n,2*n.radius),p(s[t],a,n),a.beginPath(),U(s[t],a,n,n),B(s[t],a,n),h(s[t],a,n)));return s},e.fn.drawEllipse=function Ke(e){var t,a,n,r,s,l,d=this;for(t=0;t<d.length;t+=1)a=i(d[t]),a&&(n=new o(e),r=M(d[t],n,e,Ke),n.visible&&(w(d[t],a,n,n.width,n.height),p(d[t],a,n),s=n.width*(4/3),l=n.height,a.beginPath(),a.moveTo(n.x,n.y-l/2),a.bezierCurveTo(n.x-s/2,n.y-l/2,n.x-s/2,n.y+l/2,n.x,n.y+l/2),a.bezierCurveTo(n.x+s/2,n.y+l/2,n.x+s/2,n.y-l/2,n.x,n.y-l/2),B(d[t],a,n),n.closed=ge,h(d[t],a,n)));return d},e.fn.drawPolygon=function Ue(e){var t,a,n,r,s,l,d,c,u,m,f,g=this;for(t=0;t<g.length;t+=1)if(a=i(g[t]),a&&(n=new o(e),r=M(g[t],n,e,Ue),n.visible)){for(w(g[t],a,n,2*n.radius),p(g[t],a,n),l=2*Fe/n.sides,d=l/2,s=d+Fe/2,c=n.radius*_e(d),a.beginPath(),f=0;f<n.sides;f+=1)u=n.x+n.radius*_e(s),m=n.y+n.radius*Se(s),a.lineTo(u,m),n.concavity&&(u=n.x+(c+-c*n.concavity)*_e(s+d),m=n.y+(c+-c*n.concavity)*Se(s+d),a.lineTo(u,m)),s+=l;B(g[t],a,n),n.closed=ge,h(g[t],a,n)}return g},e.fn.drawSlice=function Je(t){var a,n,r,s,l,d,c,u,m=this;for(n=0;n<m.length;n+=1)a=e(m[n]),r=i(m[n]),r&&(s=new o(t),l=M(m[n],s,t,Je),s.visible&&(w(m[n],r,s,2*s.radius),p(m[n],r,s),s.start*=s._toRad,s.end*=s._toRad,
s.start-=Fe/2,s.end-=Fe/2,s.start=V(s.start),s.end=V(s.end),s.end<s.start&&(s.end+=2*Fe),d=(s.start+s.end)/2,c=s.radius*s.spread*_e(d),u=s.radius*s.spread*Se(d),s.x+=c,s.y+=u,r.beginPath(),r.arc(s.x,s.y,s.radius,s.start,s.end,s.ccw),r.lineTo(s.x,s.y),B(m[n],r,s),s.closed=ge,h(m[n],r,s)));return m},e.fn.drawLine=function Ze(e){var t,a,n,r,s=this;for(t=0;t<s.length;t+=1)a=i(s[t]),a&&(n=new o(e),r=M(s[t],n,e,Ze),n.visible&&(w(s[t],a,n),p(s[t],a,n),a.beginPath(),ee(s[t],a,n,n),B(s[t],a,n),h(s[t],a,n)));return s},e.fn.drawQuadratic=function Qe(e){var t,a,n,r,s=this;for(t=0;t<s.length;t+=1)a=i(s[t]),a&&(n=new o(e),r=M(s[t],n,e,Qe),n.visible&&(w(s[t],a,n),p(s[t],a,n),a.beginPath(),te(s[t],a,n,n),B(s[t],a,n),h(s[t],a,n)));return s},e.fn.drawBezier=function et(e){var t,a,n,r,s=this;for(t=0;t<s.length;t+=1)a=i(s[t]),a&&(n=new o(e),r=M(s[t],n,e,et),n.visible&&(w(s[t],a,n),p(s[t],a,n),a.beginPath(),oe(s[t],a,n,n),B(s[t],a,n),h(s[t],a,n)));return s},e.fn.drawVector=function tt(e){var t,a,n,r,s=this;for(t=0;t<s.length;t+=1)a=i(s[t]),a&&(n=new o(e),r=M(s[t],n,e,tt),n.visible&&(w(s[t],a,n),p(s[t],a,n),a.beginPath(),re(s[t],a,n,n),B(s[t],a,n),h(s[t],a,n)));return s},e.fn.drawPath=function ot(e){var t,a,n,r,s,l,d=this;for(t=0;t<d.length;t+=1)if(a=i(d[t]),a&&(n=new o(e),r=M(d[t],n,e,ot),n.visible)){for(w(d[t],a,n),p(d[t],a,n),a.beginPath(),s=1;ge&&(l=n["p"+s],l!==xe);)l=new o(l),"line"===l.type?ee(d[t],a,n,l):"quadratic"===l.type?te(d[t],a,n,l):"bezier"===l.type?oe(d[t],a,n,l):"vector"===l.type?re(d[t],a,n,l):"arc"===l.type&&U(d[t],a,n,l),s+=1;B(d[t],a,n),h(d[t],a,n)}return d},e.fn.drawText=function at(t){var a,n,r,s,l,d,c,u,m,h,g,y,v,x,k=this,b=500;for(n=0;n<k.length;n+=1)if(a=e(k[n]),r=i(k[n]),r&&(s=new o(t),l=M(k[n],s,t,at),s.visible)){if(r.textBaseline=s.baseline,r.textAlign=s.align,ie(k[n],r,s),d=s.maxWidth!==ve?le(r,s):s.text.toString().split("\n"),se(k[n],r,s,d),l&&(l.width=s.width,l.height=s.height),w(k[n],r,s,s.width,s.height),p(k[n],r,s),v=s.x,"left"===s.align?s.respectAlign?s.x+=s.width/2:v-=s.width/2:"right"===s.align&&(s.respectAlign?s.x-=s.width/2:v+=s.width/2),s.radius)for(m=we(s.fontSize),s.letterSpacing===ve&&(s.letterSpacing=m/b),u=0;u<d.length;u+=1){for(r.save(),r.translate(s.x,s.y),c=d[u],h=c.length,r.rotate(-(Fe*s.letterSpacing*(h-1))/2),y=0;h>y;y+=1)g=c[y],0!==y&&r.rotate(Fe*s.letterSpacing),r.save(),r.translate(0,-s.radius),r.fillText(g,0,0),r.restore();s.radius-=m,s.letterSpacing+=m/(2*b*Fe),r.restore()}else for(u=0;u<d.length;u+=1)c=d[u],x=s.y+u*s.height/d.length-(d.length-1)*s.height/d.length/2,r.shadowColor=s.shadowColor,r.fillText(c,v,x),"transparent"!==s.fillStyle&&(r.shadowColor="transparent"),0!==s.strokeWidth&&r.strokeText(c,v,x);x=0,"top"===s.baseline?x+=s.height/2:"bottom"===s.baseline&&(x-=s.height/2),s._event&&(r.beginPath(),r.rect(s.x-s.width/2,s.y-s.height/2+x,s.width,s.height),B(k[n],r,s),r.closePath()),f(r,s)}return Ae.propCache=s,k},e.fn.measureText=function(e){var t,a,n,r=this;return a=r.getLayer(e),(!a||a&&!a._layer)&&(a=new o(e)),t=i(r[0]),t&&(ie(r[0],t,a),n=le(t,a),se(r[0],t,a,n)),a},e.fn.drawImage=function nt(t){function a(e,t,o,a,n){a.width===ve&&a.sWidth===ve&&(a.width=a.sWidth=h.width),a.height===ve&&a.sHeight===ve&&(a.height=a.sHeight=h.height),n&&(n.width=a.width,n.height=a.height),a.sWidth!==ve&&a.sHeight!==ve&&a.sx!==ve&&a.sy!==ve?(a.width===ve&&(a.width=a.sWidth),a.height===ve&&(a.height=a.sHeight),a.cropFromCenter&&(a.sx+=a.sWidth/2,a.sy+=a.sHeight/2),a.sy-a.sHeight/2<0&&(a.sy=a.sHeight/2),a.sy+a.sHeight/2>h.height&&(a.sy=h.height-a.sHeight/2),a.sx-a.sWidth/2<0&&(a.sx=a.sWidth/2),a.sx+a.sWidth/2>h.width&&(a.sx=h.width-a.sWidth/2),w(e,t,a,a.width,a.height),p(e,t,a),t.drawImage(h,a.sx-a.sWidth/2,a.sy-a.sHeight/2,a.sWidth,a.sHeight,a.x-a.width/2,a.y-a.height/2,a.width,a.height)):(w(e,t,a,a.width,a.height),p(e,t,a),t.drawImage(h,a.x-a.width/2,a.y-a.height/2,a.width,a.height)),t.beginPath(),t.rect(a.x-a.width/2,a.y-a.height/2,a.width,a.height),B(e,t,a),t.closePath(),f(t,a),m(t,o,a)}function n(t,o,n,r,i){return function(){var s=e(t);a(t,o,n,r,i),r.layer?_(s,n,i,"load"):r.load&&r.load.call(s[0],i),r.layer&&(i._masks=n.transforms.masks.slice(0),r._next&&s.drawLayers({clear:ye,resetFire:ge,index:r._next}))}}var r,s,l,d,c,u,h,y,v,x=this,k=Ae.imageCache;for(s=0;s<x.length;s+=1)r=x[s],l=i(x[s]),l&&(d=g(x[s]),c=new o(t),u=M(x[s],c,t,nt),c.visible&&(v=c.source,y=v.getContext,v.src||y?h=v:v&&(k[v]&&k[v].complete?h=k[v]:(h=new ue,v.match(/^data:/i)||(h.crossOrigin=c.crossOrigin),h.src=v,k[v]=h)),h&&(h.complete||y?n(r,l,d,c,u)():(h.onload=n(r,l,d,c,u),h.src=h.src))));return x},e.fn.createPattern=function(t){function a(){d=n.createPattern(s,r.repeat),r.load&&r.load.call(u[0],d)}var n,r,s,l,d,c,u=this;return n=i(u[0]),n?(r=new o(t),c=r.source,Ce(c)?(s=e("<canvas />")[0],s.width=r.width,s.height=r.height,l=i(s),c.call(s,l),a()):(l=c.getContext,c.src||l?s=c:(s=new ue,c.match(/^data:/i)||(s.crossOrigin=r.crossOrigin),s.src=c),s.complete||l?a():(s.onload=a,s.src=s.src))):d=ve,d},e.fn.createGradient=function(e){var t,a,n,r,s,l,d,c,u,p,m=this,f=[];if(a=new o(e),t=i(m[0])){for(a.x1=a.x1||0,a.y1=a.y1||0,a.x2=a.x2||0,a.y2=a.y2||0,n=a.r1!==ve&&a.r2!==ve?t.createRadialGradient(a.x1,a.y1,a.r1,a.x2,a.y2,a.r2):t.createLinearGradient(a.x1,a.y1,a.x2,a.y2),d=1;a["c"+d]!==xe;d+=1)a["s"+d]!==xe?f.push(a["s"+d]):f.push(ve);for(r=f.length,f[0]===ve&&(f[0]=0),f[r-1]===ve&&(f[r-1]=1),d=0;r>d;d+=1){if(f[d]!==ve){for(u=1,p=0,s=f[d],c=d+1;r>c;c+=1){if(f[c]!==ve){l=f[c];break}u+=1}s>l&&(f[c]=f[d])}else f[d]===ve&&(p+=1,f[d]=s+p*((l-s)/u));n.addColorStop(f[d],a["c"+(d+1)])}}else n=ve;return n},e.fn.setPixels=function rt(e){var t,a,n,r,s,l,d,c,u,p,m=this;for(a=0;a<m.length;a+=1)if(t=m[a],n=i(t),n&&(r=new o(e),s=M(t,r,e,rt),w(m[a],n,r,r.width,r.height),r.width!==ve&&r.height!==ve||(r.width=t.width,r.height=t.height,r.x=r.width/2,r.y=r.height/2),0!==r.width&&0!==r.height)){if(d=n.getImageData(r.x-r.width/2,r.y-r.height/2,r.width,r.height),c=d.data,p=c.length,r.each)for(u=0;p>u;u+=4)l={r:c[u],g:c[u+1],b:c[u+2],a:c[u+3]},r.each.call(t,l,r),c[u]=l.r,c[u+1]=l.g,c[u+2]=l.b,c[u+3]=l.a;n.putImageData(d,r.x-r.width/2,r.y-r.height/2),n.restore()}return m},e.fn.getCanvasImage=function(e,t){var o,a=this,n=ve;return 0!==a.length&&(o=a[0],o.toDataURL&&(t===xe&&(t=1),n=o.toDataURL("image/"+e,t))),n},e.fn.detectPixelRatio=function(o){var a,n,r,s,l,d,c,u,p,m,f=this;for(r=0;r<f.length;r+=1)n=f[r],a=e(f[r]),s=i(n),m=g(f[r]),m.scaled||(l=t.devicePixelRatio||1,d=s.webkitBackingStorePixelRatio||s.mozBackingStorePixelRatio||s.msBackingStorePixelRatio||s.oBackingStorePixelRatio||s.backingStorePixelRatio||1,c=l/d,1!==c&&(u=n.width,p=n.height,n.width=u*c,n.height=p*c,n.style.width=u+"px",n.style.height=p+"px",s.scale(c,c)),m.pixelRatio=c,m.scaled=ge,o&&o.call(n,c));return f},De.clearCache=function(){var e;for(e in Ae)Ae.hasOwnProperty(e)&&(Ae[e]={})},e.support.canvas=e("<canvas />")[0].getContext!==xe,ke(De,{defaults:de,setGlobalProps:p,transformShape:w,detectEvents:B,closePath:h,setCanvasFont:ie,measureText:se}),e.jCanvas=De,e.jCanvasObject=o}),function(e,t){t.pow,t.sqrt,t.PI;e.jCanvas.extend({name:"drawTooltip",type:"tooltip",props:{eclipse:.5},fn:function(t,o){var a=o;e.jCanvas.transformShape(this,t,a),t.beginPath(),t.moveTo(a.x,a.y+a.radius),t.quadraticCurveTo(a.x-2*a.radius,a.y-2*a.radius,a.x,a.y-a.radius/1.5),t.quadraticCurveTo(a.x+2*a.radius,a.y-2*a.radius,a.x,a.y+a.radius),e.jCanvas.detectEvents(this,t,a),e.jCanvas.closePath(this,t,a)}})}(jQuery,Math),function(e,t,o,a){var n={base:{type:"base",text:TxtContent.workFlow.base.text,icon:"fa-diamond",active:!0,nodes:[{type:"begin",icon:"",desc:TxtContent.workFlow.base.text,ports:[TxtContent.workFlow.base.ports],modal:{title:TxtContent.workFlow.base.sel,buttons:[{text:TxtContent.workFlow.base["new"],click:function(){var e=this,t=new FormModal({title:TxtContent.workFlow.base.addGroup,elements:[{require:!0,labelName:TxtContent.workFlow.base.name,type:"text",name:"name"},{type:"hidden",name:"publicFlag",checkOptions:[{value:"1",text:"是否公开"}],defaultValue:"1"}],submitBindFunc:function(t){var o=new FormData(t[0]),a=SMARTGROUP.addSmartGroup(o);XREWIN.addAtBodyData("smartGroupKey",a);var n=function(){e.$modal.modal("show"),e.refreshValue("group"),e.setValue("group",XREWIN.getAtBodyData("smartGroupKey"))};new SGTableModal({modalOkFunc:n,groupKey:XREWIN.getAtBodyData("smartGroupKey"),btnCancelModalHide:e.$modal}).show()},autoDestroy:!0,submitBtn:TxtContent.workFlow.base.add,cancelBtn:TxtContent.workFlow.base.close});e.$modal.modal("hide"),t.show()}}],elements:[{require:!0,type:"select",name:"group",labelName:TxtContent.workFlow.select.selGroup,selectOptions:{url:SMARTGROUP.getListGroupUrl(),textName:"name",valueName:"key",multiple:!0,templateResult:function(t){if(t.element){var o,a,n=e(t.element).data("elementData"),r=n.key,i=r.charAt(r.length-1);return"s"==i?(o='<i class="icon">&#xe6f6;</i>  ',a=TxtContent.workFlow.select.smartGroup):"f"==i&&(o='<i class="icon">&#xe6f7;</i>  ',a=TxtContent.workFlow.select.importGroup),e('<span class="select" title="'+a+'">'+o+n.name+'<span style="float: right;">'+n.count+"</span></span>")}return t.text}},display:"block"}],valueNames:["group"],clear:!0}},{type:"end",icon:"",desc:TxtContent.workFlow.end,ports:[],modal:null,display:!1}]},event:{type:"event",text:TxtContent.workFlow.event.emit,icon:"fa-cogs",nodes:[{type:"event-register",icon:"",desc:TxtContent.workFlow.event.memberRegister,ports:[TxtContent.workFlow.event.memberRegister],modal:{title:TxtContent.workFlow.event.memberRegisterTime,elements:[{labelName:TxtContent.workFlow.event.controlTime,type:"radio-date",name:"wait",radioList:[1,2,3,4],prompt:TxtContent.workFlow.event.prompt}],valueNames:["wait"],clear:!0}},{type:"event-trade",icon:"",desc:TxtContent.workFlow.trade.tradeState,ports:[TxtContent.workFlow.trade.emit],modal:{title:TxtContent.workFlow.trade.tradeState,elements:[{require:!0,labelName:TxtContent.workFlow.trade.selTradeState,type:"select",name:"event",selectOptions:[{text:TxtContent.workFlow.trade.orders,value:"TRADE_ORDER"},{text:TxtContent.workFlow.trade.pay,value:"TRADE_PAY"}]},{labelName:TxtContent.workFlow.trade.waitOverTime,type:"radio-date",name:"wait",radioList:[1,2,3],prompt:TxtContent.workFlow.trade.prompt}],valueNames:["template","event","wait"],clear:!0}},{type:"event-email",icon:"",desc:TxtContent.workFlow.email.response,ports:[TxtContent.workFlow.email.emit],modal:{title:TxtContent.workFlow.email.responseEvent,elements:[{require:!0,labelName:TxtContent.workFlow.email.selEmail,type:"select",name:"template",selectOptions:{url:PERSONALIZE.getListMailTemplateUrl(),textName:"templateName",valueName:"key"}},{require:!0,labelName:TxtContent.workFlow.email.selEvent,type:"select",name:"event",selectOptions:[{text:TxtContent.workFlow.email.open,value:"OPENED_EMAIL"},{text:TxtContent.workFlow.email.href,value:"CLICKED_LINK"}]},{labelName:TxtContent.workFlow.email.waitTime,type:"radio-date",name:"wait",radioList:[1,2,3],prompt:TxtContent.workFlow.email.prompt}],valueNames:["template","event","wait"],clear:!0}},{type:"event-level",icon:"",desc:TxtContent.workFlow.level.res,ports:[TxtContent.workFlow.level.emit],modal:{title:TxtContent.workFlow.level.resTime,elements:[{labelName:TxtContent.workFlow.level.sysTime,type:"radio-date",name:"wait",radioList:[1,2,3],prompt:TxtContent.workFlow.level.prompt}],valueNames:["wait"],clear:!0}}]},marketing:{type:"marketing",text:TxtContent.workFlow.marketing.text,icon:"fa-shopping-cart",nodes:[{type:"marketing-sms",icon:"",desc:TxtContent.workFlow.marketing.desc,ports:[TxtContent.workFlow.marketing.ports],modal:{title:TxtContent.workFlow.marketing.desc,elements:[{require:!0,labelName:TxtContent.workFlow.marketing.selTem,type:"select",name:"template",selectOptions:{url:PERSONALIZE.getListSmsTemplateUrl(),textName:"templateName",valueName:"key"},change:function(t){var o=e(this).val();if(o){var a=PERSONALIZE.getByIdSmsTemplate(o);t.setValue("subject",a.subject)}}},{require:!0,type:"text",name:"subject",labelName:TxtContent.workFlow.marketing.smsTitle},{require:!0,labelName:TxtContent.workFlow.marketing.sendAccount,type:"select",name:"customer",selectOptions:{url:PLAT.getListCustomerUrl(),textName:"customerName",valueName:"key"}},{labelName:TxtContent.workFlow.marketing.overTime,type:"radio-date",name:"wait",radioList:[1,2,3],defaultValue:[1,"5","0"]}],valueNames:["template","subject","senderChinese","sender","customer","wait"],clear:!0}},{type:"marketing-mail",icon:"",desc:TxtContent.workFlow.marketingMail.sendEmail,ports:[TxtContent.workFlow.marketingMail.sendEmail],modal:{title:TxtContent.workFlow.marketingMail.sendEmail,elements:[{require:!0,labelName:TxtContent.workFlow.marketingMail.selTem,type:"select",name:"template",selectOptions:{url:PERSONALIZE.getListMailTemplateUrl(),textName:"templateName",valueName:"key"},change:function(t){var o=e(this).val();if(o){var a=PERSONALIZE.getByIdMailTemplate(o);t.setValue("subject",a.subject),t.setValue("sender",a.sender),t.setValue("senderChinese",a.senderChinese)}}},{require:!0,type:"text",name:"subject",labelName:TxtContent.workFlow.marketingMail.emailTitle},{require:!0,type:"text",name:"senderChinese",labelName:TxtContent.workFlow.marketingMail.sender},{require:!0,type:"text",name:"sender",labelName:TxtContent.workFlow.marketingMail.sendAddress},{require:!0,labelName:TxtContent.workFlow.marketingMail.sendAccount,type:"select",name:"customer",selectOptions:{url:PLAT.getListCustomerUrl(),textName:"customerName",valueName:"key"}},{labelName:TxtContent.workFlow.marketingMail.overTime,type:"radio-date",name:"wait",radioList:[1,2,3],defaultValue:[1,"5","0"]}],valueNames:["template","subject","senderChinese","sender","customer","wait"],clear:!0}},{type:"marketing-wechat",icon:"",desc:TxtContent.workFlow.wechat.desc,ports:["微信"],modal:{title:TxtContent.workFlow.wechat.info,elements:[],clear:!0}},{type:"marketing-app",icon:"",desc:TxtContent.workFlow.wechat.mobile,ports:[TxtContent.workFlow.wechat.mobile],modal:{title:TxtContent.workFlow.wechat.mobileInfo,elements:[],clear:!0}}]},wait:{type:"wait",text:TxtContent.workFlow.wait.text,icon:"fa-clock-o",nodes:[{type:"wait-open",desc:TxtContent.workFlow.wait.emailOpen,icon:"",ports:["打开","时间到"],modal:{title:TxtContent.workFlow.wait.waitOpen,elements:[{require:!0,labelName:TxtContent.workFlow.wait.selEmail,type:"select",name:"template",selectOptions:{url:PERSONALIZE.getListMailTemplateUrl(),textName:"templateName",valueName:"key"}},{labelName:TxtContent.workFlow.wait.overTime,type:"radio-date",name:"wait",radioList:[1,2,3],prompt:TxtContent.workFlow.wait.prompt}],valueNames:["template","wait"],clear:!0}},{type:"wait-click",desc:TxtContent.workFlow.waitClick.desc,icon:"",ports:[TxtContent.workFlow.waitClick.click,TxtContent.workFlow.waitClick.time],modal:{title:TxtContent.workFlow.waitClick.desc,elements:[{require:!0,labelName:TxtContent.workFlow.waitClick.selEmail,type:"select",name:"template",selectOptions:{url:PERSONALIZE.getListMailTemplateUrl(),textName:"templateName",valueName:"key"}},{labelName:TxtContent.workFlow.waitClick.overTime,type:"radio-date",name:"wait",radioList:[1,2,3],prompt:TxtContent.workFlow.waitClick.prompt}],valueNames:["template","wait"],clear:!0}},{type:"wait-sms-click",desc:TxtContent.workFlow.waitSmsClick.desc,icon:"",ports:["点击","时间到"],modal:{title:TxtContent.workFlow.waitSmsClick.emailClick,elements:[{require:!0,labelName:TxtContent.workFlow.waitSmsClick.waitSms,type:"select",name:"template",selectOptions:{url:PERSONALIZE.getListSmsTemplateUrl(),textName:"templateName",valueName:"key"}},{labelName:TxtContent.workFlow.waitSmsClick.overTime,type:"radio-date",name:"wait",radioList:[1,2,3],prompt:TxtContent.workFlow.waitSmsClick.prompt}],valueNames:["template","wait"],clear:!0}},{type:"wait-take",desc:TxtContent.workFlow.waitTake.take,icon:"",ports:[TxtContent.workFlow.waitTake.take,TxtContent.workFlow.waitTake.time],modal:{title:TxtContent.workFlow.waitTake.take,elements:[{labelName:TxtContent.workFlow.waitTake.overTime,type:"radio-date",name:"wait",radioList:[1,2,3],prompt:TxtContent.workFlow.waitTake.prompt}],valueNames:["wait"],clear:!0}},{type:"wait-order",desc:TxtContent.workFlow.waitOrder.order,icon:"",ports:[TxtContent.workFlow.waitOrder.order,TxtContent.workFlow.waitOrder.time],modal:{title:TxtContent.workFlow.waitOrder.order,elements:[{labelName:TxtContent.workFlow.waitOrder.overTime,type:"radio-date",name:"wait",radioList:[1,2,3],prompt:TxtContent.workFlow.waitOrder}],valueNames:["wait"],clear:!0}},{type:"wait-pay",desc:TxtContent.workFlow.waitPay.pay,icon:"",ports:[TxtContent.workFlow.waitPay.pay,TxtContent.workFlow.waitPay.time],modal:{title:TxtContent.workFlow.waitPay.setOverTime,elements:[{labelName:TxtContent.workFlow.waitPay.overTime,type:"radio-date",name:"wait",radioList:[1,2,3]}],valueNames:["wait"],clear:!0}},{type:"wait-evaluate",desc:TxtContent.workFlow.evaluate.eva,icon:"",ports:[TxtContent.workFlow.evaluate.eva,TxtContent.workFlow.evaluate.time],modal:{title:TxtContent.workFlow.evaluate.waitEva,elements:[{labelName:TxtContent.workFlow.evaluate.setOverTime,type:"radio-date",name:"wait",radioList:[1,2,3],prompt:TxtContent.workFlow.evaluate.prompt}],valueNames:["wait"],clear:!0}},{type:"wait-cus",desc:TxtContent.workFlow.waitCus.cus,icon:"",ports:[TxtContent.workFlow.waitCus.emit,TxtContent.workFlow.waitCus.time],modal:{id:"modal_date",title:TxtContent.workFlow.waitCus.eventWait,elements:[{labelName:TxtContent.workFlow.waitCus.setSysOverTime,type:"radio-date",name:"wait",radioList:[1,2,3],prompt:""},{require:!0,type:"checkbox",name:"action",checkOptions:[{value:"click",text:TxtContent.workFlow.waitCus.emailClick},{value:"open",text:TxtContent.workFlow.waitCus.emailOpen}]}],valueNames:["wait","action"],clear:!0}}]},history:{type:"history",text:TxtContent.workFlow.history.loop,icon:"fa-history",nodes:[]},advanced:{type:"advanced",text:TxtContent.workFlow.history.operate,icon:"fa-gear",nodes:[{type:"advanced-time",desc:TxtContent.workFlow.history.setTime,icon:"",ports:[TxtContent.workFlow.history.time],modal:{title:TxtContent.workFlow.history.setTime,elements:[{labelName:TxtContent.workFlow.history.setSysTime,type:"radio-date",name:"wait",radioList:[1,2,3,4],prompt:TxtContent.workFlow.history.prompt}],valueNames:["wait"],clear:!0}},{type:"advanced-level",desc:TxtContent.workFlow.advancedLevel.ediMem,icon:"",ports:["完成"],modal:{title:TxtContent.workFlow.advancedLevel.ediMem,elements:[{require:!0,labelName:TxtContent.workFlow.advancedLevel.selEdit,type:"select",name:"param",selectOptions:WorkflowMemberColumns},{require:!0,labelName:TxtContent.workFlow.advancedLevel.ediCon,type:"text",name:"value"}],valueNames:["param","value"],clear:!0}},{type:"advanced-group-in",desc:TxtContent.workFlow.groupIn.addGroup,icon:"",ports:[TxtContent.workFlow.groupIn.finish],modal:{title:TxtContent.workFlow.groupIn.addGroup,elements:[{require:!0,labelName:TxtContent.workFlow.groupIn.selGroup,type:"select",name:"group",selectOptions:{url:SMARTGROUP.getListFixGroupUrl(),textName:"name",valueName:"key"}}],valueNames:["group"],clear:!0}},{type:"advanced-group-out",desc:TxtContent.workFlow.groupOut.out,icon:"",ports:[TxtContent.workFlow.groupOut.finish],modal:{title:TxtContent.workFlow.groupOut["in"],elements:[{require:!0,labelName:TxtContent.workFlow.groupOut.selGroup,type:"select",name:"group",selectOptions:{url:SMARTGROUP.getListFixGroupUrl(),textName:"name",valueName:"key"}}],valueNames:["group"],clear:!0}},{type:"advanced-ABTest",desc:TxtContent.workFlow.ABTest.AB,icon:"",ports:[TxtContent.workFlow.ABTest.A,TxtContent.workFlow.ABTest.B],modal:{title:TxtContent.workFlow.ABTest.ABFlow,elements:[{require:!0,type:"text",name:"rate",labelName:TxtContent.workFlow.ABTest.scale},{type:"label",labelName:TxtContent.workFlow.ABTest.label}],valueNames:["rate"],clear:!0}},{type:"advanced-group-flow",desc:TxtContent.workFlow.advancedGroupFlow.memberFlow,icon:"",ports:[],selectPorts:"group",modal:{id:"advanced_group_flow",title:TxtContent.workFlow.advancedGroupFlow.selGroup,elements:[{require:!0,type:"checkbox",name:"group",labelName:TxtContent.workFlow.advancedGroupFlow.groupName,checkOptions:{url:SMARTGROUP.getListGroupUrl(),textName:"name",valueName:"key"},display:"block"}],valueNames:["group"],clear:!0}}]}},r={},i=function(e){var t=this;return t instanceof i||(t=new i),t.init(e),t},s=function(e,t){var o="tab-"+e+"-"+(t.id||t.type),a=[],n="";return t.color?n='style="color: '+t.color+'"':t.display===!1&&(n='style="visibility:hidden;overflow: hidden;width :0px; height: 0px;"'),a.push('<dl id="'+o+'" data-id="'+o+'" '+n+' class="workflow-node">'),a.push("<dt>"),a.push('<i class="icon">'+t.icon+"</i>"),a.push("</dt><dt><span>"),a.push(t.desc+"</span></dt></dl>"),a.join("")},l=function(e){if(!(e instanceof i))return"";var t=[],o="";t.push('<div class="modal fade in" id="workflowNodeModal" tabindex="-1" role="dialog"  aria-hidden="true">'),t.push('<div class="modal-dialog">'),t.push('<div class="modal-content">'),t.push('<div class="modal-header">'),t.push('<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>'),t.push('<h4 class="modal-title">'+TxtContent.workFlow.clickSel+"</h4>"),t.push("</div>"),t.push('<div class="modal-body">'),t.push('<div class="tabs-container">'),t.push('<ul class="nav nav-tabs">');for(var a in n)if(n.hasOwnProperty(a)){o="",a=n[a],a.active&&(o="active");var r="tab-"+a.type;t.push('<li class="'+o+'" title="'+a.text+'"><a data-toggle="tab" href="#'+r+'" aria-expanded="true"> <i class="fa '+a.icon+'"></i></a></li>')}t.push("</ul>"),t.push('<div class="tab-content">');for(var l in n)if(n.hasOwnProperty(l)){o="",l=n[l],l.active&&(o="active");var d="tab-"+l.type;t.push('<div id="'+d+'" class="tab-pane '+o+'">'),t.push('<div class="panel-body">'),l.nodes.forEach(function(o){t.push(s(l.type,o)),e.node_dic[d+"-"+o.type]=o}),t.push("</div>"),t.push("</div>"),o=""}return t.push("</div>"),t.push('<div class="form-control"><span id="spanDescNode" style="color:red;"></span></div>'),t.push("</div>"),t.push("</div>"),t.push('<div class="modal-footer">'),t.push('<button type="button" class="btn btn-white" data-dismiss="modal">'+TxtContent.workFlow.cancel+"</button>"),t.push("</div>"),t.push("</div>"),t.push("</div>"),t.push("</div>"),t.join("")},d=function(){var e=[];return e.push('<div class="modal fade in" id="workflowThumbnailModal" tabindex="-1" role="dialog"  aria-hidden="true">'),e.push('<div class="modal-dialog">'),e.push('<div class="modal-content">'),e.push('<div class="modal-header">'),e.push('<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>'),e.push('<h4 class="modal-title">'+TxtContent.workFlow.checkImg+"</h4>"),e.push("</div>"),e.push('<div class="modal-body">'),e.push('<img id="workflowThumbnailImg" src="" style="width: 300px;background-color: white;">'),e.push("</div>"),e.push('<div class="modal-footer">'),e.push('<button type="button" class="btn btn-white" data-dismiss="modal">'+TxtContent.workFlow.close+"</button>"),e.push("</div>"),e.push("</div>"),e.push("</div>"),e.push("</div>"),e.join("")},c=function(t,o){var a=o.getOption("source"),n=o.getOption("workflow"),r=o.getOption("onClickNode"),i=function(e){r&&r.call(n,e)};if(e.isArray(a)){var s=[];a.forEach(function(o){s.push(e.extend({},t,o))}),i(s)}else{var l=e.extend({},t,a);i(l)}},u=function(e,t,o){o.getOption("onSaveNode")&&o.getOption("onSaveNode").call(o.getOption("workflow"),e,t)};i.prototype.init=function(t){var o=this,a=e("body");e("#workflowNodeModal").remove(),e("#workflowThumbnailModal").remove(),o.options=e.extend({},r,t),o.node_dic={},o.$modal=e(l(o)).appendTo(a),o.$thumbnailModal=e(d(o)).appendTo(a),o.refresh()},i.prototype.setOption=function(e,t){this.options||(this.options={}),this.options[e]=t},i.prototype.getOption=function(e){return e in this.options?this.options[e]:null},i.prototype.show=function(e){this.setOption("source",e),this.$modal.modal("show")},i.prototype.addWorkflowNode=function(e,t){this.setOption("source",e),this.$modal.find("#"+t).click()},i.prototype.generateNodeModal=function(t){var o=this,a=o.getNode(t);return a.modal?(a.modal instanceof FormModal||(a.modal.elements&&a.modal.elements.push({type:"hidden",name:"layerName"}),a.modal=new FormModal(e.extend({},a.modal,{submitBindFunc:function(){try{var n=o.getActive(t);n.nodeModal=this,n.nodeModalId=t,n.workValues=this.getValues(),a.selectPorts&&(n.ports=n.workValues[a.selectPorts].split(","));var r=this.getValue("layerName");if(r){var i=a.type;if(i&&"advanced-group-flow"==i){var s=[],l=a.modal.$form,d=o.getOption("workflow");l.find('[type="checkbox"]:checked').each(function(){s.push(e(this).val())});var p=function(e,t){return e>t?1:-1};s.sort(p);var m=l.find('[type="checkbox"]').map(function(){return e(this).val()}).get();m.unshift(0),n.workValues.portsIndex=s,n.workValues.allCheckBox=m,u(r,n.workValues,o);for(var f=s,h=m.join(";"),w=0,g=f.length;g>w;w++){var y=new RegExp("(^|;)"+f[w]+"(;|$)","g");h=h.replace(y,";")}h=h.replace(/^\;+|\;+$/g,"");for(var v=h.split(";"),x=0;x<v.length;x++){var k=r+"_"+v[x];d.deleteNode(k)}d.loadNodes(d.getNodes())}else u(r,n.workValues,o)}else c(n,o)}catch(b){console.error(b.message)}return!1}}))),a.modal):(c(a,o),null)},i.prototype.showThumbnail=function(e){e&&(this.$thumbnailModal.find("#workflowThumbnailImg").attr("src",e.getCanvasImage()),this.$thumbnailModal.modal("show"))},i.prototype.hide=function(){this.$modal.modal("hide")},i.prototype.refresh=function(){var t=this,o=t.$modal.find(".workflow-node"),a=t.$modal.find("#spanDescNode");o.off("click.workflow").on("click.workflow",function(){var o=e(this),a=o.data("id"),n=t.generateNodeModal(a);n&&n.show(),t.hide()}),o.off("mouseover.workflow").on("mouseover.workflow",function(){o.css("background-color","");var n=t.getNode(e(this).data("id")),r=TxtContent.workFlow.noOut;n.ports.length>0&&(r=TxtContent.workFlow.selNode+n.ports.length+TxtContent.workFlow.out+"["+n.ports.join()+"]"),a.text(r),e(this).css("background-color","#CEE3F6")})},i.prototype.addNode=function(e,t){var o=this,a="tab-"+e,n=this.$modal.find("#"+a+" .panel-body");n.append(s(e,t)),o.node_dic[a+"-"+(t.id||Guid())]=t,o.refresh()},i.prototype.clearHistoryNode=function(){var e="tab-"+workflowNodeType.history,t=this.$modal.find("#"+e+" .panel-body");t.empty()},i.prototype.addHistoryNode=function(e){this.addNode(workflowNodeType.history,e)},i.prototype.getBeginNode=function(){return this.getActive("tab-base-begin")},i.prototype.getEndNode=function(){return this.getActive("tab-base-end")},i.prototype.getNode=function(e){return e in this.node_dic?this.node_dic[e]:null},i.prototype.getActive=function(e){if(e in this.node_dic){var t=this.node_dic[e];return{type:t.type,desc:t.desc,ports:t.ports,icon:t.icon,color:t.color}}return null},"undefined"==typeof e.WorkflowNodeModal&&(e.WorkflowNodeModal=i,t.WorkflowNodeModal=i,o.WorkflowNodeModal=i)}(jQuery,window,document),function(e,t,o,a){if("undefined"==typeof e.Workflow){var n={nodeSize:50,maxColumn:0,verticalInterval:1.5,horizontalInterval:1.5,textInterval:10},r={Loaded:"canvas.load.workflow",AddNode:"node.add.workflow",DeleteNode:"node.delete.workflow",SelectNode:"node.select.workflow",MouseOverNode:"node.mouseover.workflow",MouseOverLine:"line.mouseover.workflow",MoveNode:"node.move.workflow"},i=e("canvas"),s=0,l=0,d=function(e,t,o){if("end"===o)return e+"-"+o;var a=md5(e+t);return a+="-"+o},c=function(e){return e+"-line"},u=function(e){return e+"-text"},p=function(e){return e+"-num"},m=function(e){return e+"-loop"},f=function(e,t){if("string"==typeof e&&(e=i.getLayer(e).data),"advanced-group-flow"==e.type){var o=e.ports;return o[t-1]}return t},h=function(e,t){return e+"_"+t},w=function(e){return g(e)?e:e+"-plus"},g=function(e){return-1!=(e+"").indexOf("-plus")},y=function(){return"#"+function(e){return(e+="0123456789"[Math.floor(10*Math.random())])&&3==e.length?e:arguments.callee(e)}("")},v=function(e){return"c_"+(e.split("_").length-1)},x=function(e){return e.getLayers(function(e){var t=e.data.isLeaf;return t})},k=function(e,t,o){var a=[],n=e.nodeSize;return a[0]=e.x+e.horizontalInterval*n,a[1]=e.y-e.horizontalInterval*((t-1)/2-(o-1))*n,a},b=function(e,t,o){var a=e.nodeSize,n=e.x+a/2*Math.cos(Math.PI/2-Math.PI/(t+1)*o),r=e.y-a/2*Math.sin(Math.PI/2-Math.PI/(t+1)*o);return[n,r]},T=function(e){return[e.x-e.nodeSize/2,e.y]},C=function(e,t,o){var a=h(t,f(t,o)),n=e.getLayer(a);return n||(n=e.getLayer(w(a))),n},N=function(e,t){return e.name>t.name?1:-1},F=function(e,t){return e>t?1:-1},L=function(e){var t=this;return t instanceof L||(t=new L),t.init(e),t};L.prototype.setOption=function(e,t){this.options||(this.options={}),this.options[e]=t},L.prototype.getOption=function(e){return e in this.options?this.options[e]:null},L.prototype.init=function(t){var a=this;a.options=e.extend({},n,t);a.getOption("key");a.workflowModal=WorkflowNodeModal({onClickNode:a.drawCommonRect,onSaveNode:a.setNodeValues,key:a.getOption("key"),workflow:a}),a.data={};var s=i.height(),l=a.getOption("nodeSize"),d={};return d.name="n0",d=a.buildNode(d,[l,s/2]),a.drawPlusRect(d),"function"==typeof t.onload&&i.bind(r.Loaded,t.onload),i.trigger(r.Loaded,a),e(o).on("keydown",function(e){return 46!=e.keyCode&&8!=e.keyCode||"CANVAS"!==e.target.tagName&&"DOCUMENT"!==e.target.tagName&&"BODY"!==e.target.tagName?void 0:(a.deleteSelectedNode(),!1)}),a},L.prototype.clearCanvas=function(){var e=this;i.removeLayers(),i.clearCanvas();var t=i.height(),o=e.getOption("nodeSize"),a={};a.name="n0",a=e.buildNode(a,[o,t/2]),e.drawPlusRect(a)},L.prototype.addWorkflow=function(){for(var e=this,t=e.getOption("nodeSize"),o=i.getLayer("n"+l);!o;)l++,o=i.getLayer("n"+l);if(o){var a={};l++,a.name="n"+l,a=e.buildNode(a,[o.x,o.y+1.5*t]),e.drawPlusRect(a),e.moveRect()}},L.prototype.getWorkflowCount=function(){var e=i.getLayerGroup("c_0");return e.length},L.prototype.showThumbnail=function(){this.workflowModal.showThumbnail(i)},L.prototype.buildNode=function(e,t){var o=this.buildPlusNode(e,t);return o.type=e.type,o.ports=e.ports,o.src=e.src,o.desc=e.desc,o.dependName=e.dependName,o},L.prototype.buildPlusNode=function(e,t){e||(e={});var o=this,a={};return a.nodeSize=o.getOption("nodeSize"),a.verticalInterval=o.getOption("verticalInterval"),a.horizontalInterval=o.getOption("horizontalInterval"),a.key=o.getOption("key"),a.name=e.name,a.color=e.color,t?(a.x=t[0],a.y=t[1]):(a.x=e.x,a.y=e.y),a},L.prototype.loadNodes=function(e){var t=this,o=function(e,o){return function(){e&&e.nodes&&e.nodes.length>0&&(i.removeLayers(),o.drawCommonRect(e.nodes),l=t.getWorkflowCount()-1,console.info("workflowIndex="+l),i.click())}},a=function(){return function(){i.click()}};setTimeout(o(e,this),100),setTimeout(a(),200)};var O=function(e){return{type:e.type,id:e.id,workValues:e.workValues}};L.prototype.getNodes=function(){for(var t=[],o=[],a=[],n={},r=i.getLayers(function(e){return"string"==typeof e.name}).sort(N),s=0;s<r.length;s++){var l=r[s];if(l.data){var d=l.data;switch(d.nodeDrawType){case"line":var c=[];c.push(d.sid),c.push(d.port),c.push(d.did),t.push(c.join());break;default:if(d.id){var u=e.extend({},d,{isLoaded:!1,nodeModal:!1});o.push(u),d.id in n||d.dependName||(n[d.id]=!0,a.push(O(u)))}}}}return{lines:t.join(";"),nodes:o,actions:a}},L.prototype.getNodeByName=function(e){var t=i.getLayer(e);return t?t.data:null},L.prototype.getIcon=function(e){var t=this,o=t.workflowModal.getNode(e);return o?o.icon:null},L.prototype.deleteNode=function(e){var t=i.getLayer(e);if(t){for(var o=c(e),a=i.getLayers(function(e){return e.name&&0==e.name.indexOf(t.name)&&e.name!=o}),n=0;n<a.length;n++)i.removeLayer(a[n]);for(var s=i.getLayers(function(t){return t.data&&t.data.dependName==e}),l=0;l<s.length;l++){var d=s[l];i.removeLayerGroup(d.name);var u=this.buildPlusNode(d,[d.x,d.y]);this.drawPlusRect(u)}i.removeLayer(p(t.name));var m=this.buildPlusNode(t.data,[t.x,t.y]);this.drawPlusRect(m),this.removeSelected(),
i.drawLayers({clear:!0}),i.trigger(r.DeleteNode,t.data)}},L.prototype.deleteSelectedNode=function(){var e=this.getOption("selected");this.deleteNode(e)},L.prototype.setNodeValues=function(e,t){var o=i.getLayer(e);o&&(o.data.workValues=t,"advanced-group-flow"==o.data.type&&(o.data.ports="string"==typeof t.group?t.group.split(","):t.group))},L.prototype.setAllPlusNodes=function(t){var o=this,a=i.getLayerGroup("plus");o.workflowModal.clearHistoryNode();var n=o.getNodes().nodes;if(e.isArray(n)&&n.forEach(function(e){e.dependName||(e.dependName=e.name,e.ports=[],e.outCount=0,o.workflowModal.addHistoryNode(e))}),e.isArray(a)){var r=[];a.forEach(function(e){e.data&&(e.data.x=e.x,e.data.y=e.y,delete e.data.color,r.push(e.data))}),t?o.workflowModal.addWorkflowNode(r,"tab-base-end"):o.workflowModal.show(r)}},L.prototype.drawPlusRect=function(t){var o=this,a=t.name,n=t.color,s=a.split("_").length,l=o.getOption("nodeSize");o.setOption("maxColumn",Math.max(s,o.getOption("maxColumn"))),t.isLeaf=!0,delete t.type;var d=w(a);return i.drawArc({layer:!0,name:w(a),groups:[v(a),d,"plus"],data:t,strokeStyle:"gray",strokeWidth:2,strokeDash:[5],x:t.x,y:t.y,radius:l/2,click:function(t){if(t.data){t.data.x=t.x,t.data.y=t.y,delete t.data.color,o.workflowModal.clearHistoryNode();var a=o.getNodes().nodes;e.isArray(a)&&a.forEach(function(e){e.dependName||(e.dependName=e.name,e.ports=[],e.outCount=0,-1==e.id.indexOf("-end")&&o.workflowModal.addHistoryNode(e))}),o.workflowModal.show(t.data)}},mouseover:function(e){console.info("plus.name="+e.name),i.trigger(r.MouseOverNode,e.data)}}).drawText({layer:!0,name:u(a),groups:[d],fillStyle:n||"#36c",strokeWidth:2,x:t.x,y:t.y,fontSize:"20pt",fontFamily:"Verdana, sans-serif",text:"+"}),t},L.prototype.drawCommonRect=function(t,o,a){var n=this;e.isArray(t)||(t=[t]),t.sort(N),t.forEach(function(t,l,u){var m=y(),g=n.getOption("nodeSize");t.ports=t.ports.sort(F);var x=t.ports.length,b=t.color||m;t.color=b;var T=t.name,C=v(T);t.isLeaf=1>x,t.outCount=x;var N=t.desc;t.id?s=Math.max(s,t.nodeIndex):(s++,t.nodeIndex=s,t.id=d(t.key,t.name,t.type),t.desc=N);var L=n.getIcon(t.nodeModalId)||t.icon;if(i.setLayer(c(T),{strokeDash:[]}),i.removeLayerGroup(w(T)),i.drawText({layer:!0,text:L,name:T,data:t,groups:[C,T],x:t.x,y:t.y,fillStyle:b,fontStyle:"bold",fontSize:g+"px",fontFamily:"IconFont",cursors:{mouseover:"pointer"},click:function(e){e.data.dependName&&n.shakeRect(e.data.dependName),console.info(e.name+";width="+e.width+";height="+e.height),n.drawSelected(e.name),i.focus()},dblclick:function(t){if(t.data.dependName)i.triggerLayerEvent(t.data.dependName,"dblclick");else if(t.data.nodeModal===!1&&t.data.nodeModalId&&(t.data.nodeModal=n.workflowModal.generateNodeModal(t.data.nodeModalId)),t.data.nodeModal){var o=t.data.nodeModal;if(o.show(),t.data.workValues){o.editContent(e.extend(t.data.workValues,{layerName:t.name}));var a=t.data.workValues.group;if(a)for(var r=a.split(","),s=0;s<r.length;s++)o.$form.find('[value="'+r[s]+'"]')||n.deleteNode(t.name+"_"+r[s]);console.info("workValues="+JSON.stringify(t.data.workValues))}else console.info("workValues is null")}},mouseover:function(o){var a="top:"+(o.eventY-60)+"px;left:"+t.x+"px;",s=o.name.split("_"),l=s.pop(),d=o.data.desc;if(l&&l.length>30){var c=i.getLayer(s.join("_")).data;c.nodeModal===!1&&c.nodeModalId&&(c.nodeModal=n.workflowModal.generateNodeModal(c.nodeModalId)),d="分组来自："+e('[value="'+l+'"]').parent("label").text()}e("#canvases").append('<div class="infoLayer" style="'+a+'">'+d+"</div>"),i.trigger(r.MouseOverNode,o.data),console.info(o.data.id+"-"+o.name)},mouseout:function(){var t=e(".infoLayer");t&&t.length>0&&t.remove()}}),t.dependName)N=""+N;else for(var O=0;x>O;O++){var S,_=k(t,t.outCount,O+1);S="advanced-group-flow"==t.type?h(T,t.ports[O]):h(T,f(t,O+1));var M={name:S,color:m};M=n.buildPlusNode(M,_);var I=n.drawPlusRect(M);n.drawLine(t,I,O+1,b)}if(i.drawText({layer:!0,groups:[T],name:p(T),fillStyle:b,strokeWidth:2,x:t.x,y:t.y+g/2+n.getOption("textInterval"),fontSize:"8pt",fontFamily:"Microsoft YaHei,IconFont,sans-serif",text:N}),l==u.length-1){var R=function(){return function(){n.moveRect()}};setTimeout(R(),100),o&&"function"==typeof o&&o.apply(n,a)}}),i.trigger(r.AddNode,t)},L.prototype.drawSelected=function(e){var t=this,o=this.getOption("nodeSize");this.setOption("selected",e);var a=i.getLayer(e),n="workflow-selected",s=i.getLayer(n);s&&i.removeLayer(s);var l={layer:!0,name:n,strokeWidth:2,strokeStyle:"rgb(0,0,255)",x:a.x,y:a.y,radius:parseInt(o/2)+4,click:function(){i.triggerLayerEvent(t.getOption("selected"),"click")},dblclick:function(){i.triggerLayerEvent(t.getOption("selected"),"dblclick")}};i.drawArc(l),i.trigger(r.SelectNode,a.data)},L.prototype.removeSelected=function(){this.setOption("selected","");var e="workflow-selected",t=i.getLayer(e);t&&i.removeLayer(t)},L.prototype.drawLine=function(e,t,o,a){var n=c(t.name),s=b(e,e.outCount,o),l=T(t),d={layer:!0,data:{sid:e.id,did:t.id||"",nodeDrawType:"line",port:o,sNode:e,dNode:t},name:n,strokeStyle:a||"gray",strokeWidth:2,strokeDash:[5],rounded:!0,mouseover:function(e){i.trigger(r.MouseOverLine,e.data)}},u=[s];if(s[1]!=l[1]){var p=s[0]+(l[0]-s[0])/2;u.push([p,s[1]]),u.push([p,l[1]])}u.push(l);for(var m=0;m<u.length;m+=1)d["x"+(m+1)]=u[m][0],d["y"+(m+1)]=u[m][1];i.drawLine(d),i.moveLayer(n,0)},L.prototype.movePlusRect=function(e,t){var o=i.getLayer(w(e));if(o){i.setLayer(o,{y:t}),i.setLayer(u(e),{y:t});var a=i.getLayer(c(e));a&&(a.hasOwnProperty("y3")?i.setLayer(a,{y3:t,y4:t}):i.setLayer(a,{y2:t}))}else console.info("Did not found "+e+" plus.")},L.prototype.moveCommonRect=function(e,t){var o=this.getOption("nodeSize"),a=i.getLayer(e);if(a){var n=t-a.y;i.setLayer(a,{y:t}),i.setLayer(m(e),{y:t}),i.setLayer(p(e),{y:t+o/2+this.getOption("textInterval")});var r=i.getLayer(c(e));r&&(r.hasOwnProperty("y3")?i.setLayer(r,{y3:t,y4:t}):i.setLayer(r,{y2:t}),r.data.did=a.data.id);for(var s=parseInt(a.data.outCount),l=0;s>l;l++){var d=h(e,f(a.data,l+1)),u=i.getLayer(c(d));u&&(u.hasOwnProperty("y3")?i.setLayer(u,{y1:u.y1+n,y2:u.y2+n}):i.setLayer(u,{y1:u.y1+n}))}}},L.prototype.moveRect=function(){var e=this,t=this.getOption("maxColumn"),o=this.getOption("nodeSize"),a=this.getOption("verticalInterval"),n=this.getOption("horizontalInterval"),s=x(i).sort(N),l=a*(s.length+1)*o,d=((t+1)*n+1)*o;l>i[0].height&&(i[0].height=l),d>i[0].width&&(i[0].width=d);var c=parseInt((i[0].height-l)/2);i.drawLayers();for(var u=0;u<s.length;u++){var p=s[u],m=(u+1)*a*o+c;g(p.name)?e.movePlusRect(p.data.name,m):e.moveCommonRect(p.name,m)}i.drawLayers();for(var f=t-1;f>-1;f--){var h="c_"+f,w=i.getLayerGroup(h);if(w){w=w.sort(N);for(var y=0;y<w.length;y++){var v=w[y];if(!g(v.name)){var k=C(i,v.name,1);if(k){var b=parseInt(v.data.outCount),T=0;if(b%2==0){var F=C(i,v.name,b/2),L=C(i,v.name,b/2+1);T=parseInt((F.y+L.y)/2)}else T=C(i,v.name,(b+1)/2).y;e.moveCommonRect(v.name,T)}}}}}e.removeSelected(),i.drawLayers({clear:!0}),i.click(),i.trigger(r.MoveNode)},L.prototype.shakeRect=function(e){i.animateLayerGroup(e,{y:"+=5"},50).animateLayerGroup(e,{y:"-=10"},100).animateLayerGroup(e,{y:"+=5"},50).animateLayerGroup(e,{x:"+=5"},50).animateLayerGroup(e,{x:"-=10"},100).animateLayerGroup(e,{x:"+=5"},50)},L.prototype.on=function(e,t){i.on(e,t)},L.prototype.off=function(e){i.off(e,callback)},"undefined"==typeof e.Workflow&&(e.Workflow=L,t.Workflow=L,o.Workflow=L,e.WorkflowEvent=r,t.WorkflowEvent=r,o.WorkflowEvent=r)}}(jQuery,window,document),$(function(){var e=function(){$(window).on("beforeunload",function(){return TxtContent.skipPrompt})},t=$("canvas");t.off().on("click",function(){e()}),t[0].width=$(".navbar").width()-50;var o=function(){var e=$("#wrapper").height()-250;$("#canvases").css({"max-height":e,"overflow-y":"auto"})};o();var a=XREWIN.getUrlParam("key"),n=XREWIN.getUrlParam("name"),r=new Workflow({key:a});if(null!=a){var i=WORKFLOW.getByIdWorkFlow(a),s=JSON.parse(i.content);r.loadNodes(s)}$("#show").click(function(){r.showThumbnail()}),$("#allEnd").click(function(){r.setAllPlusNodes(!0)}),$("#hide").click(function(){}),$("#publish").click(function(){i=WORKFLOW.publish(a),i&&swal(TxtContent.checkSuc,"","")}),$("#save").click(function(){var e=JSON.stringify(r.getNodes()),t=WORKFLOW.updateDiagram(e,n,a);void 0!=t&&t.length>0&&swal(TxtContent.saveSuc,"",""),$(window).off("beforeunload")}),$("#run").click(function(){var e=WORKFLOW.run(a);e&&swal(TxtContent.runSuc,"","")}),$("#stop").click(function(){var e=WORKFLOW.stop(a);e&&swal(TxtContent.stopSuc,"","")}),$("#clear").click(function(){r.clearCanvas()}),$("#remove").click(function(){var e=WORKFLOW.remove(a);e&&swal(TxtContent.clearSuc,"","")}),$("#delete").click(function(){r.deleteSelectedNode()}),$("#addWorkflow").click(function(){r.addWorkflow()}),$("#workflowReport").popup({id:"workflowReportDialog",title:TxtContent.work.title,elements:[{labelName:TxtContent.work.labelName1,type:"report",name:"buy_person_num"},{labelName:TxtContent.work.labelName2,type:"report",name:"buy_order_num"},{labelName:TxtContent.work.labelName3,type:"report",name:"buy_price"},{labelName:TxtContent.work.labelName4,type:"report",name:"buy_pct"},{labelName:TxtContent.work.labelName5,type:"report",name:"repurchasing"},{labelName:TxtContent.work.labelName6,type:"report",name:"un_buy_order_num"},{labelName:TxtContent.work.labelName7,type:"report",name:"un_buy_price"},{labelName:TxtContent.work.labelName8,type:"report",name:"un_buy_pct"},{labelName:TxtContent.work.labelName9,type:"report",name:"roi"}]}).on("click",function(){for(var e=$("#form_workflowReportDialog"),t=WORKFLOW.roiReport(),o=$("#form_workflowReportDialog").find("em"),a=0;a<o.length;a++)for(var n in t)t.hasOwnProperty(n)&&$(o[a]).attr("name")==n&&$(o[a]).text(t[n]);$("#subForm",e).css("display","none")})});