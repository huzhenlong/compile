{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["var once = require('once');\n\nvar noop = function() {};\n\nvar isRequest = function(stream) {\n\treturn stream.setHeader && typeof stream.abort === 'function';\n};\n\nvar eos = function(stream, opts, callback) {\n\tif (typeof opts === 'function') return eos(stream, null, opts);\n\tif (!opts) opts = {};\n\n\tcallback = once(callback || noop);\n\n\tvar ws = stream._writableState;\n\tvar rs = stream._readableState;\n\tvar readable = opts.readable || (opts.readable !== false && stream.readable);\n\tvar writable = opts.writable || (opts.writable !== false && stream.writable);\n\n\tvar onlegacyfinish = function() {\n\t\tif (!stream.writable) onfinish();\n\t};\n\n\tvar onfinish = function() {\n\t\twritable = false;\n\t\tif (!readable) callback();\n\t};\n\n\tvar onend = function() {\n\t\treadable = false;\n\t\tif (!writable) callback();\n\t};\n\n\tvar onclose = function() {\n\t\tif (readable && !(rs && rs.ended)) return callback(new Error('premature close'));\n\t\tif (writable && !(ws && ws.ended)) return callback(new Error('premature close'));\n\t};\n\n\tvar onrequest = function() {\n\t\tstream.req.on('finish', onfinish);\n\t};\n\n\tif (isRequest(stream)) {\n\t\tstream.on('complete', onfinish);\n\t\tstream.on('abort', onclose);\n\t\tif (stream.req) onrequest();\n\t\telse stream.on('request', onrequest);\n\t} else if (writable && !ws) { // legacy streams\n\t\tstream.on('end', onlegacyfinish);\n\t\tstream.on('close', onlegacyfinish);\n\t}\n\n\tstream.on('end', onend);\n\tstream.on('finish', onfinish);\n\tif (opts.error !== false) stream.on('error', callback);\n\tstream.on('close', onclose);\n\n\treturn function() {\n\t\tstream.removeListener('complete', onfinish);\n\t\tstream.removeListener('abort', onclose);\n\t\tstream.removeListener('request', onrequest);\n\t\tif (stream.req) stream.req.removeListener('finish', onfinish);\n\t\tstream.removeListener('end', onlegacyfinish);\n\t\tstream.removeListener('close', onlegacyfinish);\n\t\tstream.removeListener('finish', onfinish);\n\t\tstream.removeListener('end', onend);\n\t\tstream.removeListener('error', callback);\n\t\tstream.removeListener('close', onclose);\n\t};\n};\n\nmodule.exports = eos;"]}