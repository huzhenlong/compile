{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["var stream = require('readable-stream')\nvar eos = require('end-of-stream')\nvar inherits = require('inherits')\n\nvar SIGNAL_FLUSH = new Buffer([0])\n\nvar onuncork = function(self, fn) {\n  if (self._corked) self.once('uncork', fn)\n  else fn()\n}\n\nvar destroyer = function(self, end) {\n  return function(err) {\n    if (err) self.destroy(err.message === 'premature close' ? null : err)\n    else if (end && !self._ended) self.end()\n  }\n}\n\nvar end = function(ws, fn) {\n  if (!ws) return fn()\n  if (ws._writableState && ws._writableState.finished) return fn()\n  if (ws._writableState) return ws.end(fn)\n  ws.end()\n  fn()\n}\n\nvar toStreams2 = function(rs) {\n  return new (stream.Readable)({objectMode:true, highWaterMark:16}).wrap(rs)\n}\n\nvar Duplexify = function(writable, readable, opts) {\n  if (!(this instanceof Duplexify)) return new Duplexify(writable, readable, opts)\n  stream.Duplex.call(this, opts)\n\n  this._writable = null\n  this._readable = null\n  this._readable2 = null\n\n  this._forwardDestroy = !opts || opts.destroy !== false\n  this._forwardEnd = !opts || opts.end !== false\n  this._corked = 1 // start corked\n  this._ondrain = null\n  this._drained = false\n  this._forwarding = false\n  this._unwrite = null\n  this._unread = null\n  this._ended = false\n\n  this.destroyed = false\n\n  if (writable) this.setWritable(writable)\n  if (readable) this.setReadable(readable)\n}\n\ninherits(Duplexify, stream.Duplex)\n\nDuplexify.obj = function(writable, readable, opts) {\n  if (!opts) opts = {}\n  opts.objectMode = true\n  opts.highWaterMark = 16\n  return new Duplexify(writable, readable, opts)\n}\n\nDuplexify.prototype.cork = function() {\n  if (++this._corked === 1) this.emit('cork')\n}\n\nDuplexify.prototype.uncork = function() {\n  if (this._corked && --this._corked === 0) this.emit('uncork')\n}\n\nDuplexify.prototype.setWritable = function(writable) {\n  if (this._unwrite) this._unwrite()\n\n  if (this.destroyed) {\n    if (writable && writable.destroy) writable.destroy()\n    return\n  }\n\n  if (writable === null || writable === false) {\n    this.end()\n    return\n  }\n\n  var self = this\n  var unend = eos(writable, {writable:true, readable:false}, destroyer(this, this._forwardEnd))\n\n  var ondrain = function() {\n    var ondrain = self._ondrain\n    self._ondrain = null\n    if (ondrain) ondrain()\n  }\n\n  var clear = function() {\n    self._writable.removeListener('drain', ondrain)\n    unend()\n  }\n\n  if (this._unwrite) process.nextTick(ondrain) // force a drain on stream reset to avoid livelocks\n\n  this._writable = writable\n  this._writable.on('drain', ondrain)\n  this._unwrite = clear\n\n  this.uncork() // always uncork setWritable\n}\n\nDuplexify.prototype.setReadable = function(readable) {\n  if (this._unread) this._unread()\n\n  if (this.destroyed) {\n    if (readable && readable.destroy) readable.destroy()\n    return\n  }\n\n  if (readable === null || readable === false) {\n    this.push(null)\n    this.resume()\n    return\n  }\n\n  var self = this\n  var unend = eos(readable, {writable:false, readable:true}, destroyer(this))\n\n  var onreadable = function() {\n    self._forward()\n  }\n\n  var onend = function() {\n    self.push(null)\n  }\n\n  var clear = function() {\n    self._readable2.removeListener('readable', onreadable)\n    self._readable2.removeListener('end', onend)\n    unend()\n  }\n\n  this._drained = true\n  this._readable = readable\n  this._readable2 = readable._readableState ? readable : toStreams2(readable)\n  this._readable2.on('readable', onreadable)\n  this._readable2.on('end', onend)\n  this._unread = clear\n\n  this._forward()\n}\n\nDuplexify.prototype._read = function() {\n  this._drained = true\n  this._forward()\n}\n\nDuplexify.prototype._forward = function() {\n  if (this._forwarding || !this._readable2 || !this._drained) return\n  this._forwarding = true\n\n  var data\n  var state = this._readable2._readableState\n\n  while ((data = this._readable2.read(state.buffer.length ? state.buffer[0].length : state.length)) !== null) {\n    this._drained = this.push(data)\n  }\n\n  this._forwarding = false\n}\n\nDuplexify.prototype.destroy = function(err) {\n  if (this.destroyed) return\n  this.destroyed = true\n\n  var self = this\n  process.nextTick(function() {\n    self._destroy(err)\n  })\n}\n\nDuplexify.prototype._destroy = function(err) {\n  if (err) {\n    var ondrain = this._ondrain\n    this._ondrain = null\n    if (ondrain) ondrain(err)\n    else this.emit('error', err)\n  }\n\n  if (this._forwardDestroy) {\n    if (this._readable && this._readable.destroy) this._readable.destroy()\n    if (this._writable && this._writable.destroy) this._writable.destroy()\n  }\n\n  this.emit('close')\n}\n\nDuplexify.prototype._write = function(data, enc, cb) {\n  if (this.destroyed) return cb()\n  if (this._corked) return onuncork(this, this._write.bind(this, data, enc, cb))\n  if (data === SIGNAL_FLUSH) return this._finish(cb)\n  if (!this._writable) return cb()\n\n  if (this._writable.write(data) === false) this._ondrain = cb\n  else cb()\n}\n\n\nDuplexify.prototype._finish = function(cb) {\n  var self = this\n  this.emit('preend')\n  onuncork(this, function() {\n    end(self._forwardEnd && self._writable, function() {\n      // haxx to not emit prefinish twice\n      if (self._writableState.prefinished === false) self._writableState.prefinished = true\n      self.emit('prefinish')\n      onuncork(self, cb)\n    })\n  })\n}\n\nDuplexify.prototype.end = function(data, enc, cb) {\n  if (typeof data === 'function') return this.end(null, null, data)\n  if (typeof enc === 'function') return this.end(data, null, enc)\n  this._ended = true\n  if (data) this.write(data)\n  if (!this._writableState.ending) this.write(SIGNAL_FLUSH)\n  return stream.Writable.prototype.end.call(this, cb)\n}\n\nmodule.exports = Duplexify\n"]}