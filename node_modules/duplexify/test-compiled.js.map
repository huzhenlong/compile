{"version":3,"sources":["test.js"],"names":[],"mappings":"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","file":"test-compiled.js","sourcesContent":["var tape = require('tape')\nvar through = require('through2')\nvar concat = require('concat-stream')\nvar duplexify = require('./')\n\ntape('passthrough', function(t) {\n  t.plan(2)\n\n  var pt = through()\n  var dup = duplexify(pt, pt)\n\n  dup.end('hello world')\n  dup.on('finish', function() {\n    t.ok(true, 'should finish')\n  })\n  dup.pipe(concat(function(data) {\n    t.same(data.toString(), 'hello world', 'same in as out')\n  }))\n})\n\ntape('passthrough + double end', function(t) {\n  t.plan(2)\n\n  var pt = through()\n  var dup = duplexify(pt, pt)\n\n  dup.end('hello world')\n  dup.end()\n\n  dup.on('finish', function() {\n    t.ok(true, 'should finish')\n  })\n  dup.pipe(concat(function(data) {\n    t.same(data.toString(), 'hello world', 'same in as out')\n  }))\n})\n\ntape('async passthrough + end', function(t) {\n  t.plan(2)\n\n  var pt = through.obj({highWaterMark:1}, function(data, enc, cb) {\n    setTimeout(function() {\n      cb(null, data)\n    }, 100)\n  })\n\n  var dup = duplexify(pt, pt)\n\n  dup.write('hello ')\n  dup.write('world')\n  dup.end()\n\n  dup.on('finish', function() {\n    t.ok(true, 'should finish')\n  })\n  dup.pipe(concat(function(data) {\n    t.same(data.toString(), 'hello world', 'same in as out')\n  }))\n})\n\ntape('duplex', function(t) {\n  var readExpected = ['read-a', 'read-b', 'read-c']\n  var writeExpected = ['write-a', 'write-b', 'write-c']\n\n  t.plan(readExpected.length+writeExpected.length+2)\n\n  var readable = through.obj()\n  var writable = through.obj(function(data, enc, cb) {\n    t.same(data, writeExpected.shift(), 'onwrite should match')\n    cb()\n  })\n\n  var dup = duplexify.obj(writable, readable)\n\n  readExpected.slice().forEach(function(data) {\n    readable.write(data)\n  })\n  readable.end()\n\n  writeExpected.slice().forEach(function(data) {\n    dup.write(data)\n  })\n  dup.end()\n\n  dup.on('data', function(data) {\n    t.same(data, readExpected.shift(), 'ondata should match')\n  })\n  dup.on('end', function() {\n    t.ok(true, 'should end')\n  })\n  dup.on('finish', function() {\n    t.ok(true, 'should finish')\n  })\n})\n\ntape('async', function(t) {\n  var dup = duplexify()\n  var pt = through()\n\n  dup.pipe(concat(function(data) {\n    t.same(data.toString(), 'i was async', 'same in as out')\n    t.end()\n  }))\n\n  dup.write('i')\n  dup.write(' was ')\n  dup.end('async')\n\n  setTimeout(function() {\n    dup.setWritable(pt)\n    setTimeout(function() {\n      dup.setReadable(pt)\n    }, 50)\n  }, 50)\n})\n\ntape('destroy', function(t) {\n  t.plan(2)\n\n  var write = through()\n  var read = through()\n  var dup = duplexify(write, read)\n\n  write.destroy = function() {\n    t.ok(true, 'write destroyed')\n  }\n\n  dup.on('close', function() {\n    t.ok(true, 'close emitted')\n  })\n\n  dup.destroy()\n  dup.destroy() // should only work once\n})\n\ntape('destroy both', function(t) {\n  t.plan(3)\n\n  var write = through()\n  var read = through()\n  var dup = duplexify(write, read)\n\n  write.destroy = function() {\n    t.ok(true, 'write destroyed')\n  }\n\n  read.destroy = function() {\n    t.ok(true, 'read destroyed')\n  }\n\n  dup.on('close', function() {\n    t.ok(true, 'close emitted')\n  })\n\n  dup.destroy()\n  dup.destroy() // should only work once\n})\n\ntape('bubble read errors', function(t) {\n  t.plan(2)\n\n  var write = through()\n  var read = through()\n  var dup = duplexify(write, read)\n\n  dup.on('error', function(err) {\n    t.same(err.message, 'read-error', 'received read error')\n  })\n  dup.on('close', function() {\n    t.ok(true, 'close emitted')\n  })\n\n  read.emit('error', new Error('read-error'))\n  write.emit('error', new Error('write-error')) // only emit first error\n})\n\ntape('bubble write errors', function(t) {\n  t.plan(2)\n\n  var write = through()\n  var read = through()\n  var dup = duplexify(write, read)\n\n  dup.on('error', function(err) {\n    t.same(err.message, 'write-error', 'received write error')\n  })\n  dup.on('close', function() {\n    t.ok(true, 'close emitted')\n  })\n\n  write.emit('error', new Error('write-error'))\n  read.emit('error', new Error('read-error')) // only emit first error\n})\n\ntape('reset writable / readable', function(t) {\n  t.plan(3)\n\n  var toUpperCase = function(data, enc, cb) {\n    cb(null, data.toString().toUpperCase())\n  }\n\n  var passthrough = through()\n  var upper = through(toUpperCase)\n  var dup = duplexify(passthrough, passthrough)\n\n  dup.once('data', function(data) {\n    t.same(data.toString(), 'hello')\n    dup.setWritable(upper)\n    dup.setReadable(upper)\n    dup.once('data', function(data) {\n      t.same(data.toString(), 'HELLO')\n      dup.once('data', function(data) {\n        t.same(data.toString(), 'HI')\n        t.end()\n      })\n    })\n    dup.write('hello')\n    dup.write('hi')\n  })\n  dup.write('hello')\n})\n\ntape('cork', function(t) {\n  var passthrough = through()\n  var dup = duplexify(passthrough, passthrough)\n  var ok = false\n\n  dup.on('prefinish', function() {\n    dup.cork()\n    setTimeout(function() {\n      ok = true\n      dup.uncork()\n    }, 100)\n  })\n  dup.on('finish', function() {\n    t.ok(ok)\n    t.end()\n  })\n  dup.end()\n})\n\ntape('prefinish not twice', function(t) {\n  var passthrough = through()\n  var dup = duplexify(passthrough, passthrough)\n  var prefinished = false\n\n  dup.on('prefinish', function() {\n    t.ok(!prefinished, 'only prefinish once')\n    prefinished = true\n  })\n\n  dup.on('finish', function() {\n    t.end()\n  })\n\n  dup.end()\n})\n\ntape('close', function(t) {\n  var passthrough = through()\n  var dup = duplexify(passthrough, passthrough)\n  var ok = false\n\n  passthrough.emit('close')\n  dup.on('close', function() {\n    t.ok(true, 'should forward close')\n    t.end()\n  })\n})"]}