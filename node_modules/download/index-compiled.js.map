{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["'use strict';\nvar path = require('path');\nvar url = require('url');\nvar caw = require('caw');\nvar concatStream = require('concat-stream');\nvar decompress = require('gulp-decompress');\nvar eachAsync = require('each-async');\nvar filenamify = require('filenamify');\nvar got = require('got');\nvar isUrl = require('is-url');\nvar objectAssign = require('object-assign');\nvar readAllStream = require('read-all-stream');\nvar rename = require('gulp-rename');\nvar streamCombiner = require('stream-combiner2');\nvar PassThrough = require('readable-stream/passthrough');\nvar Vinyl = require('vinyl');\nvar vinylFs = require('vinyl-fs');\nvar Ware = require('ware');\n\n/**\n * Initialize a new `Download`\n *\n * @param {Object} opts\n * @api public\n */\n\nfunction Download(opts) {\n\tif (!(this instanceof Download)) {\n\t\treturn new Download(opts);\n\t}\n\n\tthis.opts = objectAssign({encoding: null}, opts);\n\tthis.ware = new Ware();\n}\n\nmodule.exports = Download;\n\n/**\n * Get or set URL to download\n *\n * @param {String} url\n * @param {String} dest\n * @api public\n */\n\nDownload.prototype.get = function (url, dest) {\n\tif (!arguments.length) {\n\t\treturn this._get;\n\t}\n\n\tthis._get = this._get || [];\n\tthis._get.push({\n\t\turl: url,\n\t\tdest: dest\n\t});\n\n\treturn this;\n};\n\n/**\n * Get or set the destination folder\n *\n * @param {String} dir\n * @api public\n */\n\nDownload.prototype.dest = function (dir) {\n\tif (!arguments.length) {\n\t\treturn this._dest;\n\t}\n\n\tthis._dest = dir;\n\treturn this;\n};\n\n/**\n * Rename the downloaded file\n *\n * @param {Function|String} name\n * @api public\n */\n\nDownload.prototype.rename = function (name) {\n\tif (!arguments.length) {\n\t\treturn this._rename;\n\t}\n\n\tthis._rename = name;\n\treturn this;\n};\n\n/**\n * Add a plugin to the middleware stack\n *\n * @param {Function} plugin\n * @api public\n */\n\nDownload.prototype.use = function (plugin) {\n\tthis.ware.use(plugin);\n\treturn this;\n};\n\n/**\n * Run\n *\n * @param {Function} cb\n * @api public\n */\n\nDownload.prototype.run = function (cb) {\n\tcb = cb || function () {};\n\tvar files = [];\n\n\teachAsync(this.get(), function (get, i, done) {\n\t\tif (!isUrl(get.url)) {\n\t\t\tdone(new Error('Specify a valid URL'));\n\t\t\treturn;\n\t\t}\n\n\t\tvar protocol = url.parse(get.url).protocol;\n\t\tif (protocol) {\n\t\t\tprotocol = protocol.slice(0, -1);\n\t\t}\n\t\tvar agent = caw(this.opts.proxy, {protocol: protocol});\n\t\tvar stream = got.stream(get.url, objectAssign(this.opts, {agent: agent}));\n\n\t\tstream.on('response', function (res) {\n\t\t\tstream.headers = res.headers;\n\t\t\tstream.statusCode = res.statusCode;\n\t\t\tthis.ware.run(stream, get.url);\n\t\t}.bind(this));\n\n\t\tvar hasHttpError = false;\n\n\t\treadAllStream(stream, null, function (err, data) {\n\t\t\tif (hasHttpError) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (err) {\n\t\t\t\tif (err instanceof got.HTTPError) {\n\t\t\t\t\thasHttpError = true;\n\t\t\t\t}\n\n\t\t\t\tdone(err);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar dest = get.dest || this.dest();\n\t\t\tvar fileStream = this.createStream(this.createFile(get.url, data), dest);\n\n\t\t\tfileStream.on('error', done);\n\t\t\tfileStream.pipe(concatStream({encoding: 'object'}, function (items) {\n\t\t\t\tfiles = files.concat(items);\n\t\t\t\tdone();\n\t\t\t}));\n\t\t}.bind(this));\n\t}.bind(this), function (err) {\n\t\tif (err) {\n\t\t\tcb(err);\n\t\t\treturn;\n\t\t}\n\n\t\tcb(null, files);\n\t});\n};\n\n/**\n * Create vinyl file\n *\n * @param {String} url\n * @param {Buffer} data\n * @api private\n */\n\nDownload.prototype.createFile = function (url, data) {\n\treturn objectAssign(new Vinyl({\n\t\tcontents: data,\n\t\tpath: filenamify(path.basename(url))\n\t}), {url: url});\n};\n\n/**\n * Create stream\n *\n * @param {Object} file\n * @param {String} dest\n * @api private\n */\n\nDownload.prototype.createStream = function (file, dest) {\n\tvar stream = new PassThrough({objectMode: true});\n\tvar streams = [stream];\n\n\tstream.end(file);\n\n\tif (this.opts.extract) {\n\t\tstreams.push(decompress(this.opts));\n\t}\n\n\tif (this.rename()) {\n\t\tstreams.push(rename(this.rename()));\n\t}\n\n\tif (dest) {\n\t\tstreams.push(vinylFs.dest(dest, this.opts));\n\t}\n\n\treturn streamCombiner.obj(streams);\n};\n"]}