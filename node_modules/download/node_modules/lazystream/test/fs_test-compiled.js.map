{"version":3,"sources":["fs_test.js"],"names":[],"mappings":";;AACA,IAAI,SAAS,QAAQ,mBAAR,CAAb;AACA,IAAI,KAAK,QAAQ,IAAR,CAAT;AACA,IAAI,SAAS,WAAb;AACA,IAAI,WAAW,cAAf;AACA,IAAI,YAAY,SAAS,SAAzB;;AAEA,QAAQ,EAAR,GAAa;AACX,aAAW,mBAAS,IAAT,EAAe;AACxB,QAAI,MAAJ,EAAY,OAAZ;;AAEA,QAAI,WAAW,IAAI,OAAO,QAAX,CAAoB,YAAW;AAC3C,aAAO,GAAG,gBAAH,CAAoB,QAApB,EACL,EADK,CACF,MADE,EACM,UAAS,EAAT,EAAa;AACvB,iBAAS,EAAT;AACD,OAHK,EAIL,EAJK,CAIF,OAJE,EAIO,YAAW;AACrB,iBAAS,SAAT;AACA;AACF,OAPK,CAAP;AAQF,KATc,CAAf;;AAWA,QAAI,WAAW,IAAI,OAAO,QAAX,CAAoB,YAAW;AAC5C,aAAO,GAAG,iBAAH,CAAqB,SAArB,EACJ,EADI,CACD,MADC,EACO,UAAS,EAAT,EAAa;AACvB,kBAAU,EAAV;AACD,OAHI,EAIJ,EAJI,CAID,OAJC,EAIQ,YAAW;AACtB,kBAAU,SAAV;AACC;AACF,OAPI,CAAP;AAQD,KATc,CAAf;;AAWA,SAAK,MAAL,CAAY,CAAZ;;AAEA,SAAK,KAAL,CAAW,MAAX,EAAmB,SAAnB,EAA8B,4CAA9B;AACA,SAAK,KAAL,CAAW,OAAX,EAAoB,SAApB,EAA+B,8CAA/B;;AAEA,QAAI,CAAC,GAAG,UAAH,CAAc,MAAd,CAAL,EAA4B;AAC1B,SAAG,SAAH,CAAa,MAAb;AACD;AACD,QAAI,GAAG,UAAH,CAAc,SAAd,CAAJ,EAA8B;AAC5B,SAAG,UAAH,CAAc,SAAd;AACD;;AAED,aAAS,EAAT,CAAY,KAAZ,EAAmB,YAAW;AAAE;AAAS,KAAzC;AACA,aAAS,EAAT,CAAY,KAAZ,EAAmB,YAAW;AAAE;AAAS,KAAzC;;AAEA,QAAI,QAAQ,CAAZ;AACA,aAAS,IAAT,GAAgB;AACd,eAAS,CAAT;AACA,UAAI,SAAS,CAAb,EAAgB;AACd,YAAI,QAAQ,GAAG,YAAH,CAAgB,QAAhB,CAAZ;AACA,YAAI,SAAS,GAAG,YAAH,CAAgB,SAAhB,CAAb;;AAEA,aAAK,EAAL,CAAQ,SAAS,MAAT,IAAmB,SAAS,MAApC,EAA4C,iBAA5C;;AAEA,WAAG,UAAH,CAAc,SAAd;AACA,WAAG,SAAH,CAAa,MAAb;;AAEA,aAAK,IAAL;AACD;AACF;;AAED,aAAS,IAAT,CAAc,QAAd;AACD;AA1DU,CAAb","file":"fs_test-compiled.js","sourcesContent":["\nvar stream = require('../lib/lazystream');\nvar fs = require('fs');\nvar tmpDir = 'test/tmp/';\nvar readFile = 'test/data.md';\nvar writeFile = tmpDir + 'data.md';\n\nexports.fs = {\n  readwrite: function(test) {\n    var readfd, writefd;\n\n    var readable = new stream.Readable(function() {\n       return fs.createReadStream(readFile)\n        .on('open', function(fd) {\n          readfd = fd;\n        })\n        .on('close', function() {\n           readfd = undefined;\n           step();\n        });\n    });\n\n    var writable = new stream.Writable(function() {\n      return fs.createWriteStream(writeFile)\n        .on('open', function(fd) {\n          writefd = fd;\n        })\n        .on('close', function() {\n          writefd = undefined;\n           step();\n        });\n    });\n\n    test.expect(3);\n\n    test.equal(readfd, undefined, 'Input file should not be opened until read');\n    test.equal(writefd, undefined, 'Output file should not be opened until write');\n\n    if (!fs.existsSync(tmpDir)) {\n      fs.mkdirSync(tmpDir);\n    }\n    if (fs.existsSync(writeFile)) {\n      fs.unlinkSync(writeFile);\n    }\n\n    readable.on('end', function() { step(); });\n    writable.on('end', function() { step(); });\n\n    var steps = 0;\n    function step() {\n      steps += 1;\n      if (steps == 4) {\n        var input = fs.readFileSync(readFile);\n        var output = fs.readFileSync(writeFile);\n\n        test.ok(input >= output && input <= output, 'Should be equal');\n\n        fs.unlinkSync(writeFile);\n        fs.rmdirSync(tmpDir);\n\n        test.done();\n      }\n    };\n\n    readable.pipe(writable);\n  }\n};\n\n\n"]}