{"version":3,"sources":["individuation.js"],"names":[],"mappings":";;AAAC,CAAC,YAAY;;;AAGV,aAAS,MAAT,CAAgB,GAAhB,CAAoB,qBAApB,EAA2C,UAAU,MAAV,EAAkB;;;AAGzD,YAAI,OAAJ;;AAEA,YAAI,QAAQ,QAAQ,OAAO,OAAP,CAAe,KAAf,EAApB;;;AAGA,YAAI,WAAJ;;;AAGA,YAAI,cAAc,SAAd,WAAc,GAAY;AAC1B,mBAAO,EAAE,WAAF,EAAe,GAAf,EAAP;AACH,SAFD;;;AAKA,YAAI,0BAA0B,SAA1B,uBAA0B,GAAY;AACtC,gBAAI,eAAJ;AACA,gBAAI,oBAAoB,EAAxB;AACA,gBAAI,iBAAiB,EAAE,WAAF,EAAe,GAAf,EAArB;AACA,gBAAI,EAAE,oBAAF,EAAwB,EAAxB,CAA2B,UAA3B,CAAJ,EAA4C;AACxC,kCAAkB,EAAlB;AACA,oBAAI,QAAQ,OAAR,MAAqB,KAAzB,EAAgC;AAC5B,oCAAgB,GAAhB,GAAsB,cAAtB;AACH,iBAFD,MAEO;AACH,oCAAgB,IAAhB,GAAuB,cAAvB;AACH;AACD,gCAAgB,IAAhB,GAAuB,EAAE,cAAF,EAAkB,GAAlB,EAAvB;AACH,aARD,MAQO;AACH,kCAAkB,cAAlB;AACH;;AAED,8BAAkB,YAAlB,GAAiC,KAAK,SAAL,CAAe,eAAf,CAAjC;AACA,8BAAkB,WAAlB,GAAgC,QAAQ,OAAR,MAAqB,KAArB,GAA6B,KAA7B,GAAqC,QAArE;AACA,8BAAkB,QAAlB,GAA6B,aAA7B;AACA,8BAAkB,QAAlB,GAA6B,EAAE,iBAAF,EAAqB,IAArB,MAA+B,CAA5D;;AAEA,8BAAkB,WAAlB,GAAgC,EAAhC;AACA,gBAAI,OAAO,EAAE,cAAF,CAAX;AACA,iBAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,KAAK,MAAzB,EAAiC,GAAjC,EAAsC;AAClC,oBAAI,QAAQ,EAAZ;AACA,oBAAI,OAAO,EAAE,KAAK,CAAL,CAAF,CAAX;AACA,sBAAM,aAAN,GAAsB,KAAK,IAAL,CAAU,aAAV,EAAyB,IAAzB,EAAtB;AACA,oBAAI,kBAAkB,WAAlB,IAAiC,KAArC,EAA4C;AACxC,wBAAI,OAAO,KAAK,IAAL,CAAU,WAAV,CAAX;AACA,0BAAM,GAAN,GAAY,KAAK,IAAL,CAAU,SAAV,EAAqB,GAArB,EAAZ;AACA,0BAAM,IAAN,GAAa,KAAK,IAAL,CAAU,WAAV,EAAuB,GAAvB,EAAb;AACH,iBAJD,MAIO;AACH,wBAAI,OAAO,KAAK,IAAL,CAAU,WAAV,CAAX;AACA,0BAAM,GAAN,GAAY,KAAK,IAAL,CAAU,SAAV,EAAqB,GAArB,EAAZ;AACA,0BAAM,IAAN,GAAa,KAAK,IAAL,CAAU,WAAV,EAAuB,GAAvB,EAAb;AACH;;AAED,sBAAM,SAAN,GAAkB,gBAAgB,IAAhB,CAAlB;AACA,sBAAM,EAAN,GAAW,KAAK,IAAL,CAAU,IAAV,CAAX;AACA,kCAAkB,WAAlB,CAA8B,IAA9B,CAAmC,KAAnC;AACH;AACD,mBAAO,iBAAP;AACH,SA1CD;;;AA6CA,YAAI,YAAY,SAAZ,SAAY,GAAY;AACxB,gBAAI,UAAJ;AACA,gBAAI,YAAJ,EAAkB;AACd,6BAAa,YAAb;AACA,oBAAI,WAAW,YAAX,CAAwB,UAAxB,CAAJ,EAAyC;;AAErC,kCAAc,yBAAd,EAAyC,UAAzC;AACH,iBAHD,MAGO;;AAEH,gCAAY,yBAAZ,EAAuC,UAAvC;AACH;AACJ;AACJ,SAZD;;;AAeA,YAAI,UAAU,SAAV,OAAU,GAAY;AACtB,gBAAI,YAAJ,EAAkB;AACd,oBAAI,YAAY,aAAa,OAAb,EAAhB;AACA,oBAAI,QAAQ,gDAAZ;AACA,oBAAI,UAAU,OAAV,CAAkB,KAAlB,KAA4B,CAAC,CAAjC,EAAoC;AAChC,iCAAa,OAAb,CAAqB,QAAQ,SAAR,GAAoB,MAAzC;AACH;AACJ;AACJ,SARD;;;AAWA,YAAI,UAAU,SAAV,OAAU,GAAY;AACtB,gBAAI,YAAJ,EAAkB;AACd,oBAAI,YAAY,aAAa,OAAb,EAAhB;AACA,oBAAI,QAAQ,gDAAZ;AACA,6BAAa,OAAb,CAAqB,UAAU,OAAV,CAAkB,KAAlB,EAAyB,EAAzB,EAA6B,OAA7B,CAAqC,MAArC,EAA6C,EAA7C,CAArB;AACH;AACJ,SAND;;;AASA,YAAI,eAAe,uBAAuB,eAA1C;;;AAGA,YAAI,kBAAkB,uBAAuB,mBAA7C;;;AAGA,YAAI,iBAAiB,uBAAuB,cAA5C;;;AAGA,YAAI,cAAc,SAAd,WAAc,GAAY;AAC1B,gBAAI,QAAQ,SAAS,aAAT,CAAuB,KAAvB,CAAZ;AACA,kBAAM,SAAN,GAAkB,UAAlB;AACA,gBAAI,MAAM,EAAE,8BAAF,EAAkC,MAAlC,CAAyC,0EAA0E,WAAW,GAArF,GAA2F,UAA3F,GAC/C,0EAD+C,GAE/C,gIAF+C,GAEoF,WAAW,OAAX,CAAmB,QAFvG,GAEkH,UAFlH,GAG/C,kFAHM,CAAV;AAIA,gBAAI,OAAO,EAAE,8BAAF,EAAkC,MAAlC,CACP,0BACA,qEADA,GACwE,WAAW,OAAX,CAAmB,IAD3F,GACkG,WADlG,GAEA,wDAFA,GAGA,QAHA,GAIA,mGAJA,GAIsG,WAAW,OAAX,CAAmB,GAJzH,GAI+H,+BAJ/H,GAKA,2BALA,GAMA,QANA,GAOA,8HAPA,GAOiI,WAAW,OAAX,CAAmB,QAPpJ,GAO+J,wEARxJ,CAAX;AAUA,mBAAO,EAAE,KAAF,EAAS,MAAT,CAAgB,GAAhB,EAAqB,IAArB,CAAP;AACH,SAlBD;;;AAqBA,YAAI,eAAe,SAAf,YAAe,GAAY;AAC3B,gBAAI,KAAJ;AACA,gBAAI,cAAc,qDAAqD,WAAW,OAAX,CAAmB,aAAxE,GAAwF,GAAxF,GACd,kCADc,GAEd,yCAFc,GAE8B,WAAW,OAAX,CAAmB,GAFjD,GAEuD,SAFvD,GAGd,MAHc,GAId,8BAJc,GAImB,WAAW,OAAX,CAAmB,IAJtC,GAI6C,SAJ7C,GAKd,MALJ;AAMA,gBAAI,YAAY,gBAAhB;AACA,oBAAQ,EAAE,mCAAF,CAAR;AACA,gBAAI,eAAe,MAAM,MAAN,CAAa,SAAb,CAAnB;AACA,gBAAI,SAAS,QAAQ,WAAW,OAAX,CAAmB,GAA3B,GAAiC,sDAAjC,GACT,6CADS,GAET,MAFJ;AAGA,gBAAI,SAAS,QAAQ,WAAW,OAAX,CAAmB,OAA3B,GAAqC,OAAlD;AACA,gBAAI,QAAQ,aAAZ;AACA,gBAAI,UAAU,mDAAmD,WAAW,GAA9D,GAAoE,MAAlF;AACA,mBAAO,EAAE,iCAAF,EAAqC,MAArC,CAA4C,WAA5C,EAAyD,YAAzD,EAAuE,MAAvE,EAA+E,MAA/E,EAAuF,KAAvF,EAA8F,OAA9F,CAAP;AACH,SAlBD;;;AAqBA,YAAI,YAAY,SAAZ,SAAY,GAAY;;;AAGxB,gBAAI,MAAM,SAAS,aAAT,CAAuB,KAAvB,CAAV;AACA,gBAAI,YAAJ,CAAiB,IAAjB,EAAuB,KAAvB;AACA,gBAAI,SAAJ,GAAgB,WAAhB;;;AAGA,gBAAI,WAAW,YAAY,WAAW,OAAX,CAAmB,KAA/B,GAAuC,WAAvC,GACX,qFADW,GAEX,6CAFW,GAGX,yCAHW,GAIX,WAJJ;AAKA,gBAAI,WAAW,EAAE,+CAAF,EAAmD,MAAnD,CAA0D,QAA1D,CAAf;;;AAGA,gBAAI,YAAY,qBAAqB,WAAW,OAAX,CAAmB,MAAxC,GAAiD,4BAAjD,GACZ,oBADY,GACW,WAAW,OAAX,CAAmB,YAD9B,GAC6C,GAD7C,GAEZ,iEAFY,GAGZ,uGAHY,GAG8F,WAAW,OAAX,CAAmB,UAHjH,GAG8H,MAH9H,GAIZ,MAJY,GAKZ,6GALY,GAKoG,WAAW,OAAX,CAAmB,WALvH,GAKqI,WALrI,GAMZ,kEANY,GAOZ,yBAPY,GAOgB,WAAW,OAAX,CAAmB,OAPnC,GAO6C,MAP7C,GAQZ,kBARJ;;;AAWA,gBAAI,iBAAiB,cAArB;AACA,gBAAI,kBAAkB,EAAE,8BAAF,EAAkC,MAAlC,CAAyC,cAAzC,CAAtB;AACA,4BAAgB,GAAhB,CAAoB,EAAC,YAAY,MAAb,EAAqB,UAAU,OAA/B,EAApB;;;AAGA,cAAE,GAAF,EAAO,MAAP,CAAc,QAAd,EAAwB,SAAxB,EAAmC,eAAnC;AACA,mBAAO,IAAI,SAAX;AACH,SAlCD;;;AAqCA,YAAI,kBAAkB,SAAlB,eAAkB,CAAU,GAAV,EAAe;AACjC,gBAAI,MAAJ,GAAa,MAAb;AACH,SAFD;;;AAKA,YAAI,aAAa,SAAb,UAAa,GAAY;AACzB,gBAAI,aAAa,cAAjB;;AAEA,gBAAI,kBAAkB,EAAE,UAAF,EAAc,QAAd,CAAuB,EAAE,WAAF,CAAvB,CAAtB;AACA,gBAAI,QAAQ,gBAAgB,IAAhB,CAAqB,gBAArB,CAAZ;AACA,gBAAI,OAAJ,EAAa;AACT,oBAAI,QAAQ,gBAAgB,IAAhB,CAAqB,WAArB,CAAZ;AACA,oBAAI,QAAQ,OAAR,MAAqB,KAAzB,EAAgC;AAC5B,0BAAM,IAAN,CAAW,WAAX,EAAwB,IAAxB;AACA,0BAAM,IAAN,CAAW,WAAX,EAAwB,IAAxB;AACA,0BAAM,IAAN,CAAW,WAAX,EAAwB,IAAxB,CAA6B,SAA7B,EAAwC,IAAxC,CAA6C,QAA7C,EAAuD,YAAY;AAC/D,4BAAI,SAAS,MAAM,IAAN,CAAW,WAAX,EAAwB,IAAxB,CAA6B,SAA7B,EAAwC,GAAxC,EAAb;AACA,8BAAM,IAAN,CAAW,aAAX,EAA0B,IAA1B,CAA+B,KAA/B,EAAsC,MAAtC;AACH,qBAHD;AAIH,iBAPD,MAOO;AACH,0BAAM,IAAN,CAAW,WAAX,EAAwB,IAAxB;AACA,0BAAM,IAAN,CAAW,WAAX,EAAwB,IAAxB;AACH;AACJ;;;AAGD,cAAE,cAAF,EAAkB,eAAlB,EAAmC,MAAnC,GAA4C,IAA5C,CAAiD,OAAjD,EAA0D,YAAY;AAClE,gCAAgB,EAAE,IAAF,CAAhB;;AAEA,oBAAI,SAAS,EAAE,cAAF,EAAkB,eAAlB,CAAb;AACA,oBAAI,OAAO,MAAP,IAAiB,CAArB,EAAwB;AACpB,2BAAO,IAAP;AACH;AACJ,aAPD;;;AAUA,4BAAgB,IAAhB,CAAqB,cAArB,EAAqC,MAArC,GAA8C,IAA9C,CAAmD,OAAnD,EAA4D,YAAY;;AAEpE,oBAAI,UAAU,EAAE,gBAAF,EAAoB,QAApB,CAA6B,KAA7B,CAAd;AACA,oBAAI,UAAU,QAAQ,IAAR,CAAa,cAAb,CAAd;;;AAGA;;;AAGA,wBAAQ,MAAR,GAAiB,IAAjB,CAAsB,OAAtB,EAA+B,YAAY;AACvC,oCAAgB,EAAE,IAAF,CAAhB;AACA,wBAAI,SAAS,EAAE,cAAF,EAAkB,eAAlB,CAAb;;AAEA,wBAAI,OAAO,MAAP,IAAiB,CAArB,EAAwB;AACpB,+BAAO,IAAP;AACH,qBAFD,MAEO;AACH,+BAAO,IAAP;AACH;AACJ,iBATD;;AAWA,kBAAE,cAAF,EAAkB,eAAlB,EAAmC,IAAnC;AACH,aArBD;;;AAwBA,4BAAgB,IAAhB,CAAqB,UAArB,EAAiC,MAAjC,GAA0C,IAA1C,CAA+C,OAA/C,EAAwD,YAAY;AAChE,oBAAI,OAAO,EAAE,IAAF,CAAX;;AAEA,oBAAI,MAAM,gBAAgB,IAAhB,CAAqB,IAArB,CAAV;AACA,oBAAI,GAAJ,EAAS;AACL,gCAAY,2BAAZ,CAAwC,EAAC,MAAM,GAAP,EAAxC,EAAqD,YAAY;AAC7D,wCAAgB,IAAhB;;AAEA;AACH,qBAJD;AAKH,iBAND,MAMO;AACH,oCAAgB,IAAhB;AACH;AACJ,aAbD;;;AAgBA,4BAAgB,IAAhB,CAAqB,gBAArB,EAAuC,GAAvC,GAA6C,EAA7C,CAAgD,OAAhD,EAAyD,YAAY;;;AAGjE,oBAAI,eAAe,SAAf,YAAe,GAAY;AAC3B,wBAAI,YAAY,EAAhB;AACA,wBAAI,QAAQ,OAAR,MAAqB,KAAzB,EAAgC;AAC5B,kCAAU,KAAV,IAAmB,gBAAgB,IAAhB,CAAqB,WAArB,EAAkC,IAAlC,CAAuC,SAAvC,EAAkD,GAAlD,EAAnB;AACA,kCAAU,MAAV,IAAoB,gBAAgB,IAAhB,CAAqB,WAArB,EAAkC,IAAlC,CAAuC,WAAvC,EAAoD,GAApD,EAApB;AACH,qBAHD,MAGO;AACH,kCAAU,MAAV,IAAoB,gBAAgB,IAAhB,CAAqB,WAArB,EAAkC,IAAlC,CAAuC,SAAvC,EAAkD,GAAlD,EAApB;AACA,kCAAU,MAAV,IAAoB,gBAAgB,IAAhB,CAAqB,WAArB,EAAkC,IAAlC,CAAuC,WAAvC,EAAoD,GAApD,EAApB;AACH;AACD,wBAAI,UAAU,MAAV,CAAJ,EAAuB;AACnB,4BAAI,CAAC,aAAa,SAAb,CAAL,EAA8B;AAC1B,yCAAa,SAAb,IAA0B,UAAU,MAAV,CAA1B;AACH;AACD;AACH,qBALD,MAKO;AACH;AACH;AACD,2BAAO,KAAK,SAAL,CAAe,SAAf,CAAP;AACH,iBAlBD;;AAoBA,oBAAI,EAAE,aAAF,EAAiB,eAAjB,EAAkC,GAAlC,MAA2C,EAAE,UAAF,EAAc,eAAd,EAA+B,GAA/B,EAA/C,EAAqF;;AAEjF,wBAAI,YAAY,gBAAgB,IAAhB,CAAqB,IAArB,CAAhB;AACA,wBAAI,SAAJ,EAAe;;AAEX,4BAAI,WAAW,OAAO,QAAP,CAAgB;AAC3B,mCAAO,SADoB;AAE3B,0CAAc,gBAAgB,eAAhB,CAFa;AAG3B,yCAAa;AAHc,yBAAhB,CAAf;;AAMA,oCAAY,8BAAZ,CAA2C,QAA3C,EAAqD,YAAY;AAC7D,4CAAgB,IAAhB,CAAqB,aAArB,EAAoC,IAApC,CAAyC,KAAK,IAAL,CAAU,KAAnD;;AAEA;AACH,yBAJD;AAKH,qBAbD,MAaO;;AAEH,4BAAI,WAAW,OAAO,QAAP,CAAgB;AAC3B,0CAAc,gBAAgB,eAAhB,CADa;AAE3B,uDAA2B,aAAa,YAAb,CAA0B,UAA1B,CAFA;AAG3B,yCAAa;AAHc,yBAAhB,CAAf;;AAMA,oCAAY,2BAAZ,CAAwC,QAAxC,EAAkD,YAAY;AAC1D,gCAAI,MAAM,KAAK,IAAf;AACA,gCAAI,IAAI,KAAR,EAAe;AACX,gDAAgB,IAAhB,CAAqB,aAArB,EAAoC,IAApC,CAAyC,IAAI,KAA7C;AACH;AACD,4CAAgB,IAAhB,CAAqB,IAArB,EAA2B,IAAI,GAA/B;;AAEA;AACH,yBARD;AASH;AACJ,iBAlCD,MAkCO;AACH,yBAAK,OAAL,EAAc,EAAd,EAAkB,SAAlB;AACH;AAEJ,aA7DD;;AA+DA,mBAAO,UAAP;AACH,SAvID;;;;;;AA6IA,YAAI,oBAAoB,SAApB,iBAAoB,CAAU,GAAV,EAAe;;AAEnC,gBAAI,YAAY,GAAhB;AACA,gBAAI,SAAJ,EAAe;AACX,oBAAI,UAAJ;AACA,oBAAI,UAAU,KAAd;AACA,oBAAI,QAAS,UAAU,aAAV,KAA4B,KAAzC;AACA,kBAAE,iBAAF,EAAqB,IAArB,CAA0B,UAAU,QAApC;AACA,oBAAI,iBAAiB,KAAK,KAAL,CAAW,UAAU,cAAV,CAAX,CAArB;AACA,oBAAI,OAAQ,cAAR,IAA0B,QAA9B,EAAwC;AACpC,iCAAa,cAAb;AACH,iBAFD,MAEO;AACH,8BAAU,IAAV;AACA,wBAAI,kBAAkB,cAAtB;AACA,wBAAI,KAAJ,EAAW;AACP,qCAAa,gBAAgB,GAA7B;AACH,qBAFD,MAEO;AACH,qCAAa,gBAAgB,IAA7B;AACH;AACD,sBAAE,cAAF,EAAkB,GAAlB,CAAsB,gBAAgB,MAAhB,CAAtB;AACA,sBAAE,oBAAF,EAAwB,IAAxB;AACA;AACH;AACD,oBAAI,qBAAqB,EAAE,WAAF,EAAe,GAAf,CAAmB,UAAnB,CAAzB;AACA,oBAAI,KAAJ,EAAW;AACP,sBAAE,iBAAF,EAAqB,KAArB,CAA2B,yGAA3B;AACA,uCAAmB,KAAnB,CAAyB,iDACrB,gDADqB,GAErB,yBAFqB,GAEO,UAFP,GAEoB,4BAFpB,GAGrB,gDAHJ;AAIH;;AAED,oBAAI,SAAS,KAAK,KAAL,CAAW,UAAU,WAArB,CAAb;AACA,qBAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,OAAO,MAA3B,EAAmC,GAAnC,EAAwC;AACpC,wBAAI,iBAAiB,EAAE,YAAF,CAArB;AACA,wBAAI,WAAW,IAAf;AACA,mCAAe,IAAf,CAAoB,IAApB,EAA0B,OAAO,CAAP,EAAU,EAApC;AACA,wBAAI,SAAS,eAAe,IAAf,CAAoB,gBAApB,CAAb;AACA,2BAAO,KAAP;AACA,mCAAe,IAAf,CAAoB,gBAApB,EAAsC,IAAtC,CAA2C,OAAO,CAAP,EAAU,aAArD;AACA,wBAAI,KAAJ,EAAW;AACP,4BAAI,OAAO,eAAe,IAAf,CAAoB,WAApB,CAAX;AACA,6BAAK,IAAL,CAAU,aAAV,EAAyB,IAAzB,CAA8B,KAA9B,EAAqC,OAAO,CAAP,EAAU,GAA/C;AACA,6BAAK,IAAL,CAAU,SAAV,EAAqB,GAArB,CAAyB,OAAO,CAAP,EAAU,GAAnC;AACA,mCAAW,KAAK,IAAL,CAAU,WAAV,CAAX;AACH,qBALD,MAKO;AACH,4BAAI,OAAO,eAAe,IAAf,CAAoB,WAApB,CAAX;AACA,6BAAK,IAAL,CAAU,SAAV,EAAqB,GAArB,CAAyB,OAAO,CAAP,EAAU,GAAnC;AACA,mCAAW,KAAK,IAAL,CAAU,WAAV,CAAX;AACH;AACD,wBAAI,OAAJ,EAAa;AACT,iCAAS,GAAT,CAAa,OAAO,CAAP,EAAU,IAAvB;AACH;;;AAGD,2CAAuB,aAAvB,CAAqC,OAAO,CAAP,CAArC,EAAgD,MAAhD;;AAEA,wBAAI,eAAe,eAAe,IAAf,CAAoB,gBAApB,CAAnB;AACA,iCAAa,IAAb,CAAkB,cAAlB,EAAkC,IAAlC,CAAuC,YAAY;AAC/C,4BAAI,OAAO,EAAE,IAAF,CAAX;AACA,6BAAK,EAAL,CAAQ,OAAR,EAAiB,YAAY;AACzB,4CAAgB,IAAhB;AACA,gCAAI,SAAS,aAAa,IAAb,CAAkB,cAAlB,CAAb;AACA,gCAAI,OAAO,MAAP,IAAiB,CAArB,EAAwB;AACpB,uCAAO,IAAP;AACH,6BAFD,MAEO;AACH,uCAAO,IAAP;AACH;AACJ,yBARD;AASH,qBAXD;;AAaA,wBAAI,aAAa,IAAb,CAAkB,cAAlB,EAAkC,MAAlC,IAA4C,CAAhD,EAAmD;AAC/C,0BAAE,cAAF,EAAkB,YAAlB,EAAgC,IAAhC;AACH;AACJ;;AAED,oBAAI,YAAY,EAAE,WAAF,CAAhB;AACA,0BAAU,OAAV,CAAkB,EAAC,MAAM,IAAP,EAAa,SAAS,OAAtB,EAAlB;AACA,0BAAU,EAAV,CAAa,iBAAb,EAAgC,YAAY;AACxC,wBAAI,OAAO,EAAE,IAAF,CAAX;AACA,yBAAK,IAAL,CAAU,YAAV,EAAwB,GAAxB,GAA8B,GAA9B,CAAkC,EAAC,YAAY,UAAb,EAAyB,WAAW,KAApC,EAAlC;AACA,+BAAW,YAAY;AACnB,6BAAK,KAAL;AACH,qBAFD,EAEG,IAFH;AAGH,iBAND;;AAQA,oBAAI,OAAJ,EAAa;AACT,sBAAE,oBAAF,EAAwB,IAAxB;AACH,iBAFD,MAGK;AACD,sBAAE,oBAAF,EAAwB,IAAxB;AACH;AACJ;AACJ,SA7FD;;;;;;AAmGA,YAAI,gBAAgB,SAAhB,aAAgB,CAAU,iBAAV,EAA6B,WAA7B,EAA0C;AAC1D,gBAAI,KAAK,YAAY,YAAZ,CAAyB,UAAzB,CAAT;AACA,gBAAI,EAAJ,EAAQ;AACJ,oBAAI,WAAW,OAAO,QAAP,CAAgB;AAC3B,mCAAe,kBAAkB,WADN;AAE3B,mCAAe,KAAK,SAAL,CAAe,kBAAkB,WAAjC,CAFY;AAG3B,gCAAY,kBAAkB,QAHH;AAI3B,2BAAO,EAJoB;AAK3B,oCAAgB,kBAAkB,YALP;AAM3B,gCAAY;AANe,iBAAhB,CAAf;;AASA,4BAAY,0BAAZ,CAAuC,QAAvC;AACH;AACJ,SAdD;;;;AAkBA,YAAI,YAAY,SAAZ,SAAY,CAAU,GAAV,EAAe,WAAf,EAA4B;AACxC,wBAAY,YAAZ,CAAyB,UAAzB,EAAqC,GAArC;AACH,SAFD;;;;;AAOA,YAAI,cAAc,SAAd,WAAc,CAAU,iBAAV,EAA6B,WAA7B,EAA0C;AACxD,gBAAI,KAAK,OAAO,QAAP,CAAgB;AACrB,+BAAe,OAAO,WAAP,CAAmB,KAAnB,CADM;AAErB,gCAAgB,OAFK;AAGrB,+BAAe,kBAAkB,WAHZ;AAIrB,+BAAe,KAAK,SAAL,CAAe,kBAAkB,WAAjC,CAJM;AAKrB,4BAAY,kBAAkB,QALT;AAMrB,gCAAgB,kBAAkB;AANb,aAAhB,CAAT;;;AAUA,wBAAY,uBAAZ,CAAoC,EAApC,EAAwC,YAAY;AAChD,0BAAU,KAAK,IAAf,EAAqB,WAArB;AACH,aAFD;AAGH,SAdD;;;AAiBA,YAAI,eAAe,IAAnB;;AAEA,eAAO;;AAEH,mBAAO,WAAW,OAAX,CAAmB,KAFvB;AAGH,uBAAW,SAAS,kBAHjB;AAIH,sBAAU,GAJP;AAKH,uBAAW,GALR;;AAOH,qBAAS,CAAC;AACN,sBAAM,QADA;AAEN,oBAAI,cAFE;AAGN,uBAAO,WAAW,YAHZ;AAIN,uBAAO,qEAJD;AAKN,yBAAS,mBAAY;AACjB,wBAAI,SAAJ,CAAc;AACV,8BAAM,cADI;AAEV,iCAAS,WAAW,WAFV;AAGV,oCAAY,CAAC;AACT,uCAAW,IADF;AAET,yCAAa,WAAW,YAFf;AAGT,oCAAQ,MAHC;AAIT,oCAAQ;AAJC,yBAAD,CAHF;AASV,0CAAkB,0BAAY;AAC1B,gCAAI,cAAc,OAAO,QAAP,CAAgB;AAC9B,gDAAgB,OADc;AAE9B,+CAAe,QAAQ,OAAR,MAAqB,KAArB,GAA6B,KAA7B,GAAqC,QAFtB;AAG9B,gDAAgB,0BAA0B,YAHZ;AAI9B,+CAAe,KAAK,SAAL,CAAe,0BAA0B,WAAzC;AAJe,6BAAhB,EAKf,mBALe,CAAlB;AAMA,wCAAY,uBAAZ,CAAoC,WAApC;AACH,yBAjBS;AAkBV,iCAAS,IAlBC;AAmBV,qCAAa,WAAW,OAnBd;AAoBV,qCAAa,WAAW;AApBd,qBAAd,EAqBG,IArBH;AAsBH;AA5BK,aAAD,EA8BL,SAAS,MAAT,CAAgB,QA9BX,EA+BL,SAAS,MAAT,CAAgB,YA/BX,EAgCL;AACI,sBAAM,QADV;AAEI,oBAAI,UAFR;AAGI,uBAAO,WAAW,OAHtB;AAII,uBAAO,wCAJX;AAKI,yBAAS,mBAAY;;AAEjB,wBAAI,WAAW,EAAE,cAAF,CAAf;AACA,6BAAS,IAAT,CAAc,YAAY;AACtB,4BAAI,OAAO,EAAE,IAAF,CAAX;AACA,4BAAI,YAAY,KAAK,IAAL,CAAU,IAAV,CAAhB;AACA,4BAAI,CAAC,SAAL,EAAgB;AACZ,iCAAK,IAAL,CAAU,gBAAV,EAA4B,OAA5B,CAAoC,OAApC;AACH;AACJ,qBAND;;;AASA,wBAAI,cAAc,SAAd,WAAc,GAAY;AAC1B,6BAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,SAAS,MAA7B,EAAqC,GAArC,EAA0C;AACtC,gCAAI,SAAS,EAAE,SAAS,CAAT,CAAF,EAAe,IAAf,CAAoB,IAApB,CAAb;AACA,gCAAI,CAAC,MAAL,EAAa;AACT,uCAAO,KAAP;AACH;AACJ;;AAED,oCAAY,OAAZ,CAAoB;AAChB,uDAA2B,aAAa,YAAb,CAA0B,UAA1B,CADX;AAEhB,wCAAY;AAFI,yBAApB,EAGG,YAAY;AACX,gCAAI,MAAM,KAAK,IAAf;AACA,8BAAE,iBAAF,EAAqB,IAArB,CAA0B,IAAI,KAA9B;AACA,8BAAE,cAAF,EAAkB,IAAlB,CAAuB,YAAY;AAC/B,oCAAI,OAAO,EAAE,IAAF,CAAX;AACA,oCAAI,SAAS,KAAK,IAAL,CAAU,IAAV,CAAb;AACA,qCAAK,IAAL,CAAU,aAAV,EAAyB,IAAzB,CAA8B,IAAI,MAAJ,CAA9B;AACH,6BAJD;;AAMA;AACH,yBAbD;AAcH,qBAtBD;;AAwBA,+BAAW,aAAX,EAA0B,IAA1B;AACH;AA1CL,aAhCK,CAPN;;AAqFH,sBAAU,CAAC;AACP,oBAAI,WADG;AAEP,uBAAO,EAFA;AAGP,uBAAO,EAHA;AAIP,0BAAU,CAAC;AACP,0BAAM,MADC;AAEP,0BAAM,aAAa,KAAb,GAAqB;AAFpB,iBAAD;AAJH,aAAD,CArFP;;;;AAiGH,oBAAQ,kBAAY;AAChB,oBAAI,MAAM,KAAK,UAAL,GAAkB,WAAlB,GAAgC,OAAhC,CAAwC,KAAxC,CAAV;AACA,oBAAI,OAAJ,CAAY,EAAZ;AACA,oBAAI,SAAJ,GAAgB,OAAhB,CAAwB,WAAxB;;AAEA,kBAAE,cAAF,EAAkB,MAAlB;AACA,oBAAI,YAAY,OAAO,YAAP,EAAhB;AACA,oBAAI,SAAS,UAAU,eAAV,EAAb;;AAEA,0BAAU,UAAU,eAAV,EAAV;;AAEA,oBAAI,CAAC,EAAE,QAAQ,SAAR,GAAoB,CAAtB,EAAyB,IAAzB,CAA8B,KAA9B,CAAD,IAAyC,CAAC,EAAE,QAAQ,CAAV,EAAa,IAAb,CAAkB,KAAlB,CAA1C,IAAsE,CAAC,QAAQ,QAAR,CAAiB,WAAjB,CAA3E,EAA0G;;AAEtG,wBAAI,SAAS,UAAW,IAAI,IAAJ,EAAD,CAAa,OAAb,EAAvB;AACA,wBAAI,UAAU,OAAO,QAAP,CAAgB,aAAhB,CAA8B,KAA9B,CAAd;AACA,4BAAQ,QAAR,CAAiB,UAAjB;AACA,4BAAQ,QAAR,CAAiB,QAAjB;AACA,4BAAQ,YAAR,CAAqB,IAArB,EAA2B,MAA3B;;AAEA,wBAAI,UAAU,OAAd,EAAuB;AACnB,4BAAI,QAAQ,OAAR,MAAqB,IAArB,IACG,QAAQ,OAAR,MAAqB,GADxB,IAEG,QAAQ,OAAR,MAAqB,MAFxB,IAGG,QAAQ,OAAR,MAAqB,QAHxB,IAIG,QAAQ,OAAR,MAAqB,IAJxB,IAKG,QAAQ,OAAR,MAAqB,IALxB,IAMG,QAAQ,OAAR,MAAqB,KAN5B,EAMmC;AAC/B,oCAAQ,OAAR,CAAgB,MAAhB;AACA,gCAAI,QAAQ,QAAQ,YAAR,GAAuB,OAAvB,CAA+B,MAA/B,EAAuC,QAAQ,YAAR,EAAvC,CAAZ;AACA,oCAAQ,OAAR,CAAgB,KAAhB;AACH;AACD,4BAAI,QAAQ,QAAR,CAAiB,UAAjB,CAAJ,EAAkC;AAC9B,oCAAQ,OAAR,CAAgB,MAAhB;AACA,mCAAO,QAAQ,SAAR,GAAoB,YAApB,GAAmC,OAAnC,CAA2C,MAA3C,EAAmD,QAAQ,YAAR,EAAnD,CAAP;AACA,oCAAQ,SAAR,GAAoB,OAApB,CAA4B,IAA5B;AACH;AACD,0BAAE,WAAF,EAAe,GAAf,CAAmB,MAAnB;AACA,0BAAE,cAAF,EAAkB,GAAlB,CAAsB,EAAE,QAAQ,CAAV,EAAa,IAAb,CAAkB,MAAlB,CAAtB;AACH;;AAED,wBAAI,OAAJ,EAAa;AACT,4BAAI,QAAQ,OAAR,MAAqB,KAAzB,EAAgC;AAC5B,8BAAE,cAAF,EAAkB,GAAlB,CAAsB,EAAE,QAAQ,CAAV,EAAa,MAAb,CAAoB,GAApB,EAAyB,IAAzB,CAA8B,MAA9B,CAAtB;AACA,gCAAI,CAAC,QAAQ,SAAR,GAAoB,QAApB,CAA6B,UAA7B,CAAL,EAA+C;AAC3C,oCAAI,MAAM,QAAQ,SAAR,EAAV;AACA,wCAAQ,QAAR,CAAiB,WAAjB;AACA,wCAAQ,QAAR,CAAiB,SAAjB,EAA4B,OAA5B;AACA,oCAAI,WAAW,QAAQ,QAAR,CAAiB,OAAjB,CAAf;AACA,oCAAI,OAAO,QAAQ,YAAR,EAAX;AACA,oCAAI,SAAS,KAAK,OAAL,CAAa,IAAb,EAAmB,SAAS,YAAT,EAAnB,CAAb;;AAEA,kCAAE,IAAI,CAAN,EAAS,MAAT,CAAgB,MAAhB;AACH;AACD,gCAAI,WAAW,EAAE,WAAF,CAAf;AACA,gCAAI,SAAS,QAAQ,YAAR,CAAqB,KAArB,CAAb;;AAEA,qCAAS,GAAT,CAAa,MAAb,EAAqB,KAArB,CAA2B,iDACvB,gDADuB,GAEvB,yBAFuB,GAEK,MAFL,GAEc,4BAFd,GAGvB,mBAHuB,GAGD,WAAW,KAHV,GAGkB,WAH7C;AAIA,8BAAE,iBAAF,EAAqB,KAArB,CAA2B,qEAAqE,WAAW,OAAX,CAAmB,SAAxF,GAAoG,QAA/H;AAEH,yBArBD,MAqBO;AACH,gCAAI,CAAC,MAAL,EAAa;AACT,yCAAS,QAAQ,OAAR,EAAT;AACA,wCAAQ,OAAR,CAAgB,MAAhB;AACA,uCAAO,QAAQ,SAAR,GAAoB,YAApB,GAAmC,OAAnC,CAA2C,MAA3C,EAAmD,QAAQ,YAAR,EAAnD,CAAP;AACA,wCAAQ,SAAR,GAAoB,OAApB,CAA4B,IAA5B;AACH,6BALD,MAKO,IAAI,UAAU,QAAQ,OAAR,MAAqB,GAAnC,EAAwC;AAC3C,wCAAQ,OAAR,CAAgB,MAAhB;AACA,uCAAO,QAAQ,SAAR,GAAoB,YAApB,GAAmC,OAAnC,CAA2C,MAA3C,EAAmD,QAAQ,YAAR,EAAnD,CAAP;AACA,wCAAQ,SAAR,GAAoB,OAApB,CAA4B,IAA5B;AACH;AACJ;AACD,uCAAe,OAAO,QAAP,CAAgB,OAAhB,CAAwB,MAAxB,CAAf;AACA,4BAAI,YAAJ,EAAkB;AACd,yCAAa,eAAb,CAA6B,IAA7B;AACH;;AAED;AACH;AACJ,iBAtED,MAsEO;AACH,wBAAI,OAAO,OAAX;AACA,wBAAI,QAAQ,OAAR,MAAqB,KAAzB,EAAgC;AAC5B,+BAAO,KAAK,SAAL,EAAP;AACH;AACD,wBAAI,KAAK,OAAL,MAAkB,GAAtB,EAA2B;AACvB,+BAAO,KAAK,SAAL,EAAP;AACH;AACD,wBAAI,MAAM,KAAK,YAAL,CAAkB,UAAlB,CAAV;AACA,mCAAe,IAAf;;AAEA,wBAAI,OAAO,IAAI,OAAJ,CAAY,OAAZ,KAAwB,CAAC,CAApC,EAAuC;;AAEnC,4BAAI,OAAO,YAAY,uBAAZ,CAAoC,EAAC,QAAQ,GAAT,EAApC,CAAX;AACA,sCAAc,KAAK,QAAnB;AACA,0CAAkB,IAAlB;AACH;AACJ;;AAED,oBAAI,YAAY,EAAE,WAAF,CAAhB;AACA,0BAAU,OAAV,CAAkB,EAAC,MAAM,IAAP,EAAa,SAAS,OAAtB,EAAlB;AACA,0BAAU,EAAV,CAAa,iBAAb,EAAgC,YAAY;AACxC,wBAAI,OAAO,EAAE,IAAF,CAAX;AACA,yBAAK,IAAL,CAAU,YAAV,EAAwB,GAAxB,GAA8B,GAA9B,CAAkC,EAAC,YAAY,UAAb,EAAyB,WAAW,KAApC,EAAlC;AACA,+BAAW,YAAY;AACnB,6BAAK,KAAL;AACH,qBAFD,EAEG,IAFH;AAGH,iBAND;;;AASA,kBAAE,aAAF,EAAiB,EAAjB,CAAoB,OAApB,EAA6B,YAAY;AACrC,wBAAI,qBAAqB,EAAE,oBAAF,EAAwB,IAAxB,EAAzB;AACA,wBAAI,mBAAmB,EAAnB,CAAsB,UAAtB,CAAJ,EAAuC;AACnC;AACH,qBAFD,MAEO;AACH;AACH;AACJ,iBAPD,EAOG,OAPH,CAOW,OAPX;;;AAUA,kBAAE,iBAAF,EAAqB,MAArB,GAA8B,IAA9B,CAAmC,OAAnC,EAA4C,YAAY;AACpD,wBAAI,QAAQ,EAAE,oBAAF,EAAwB,GAAxB,CAA4B,SAA5B,CAAZ;AACA,wBAAI,OAAO,EAAE,YAAF,CAAX;AACA,wBAAI,gBAAgB,KAAK,IAAL,CAAU,oBAAV,CAApB;AACA,wBAAI,SAAS,MAAb,EAAqB;AACjB,sCAAc,GAAd,CAAkB,SAAlB,EAA6B,MAA7B;AACH,qBAFD,MAEO;AACH,sCAAc,GAAd,CAAkB,SAAlB,EAA6B,OAA7B;AACH;AACD;;AAEA,sBAAE,cAAF,EAAkB,IAAlB,EAAwB,IAAxB;AACH,iBAZD;;;AAeA,kBAAE,MAAF,EAAU,EAAV,CAAa,cAAb,EAA6B,YAAY;AACrC,2BAAO,WAAW,UAAlB;AACH,iBAFD;;;;AAMA,oBAAI,kBAAkB,SAAlB,eAAkB,CAAU,GAAV,EAAe;AACjC,wBAAI,SAAS,EAAE,WAAF,CAAb;;AAEA,2BAAO,UAAP,CAAkB,GAAlB,EAAuB,KAAvB,EAA8B,MAA9B,EAAsC,MAAtC,EAA8C,OAA9C;AACA,2BAAO,EAAP,CAAU,QAAV,EAAoB,YAAY;AAC5B,4BAAI,OAAO,EAAE,IAAF,CAAX;AACA,4BAAI,QAAQ,KAAK,IAAL,CAAU,iBAAV,EAA6B,IAA7B,CAAkC,QAAlC,CAAZ;AACA,0BAAE,iBAAF,EAAqB,IAArB,CAA0B,SAAS,IAAT,GAAgB,CAAhB,GAAoB,KAA9C;AACH,qBAJD;AAMH,iBAVD;;AAYA,oBAAI,eAAe,aAAa,WAAb,CAAnB,EAA8C;AAC1C,+BAAW,SAAX,CAAqB,YAAY;AAC7B,4BAAI,MAAM,KAAK,IAAf;AACA,4BAAI,SAAS,EAAE,WAAF,CAAb;;AAEA,+BAAO,UAAP,CAAkB,GAAlB,EAAuB,KAAvB,EAA8B,MAA9B,EAAsC,MAAtC,EAA8C,OAA9C;AACA,+BAAO,IAAP,CAAY,QAAZ,EAAsB,IAAtB,CAA2B,YAAY;AACnC,gCAAI,OAAO,EAAE,IAAF,CAAX;AACA,gCAAI,QAAQ,KAAK,IAAL,CAAU,OAAV,CAAZ;AACA,gCAAI,UAAU,eAAe,aAAa,WAAb,CAAzB,CAAJ,EAAyD;AACrD,qCAAK,IAAL,CAAU,UAAV,EAAsB,UAAtB;AACA,kCAAE,iBAAF,EAAqB,IAArB,CAA0B,KAAK,IAAL,CAAU,QAAV,CAA1B;AACH;AACJ,yBAPD;AAQA,sCAAc,EAAd;AACH,qBAdD;AAeH,iBAhBD,MAgBO;AACH,+BAAW,SAAX,CAAqB,YAAY;AAC7B,wCAAgB,KAAK,IAArB;AACH,qBAFD;AAGH;;;AAGJ,aAlRE;;AAoRH,kBAAM,gBAAY;AACd;;AAEA,oBAAI,WAAW,EAAE,cAAF,CAAf;AACA,yBAAS,IAAT,CAAc,YAAY;AACtB,wBAAI,OAAO,EAAE,IAAF,CAAX;AACA,wBAAI,YAAY,KAAK,IAAL,CAAU,IAAV,CAAhB;AACA,wBAAI,CAAC,SAAL,EAAgB;AACZ,6BAAK,IAAL,CAAU,gBAAV,EAA4B,OAA5B,CAAoC,OAApC;AACH;AACJ,iBAND;AAOA,oBAAI,CAAC,EAAE,cAAF,EAAkB,GAAlB,EAAD,IAA4B,CAAC,aAAa,SAAb,CAAjC,EAA0D;AACtD;AACA,iCAAa,SAAb,IAA0B,EAA1B;AACH;AACJ;AAnSE,SAAP;AAqSH,KA9vBD;AA+vBH,CAlwBA","file":"individuation-compiled.js","sourcesContent":["﻿(function () {\r\n\r\n    //执行弹窗\r\n    CKEDITOR.dialog.add('individuationDialog', function (editor) {\r\n\r\n        //region 创建弹窗内容\r\n        var element;\r\n        //创建id\r\n        var divId = \"box\" + editor.element.getId();\r\n\r\n        //获取浏览器groupKey\r\n        var urlGroupKey;\r\n\r\n        //获取groupKey\r\n        var getGroupKey = function () {\r\n            return $(\"#vipGroup\").val();\r\n        };\r\n\r\n        //获取个性化数据\r\n        var createIndividuationData = function () {\r\n            var nonJumpHrefData;\r\n            var individuationData = {};\r\n            var personalityVal = $(\"#spanText\").val();\r\n            if ($(\".extendPersonality\").is(\":visible\")) {\r\n                nonJumpHrefData = {};\r\n                if (element.getName() == \"img\") {\r\n                    nonJumpHrefData.src = personalityVal;\r\n                } else {\r\n                    nonJumpHrefData.text = personalityVal;\r\n                }\r\n                nonJumpHrefData.href = $(\".nonJumpHref\").val();\r\n            } else {\r\n                nonJumpHrefData = personalityVal;\r\n            }\r\n\r\n            individuationData.nonNodeValue = JSON.stringify(nonJumpHrefData);\r\n            individuationData.settingType = element.getName() == \"img\" ? \"img\" : \"string\";\r\n            individuationData.groupKey = getGroupKey();\r\n            individuationData.nonCount = $(\".filterVipCount\").text() || 0;\r\n            //新规则数据\r\n            individuationData.settingJson = [];\r\n            var $set = $(\".settingJson\");\r\n            for (var i = 0; i < $set.length; i++) {\r\n                var rData = {};\r\n                var $box = $($set[i]);\r\n                rData.matchVipCount = $box.find(\".matchCount\").text();\r\n                if (individuationData.settingType == \"img\") {\r\n                    var $url = $box.find(\".indivUrl\");\r\n                    rData.con = $url.find(\".txtImg\").val();\r\n                    rData.href = $url.find(\".jumpHref\").val();\r\n                } else {\r\n                    var $txt = $box.find(\".indivTxt\");\r\n                    rData.con = $txt.find(\".txtImg\").val();\r\n                    rData.href = $txt.find(\".jumpHref\").val();\r\n                }\r\n\r\n                rData.condition = getConditionCon($box);\r\n                rData.id = $box.attr('id');\r\n                individuationData.settingJson.push(rData);\r\n            }\r\n            return individuationData;\r\n        };\r\n\r\n        //判断调用添加setting接口还是更新setting接口\r\n        var judgePort = function () {\r\n            var parentNode;\r\n            if (_settingSpan) {\r\n                parentNode = _settingSpan;\r\n                if (parentNode.getAttribute(\"data-nav\")) {\r\n                    //更新数据\r\n                    updateSetting(createIndividuationData(), parentNode);\r\n                } else {\r\n                    //添加数据\r\n                    addSettings(createIndividuationData(), parentNode);\r\n                }\r\n            }\r\n        };\r\n\r\n        //添加a标签\r\n        var addATag = function () {\r\n            if (_settingSpan) {\r\n                var innerHtml = _settingSpan.getHtml();\r\n                var begin = '<a href=\"#\" class=\"editorImg\" target=\"_blank\">';\r\n                if (innerHtml.indexOf(begin) == -1) {\r\n                    _settingSpan.setHtml(begin + innerHtml + '</a>');\r\n                }\r\n            }\r\n        };\r\n\r\n        //删除a标签\r\n        var delATag = function () {\r\n            if (_settingSpan) {\r\n                var innerHtml = _settingSpan.getHtml();\r\n                var begin = '<a href=\"#\" class=\"editorImg\" target=\"_blank\">';\r\n                _settingSpan.setHtml(innerHtml.replace(begin, '').replace('</a>', ''));\r\n            }\r\n        };\r\n\r\n        //级联条件\r\n        var appendOption = individuationCondition.uplinkCondition;\r\n\r\n        //获取条件内容\r\n        var getConditionCon = individuationCondition.getConditionContent;\r\n\r\n        //创建条件\r\n        var createConditon = individuationCondition.createConditon;\r\n\r\n        //创建个性化内容\r\n        var createIndiv = function () {\r\n            var inCon = document.createElement(\"div\");\r\n            inCon.className = \"indivCon\";\r\n            var txt = $(\"<div class='indivTxt'></div>\").append(\"<label style='display: inline-block;width: 50px;text-align: center;'>\" + TxtContent.txt + \"</label>\" +\r\n                \"<input type='text' class='txtImg' style='margin-left: 10px;width: 75%;'>\" +\r\n                \"<div class='extendPersonality' style='margin-top: 10px;'><label style='display: inline-block;width: 50px;text-align: center;'>\" + TxtContent.ckeitor.skipHref + \"</label>\" +\r\n                \"<input type='text' class='jumpHref' style='margin-left: 10px;width: 75%;'></div>\");\r\n            var link = $(\"<div class='indivUrl'></div>\").append(\r\n                \"<div class='linkBox'>\" +\r\n                \"<label style='width: 80px;text-align: right;display:inline-block;'>\" + TxtContent.ckeitor.href + \"：</label>\" +\r\n                \"<input type='text' class='txtImg' style='width: 71%;'>\" +\r\n                \"</div>\" +\r\n                \"<label style='width: 80px;text-align: right;display:inline-block;position: relative;top: -33px;'>\" + TxtContent.ckeitor.img + \"：</label><div class='imgBox'>\" +\r\n                \"<img class='previewImg'/>\" +\r\n                \"</div>\" +\r\n                \"<div class='extendPersonality' style='margin-top: 10px;'><label style='width: 80px;text-align: right;display:inline-block;'>\" + TxtContent.ckeitor.skipHref + \"：</label><input type='text' class='jumpHref' style='width: 71%'></div>\"\r\n            );\r\n            return $(inCon).append(txt, link);\r\n        };\r\n\r\n        //创建筛选结果盒子\r\n        var createFilter = function () {\r\n            var $wrap;\r\n            var titConditon = \"<p style='border-top: none;position: relative;'>\" + TxtContent.ckeitor.ruleCondition + \"：\" +\r\n                \"<a href='#' class='addConditon'>\" +\r\n                \"<span class='glyphicon glyphicon-plus'>\" + TxtContent.ckeitor.add + \"</span>\" +\r\n                \"</a>\" +\r\n                \"<span class='saveCondition'>\" + TxtContent.ckeitor.save + \"</span>\" +\r\n                \"</p>\";\r\n            var condition = createConditon();\r\n            $wrap = $(\"<div class='conditionWrap'></div>\");\r\n            var conditionBox = $wrap.append(condition);\r\n            var titVip = \"<p>\" + TxtContent.ckeitor.des + \"：<span class='matchCount' style='margin-right: 5px'>\" +\r\n                \"<span class='matchVipCount'>0</span></span>\" +\r\n                \"</p>\";\r\n            var titCon = \"<p>\" + TxtContent.ckeitor.content + \"：</p>\";\r\n            var indiv = createIndiv();\r\n            var delRule = \"<a href='javascript:void(0);' class='DelRule'>\" + TxtContent.del + \"</a>\";\r\n            return $(\"<div class='settingJson'></div>\").append(titConditon, conditionBox, titVip, titCon, indiv, delRule);\r\n        };\r\n\r\n        //创建弹窗\r\n        var createEle = function () {\r\n\r\n            //弹窗盒子\r\n            var Box = document.createElement(\"div\");\r\n            Box.setAttribute(\"id\", divId);\r\n            Box.className = \"filterBox\";\r\n\r\n            //分组盒子\r\n            var groupCon = \"<lable>\" + TxtContent.ckeitor.group + \"：</lable>\" +\r\n                \"<select name='smartgroupKey' id='vipGroup' style='display: block;padding: 6px 12px;\" +\r\n                \"width: 100%;margin-top: 5px;height: 30px;'>\" +\r\n                \"<option value='' count=''>所有会员</option>\" +\r\n                \"</select>\";\r\n            var groupBox = $(\"<div class='groupKey'></div><hr class='one'/>\").append(groupCon);\r\n\r\n            //不符合条件的vip\r\n            var filterVip = \"<p id='spanCon'>\" + TxtContent.ckeitor.defCon + \"：<input id='spanText'></p>\" +\r\n                \"<p id='filterVip'>\" + TxtContent.ckeitor.nonRuleCount + \"：\" +\r\n                \"<span class='filterVipCount' style='margin-right: 5px;'></span>\" +\r\n                \"<a id='extendHref' href='javascript:void(0);' style='color:#23C6C8;margin-left: 20px;display: none;'>\" + TxtContent.ckeitor.extendHref + \"</a>\" +\r\n                \"</p>\" +\r\n                '<div class=\"extendPersonality\" style=\"margin-top: 10px;\"><label style=\"margin-left: 20px;font-size: 14px;\">' + TxtContent.ckeitor.defSkipHref + '：</label>' +\r\n                '<input type=\"text\" class=\"nonJumpHref\" style=\"width: 80%\"></div>' +\r\n                \"<a id='addsettingJson'>\" + TxtContent.ckeitor.addRule + \"</a>\" +\r\n                '<hr class=\"one\">';\r\n\r\n            //创建筛选结果盒子\r\n            var settingJsonBox = createFilter();\r\n            var settingJsonWrap = $(\"<div class='ruleWrap'></div>\").append(settingJsonBox);\r\n            settingJsonWrap.css({\"overflow\": \"auto\", \"height\": \"500px\"});\r\n\r\n            //把内容盒子放到弹窗盒子里\r\n            $(Box).append(groupBox, filterVip, settingJsonWrap);\r\n            return Box.outerHTML;\r\n        };\r\n\r\n        //删除父元素\r\n        var removeParentEle = function (obj) {\r\n            obj.parent().remove();\r\n        };\r\n\r\n        //创建新规则\r\n        var createRule = function () {\r\n            var filterRule = createFilter();\r\n            //预览count\r\n            var settingJsonWrap = $(filterRule).appendTo($(\".ruleWrap\"));\r\n            var cWrap = settingJsonWrap.find(\".conditionWrap\");\r\n            if (element) {\r\n                var $iCon = settingJsonWrap.find(\".indivCon\");\r\n                if (element.getName() == \"img\") {\r\n                    $iCon.find(\".indivTxt\").hide();\r\n                    $iCon.find(\".indivUrl\").show();\r\n                    $iCon.find(\".indivUrl\").find(\".txtImg\").bind(\"change\", function () {\r\n                        var urlVal = $iCon.find(\".indivUrl\").find(\".txtImg\").val();\r\n                        $iCon.find(\".previewImg\").attr(\"src\", urlVal);\r\n                    });\r\n                } else {\r\n                    $iCon.find(\".indivUrl\").hide();\r\n                    $iCon.find(\".indivTxt\").show();\r\n                }\r\n            }\r\n\r\n            //删除条件\r\n            $(\".delConditon\", settingJsonWrap).unbind().bind(\"click\", function () {\r\n                removeParentEle($(this));\r\n\r\n                var delCon = $(\".delConditon\", settingJsonWrap);\r\n                if (delCon.length == 1) {\r\n                    delCon.hide();\r\n                }\r\n            });\r\n\r\n            //添加条件\r\n            settingJsonWrap.find(\".addConditon\").unbind().bind(\"click\", function () {\r\n\r\n                var conWrap = $(createConditon()).appendTo(cWrap);\r\n                var $delBut = conWrap.find(\".delConditon\");\r\n\r\n                //联动添加options\r\n                appendOption();\r\n\r\n                //删除条件\r\n                $delBut.unbind().bind(\"click\", function () {\r\n                    removeParentEle($(this));\r\n                    var delCon = $(\".delConditon\", settingJsonWrap);\r\n\r\n                    if (delCon.length == 1) {\r\n                        delCon.hide();\r\n                    } else {\r\n                        delCon.show();\r\n                    }\r\n                });\r\n\r\n                $(\".delConditon\", settingJsonWrap).show();\r\n            });\r\n\r\n            //删除规则\r\n            settingJsonWrap.find(\".DelRule\").unbind().bind(\"click\", function () {\r\n                var that = $(this);\r\n                //删除规则接口\r\n                var key = settingJsonWrap.attr(\"id\");\r\n                if (key) {\r\n                    PERSONALIZE.delIndividuationSettingNode({\"id\": key}, function () {\r\n                        removeParentEle(that);\r\n                        //判断调用添加接口还是更新接口\r\n                        judgePort();\r\n                    });\r\n                } else {\r\n                    removeParentEle(that);\r\n                }\r\n            });\r\n\r\n            //保存条件\r\n            settingJsonWrap.find(\".saveCondition\").off().on(\"click\", function () {\r\n\r\n                //获取nodeValue\r\n                var getNodeValue = function () {\r\n                    var nodeValue = {};\r\n                    if (element.getName() == \"img\") {\r\n                        nodeValue['src'] = settingJsonWrap.find(\".indivUrl\").find(\".txtImg\").val();\r\n                        nodeValue['href'] = settingJsonWrap.find(\".indivUrl\").find(\".jumpHref\").val();\r\n                    } else {\r\n                        nodeValue[\"text\"] = settingJsonWrap.find(\".indivTxt\").find(\".txtImg\").val();\r\n                        nodeValue[\"href\"] = settingJsonWrap.find(\".indivTxt\").find(\".jumpHref\").val();\r\n                    }\r\n                    if (nodeValue[\"href\"]) {\r\n                        if (!localStorage[\"addLink\"]) {\r\n                            localStorage[\"addLink\"] = nodeValue[\"href\"];\r\n                        }\r\n                        addATag();\r\n                    } else {\r\n                        delATag();\r\n                    }\r\n                    return JSON.stringify(nodeValue);\r\n                };\r\n\r\n                if ($(\".filterType\", settingJsonWrap).val() && $(\".vipType\", settingJsonWrap).val()) {\r\n                    //规则的id\r\n                    var ruleBoxId = settingJsonWrap.attr(\"id\");\r\n                    if (ruleBoxId) {\r\n                        //调用更新接口\r\n                        var formData = XREWIN.FormData({\r\n                            \"key\": ruleBoxId,\r\n                            \"filterData\": getConditionCon(settingJsonWrap),\r\n                            \"nodeValue\": getNodeValue()\r\n                        });\r\n\r\n                        PERSONALIZE.updateIndividuationSettingNode(formData, function () {\r\n                            settingJsonWrap.find(\".matchCount\").text(this.data.count);\r\n                            //判断调用添加接口还是更新接口\r\n                            judgePort();\r\n                        });\r\n                    } else {\r\n                        //调用添加条件\r\n                        var formData = XREWIN.FormData({\r\n                            \"filterData\": getConditionCon(settingJsonWrap),\r\n                            \"individuationSettingKey\": _settingSpan.getAttribute('data-nav'),\r\n                            \"nodeValue\": getNodeValue()\r\n                        });\r\n\r\n                        PERSONALIZE.addIndividuationSettingNode(formData, function () {\r\n                            var msg = this.data;\r\n                            if (msg.count) {\r\n                                settingJsonWrap.find(\".matchCount\").text(msg.count);\r\n                            }\r\n                            settingJsonWrap.attr(\"id\", msg.key);\r\n                            //判断调用添加接口还是更新接口\r\n                            judgePort();\r\n                        });\r\n                    }\r\n                } else {\r\n                    swal(\"请选择条件\", \"\", \"warning\");\r\n                }\r\n\r\n            });\r\n\r\n            return filterRule;\r\n        };\r\n        //endregion\r\n\r\n        //region 获取并加载数据内容\r\n\r\n        //加载个性化\r\n        var loadIndividuation = function (obj) {\r\n            //加载个性化数据\r\n            var indivData = obj;\r\n            if (indivData) {\r\n                var nonNodeVal;\r\n                var hasJump = false;\r\n                var isImg = (indivData[\"settingType\"] == \"img\");\r\n                $(\".filterVipCount\").text(indivData.nonCount);\r\n                var nonNodeValData = JSON.parse(indivData['nonNodeValue']);\r\n                if (typeof  nonNodeValData == \"string\") {\r\n                    nonNodeVal = nonNodeValData;\r\n                } else {\r\n                    hasJump = true;\r\n                    var personalityJson = nonNodeValData;\r\n                    if (isImg) {\r\n                        nonNodeVal = personalityJson.src;\r\n                    } else {\r\n                        nonNodeVal = personalityJson.text;\r\n                    }\r\n                    $(\".nonJumpHref\").val(personalityJson[\"href\"]);\r\n                    $(\".extendPersonality\").show();\r\n                    addATag();\r\n                }\r\n                var personalityContent = $(\"#spanText\").val(nonNodeVal);\r\n                if (isImg) {\r\n                    $(\"#addsettingJson\").after('<div style=\"text-align: center;margin-top: 8px;color: #ed5565;\">\"+TxtContent.ckeitor.condition+\" </div>');\r\n                    personalityContent.after('<button id=\"checkImg\" data-container=\"body\" ' +\r\n                        'data-toggle=\"popover\" data-placement=\"bottom\" ' +\r\n                        'data-content=\"<img src=' + nonNodeVal + '>\" style=\"margin-left:5px;' +\r\n                        'color: #23C6C8;\">\"+TxtContent.check+\"</button>');\r\n                }\r\n\r\n                var nRData = JSON.parse(indivData.settingJson);\r\n                for (var k = 0; k < nRData.length; k++) {\r\n                    var settingJsonCon = $(createRule());\r\n                    var jumpHref = null;\r\n                    settingJsonCon.attr(\"id\", nRData[k].id);\r\n                    var conBox = settingJsonCon.find(\".conditionWrap\");\r\n                    conBox.empty();\r\n                    settingJsonCon.find(\".matchVipCount\").text(nRData[k].matchVipCount);\r\n                    if (isImg) {\r\n                        var $url = settingJsonCon.find(\".indivUrl\");\r\n                        $url.find(\".previewImg\").attr(\"src\", nRData[k].con);\r\n                        $url.find(\".txtImg\").val(nRData[k].con);\r\n                        jumpHref = $url.find(\".jumpHref\");\r\n                    } else {\r\n                        var $txt = settingJsonCon.find(\".indivTxt\");\r\n                        $txt.find(\".txtImg\").val(nRData[k].con);\r\n                        jumpHref = $txt.find(\".jumpHref\");\r\n                    }\r\n                    if (hasJump) {\r\n                        jumpHref.val(nRData[k].href);\r\n                    }\r\n\r\n                    //加载不同类型条件体\r\n                    individuationCondition.loadCondition(nRData[k], conBox);\r\n                    //绑定删除条件\r\n                    var conditionBox = settingJsonCon.find(\".conditionWrap\");\r\n                    conditionBox.find(\".delConditon\").each(function () {\r\n                        var that = $(this);\r\n                        that.on(\"click\", function () {\r\n                            removeParentEle(that);\r\n                            var delCon = conditionBox.find(\".delConditon\");\r\n                            if (delCon.length == 1) {\r\n                                delCon.hide();\r\n                            } else {\r\n                                delCon.show();\r\n                            }\r\n                        });\r\n                    });\r\n\r\n                    if (conditionBox.find(\".delConditon\").length == 1) {\r\n                        $(\".delConditon\", conditionBox).hide();\r\n                    }\r\n                }\r\n\r\n                var $checkImg = $(\"#checkImg\");\r\n                $checkImg.popover({html: true, trigger: 'click'});\r\n                $checkImg.on(\"show.bs.popover\", function () {\r\n                    var that = $(this);\r\n                    that.data(\"bs.popover\").tip().css({\"position\": \"absolute\", \"z-index\": 99999});\r\n                    setTimeout(function () {\r\n                        that.click();\r\n                    }, 2000)\r\n                });\r\n\r\n                if (hasJump) {\r\n                    $(\".extendPersonality\").show();\r\n                }\r\n                else {\r\n                    $(\".extendPersonality\").hide();\r\n                }\r\n            }\r\n        };\r\n        //endregion\r\n\r\n        //region 更新数据\r\n\r\n        //更新数据\r\n        var updateSetting = function (individuationData, settingSpan) {\r\n            var id = settingSpan.getAttribute(\"data-nav\");\r\n            if (id) {\r\n                var formData = XREWIN.FormData({\r\n                    \"settingType\": individuationData.settingType,\r\n                    \"settingJson\": JSON.stringify(individuationData.settingJson),\r\n                    \"nonCount\": individuationData.nonCount,\r\n                    \"key\": id,\r\n                    \"nonNodeValue\": individuationData.nonNodeValue,\r\n                    \"groupKey\": getGroupKey()\r\n                });\r\n                //更新接口\r\n                PERSONALIZE.updateIndividuationSetting(formData);\r\n            }\r\n        };\r\n        //endregion\r\n\r\n        //设置spanId\r\n        var setSpanId = function (msg, settingSpan) {\r\n            settingSpan.setAttribute(\"data-nav\", msg);\r\n        };\r\n\r\n        //region 添加数据\r\n\r\n        //添加\r\n        var addSettings = function (individuationData, settingSpan) {\r\n            var fd = XREWIN.FormData({\r\n                \"templateKey\": XREWIN.getUrlParam(\"key\"),\r\n                \"templateType\": \"email\",\r\n                \"settingType\": individuationData.settingType,\r\n                \"settingJson\": JSON.stringify(individuationData.settingJson),\r\n                \"nonCount\": individuationData.nonCount,\r\n                \"nonNodeValue\": individuationData.nonNodeValue\r\n            });\r\n\r\n            //添加\r\n            PERSONALIZE.addIndividuationSetting(fd, function () {\r\n                setSpanId(this.data, settingSpan);\r\n            });\r\n        };\r\n        //endregion\r\n\r\n        var _settingSpan = null;\r\n\r\n        return {\r\n            //region 弹窗布局\r\n            title: TxtContent.ckeitor.title,\r\n            resizable: CKEDITOR.DIALOG_RESIZE_BOTH,\r\n            minWidth: 650,\r\n            minHeight: 600,\r\n            //自定义按钮\r\n            buttons: [{\r\n                type: 'button',\r\n                id: 'saveStrategy',\r\n                label: TxtContent.saveStrategy,\r\n                style: 'border-color: #62a60a #62a60a #4d9200;position:absolute;left:-285%;',\r\n                onClick: function () {\r\n                    new FormModal({\r\n                        \"id\": \"saveStrategy\",\r\n                        \"title\": TxtContent.strategyCon,\r\n                        \"elements\": [{\r\n                            \"require\": true,\r\n                            \"labelName\": TxtContent.strategyName,\r\n                            \"type\": \"text\",\r\n                            \"name\": \"individuationTacticsName\"\r\n                        }],\r\n                        \"submitBindFunc\": function () {\r\n                            var tacticsData = XREWIN.FormData({\r\n                                \"templateType\": \"email\",\r\n                                \"tacticsType\": element.getName() == \"img\" ? \"img\" : \"string\",\r\n                                \"nonNodeValue\": createIndividuationData().nonNodeValue,\r\n                                \"tacticsJson\": JSON.stringify(createIndividuationData().settingJson)\r\n                            }, \"form_saveStrategy\");\r\n                            PERSONALIZE.addIndividuationTactics(tacticsData);\r\n                        },\r\n                        \"clear\": true,\r\n                        \"submitBtn\": TxtContent.confirm,\r\n                        \"cancelBtn\": TxtContent.close\r\n                    }).show();\r\n                }\r\n            },\r\n                CKEDITOR.dialog.okButton,\r\n                CKEDITOR.dialog.cancelButton,\r\n                {\r\n                    type: 'button',\r\n                    id: 'saveRule',\r\n                    label: TxtContent.refresh,\r\n                    style: 'border-color: #62a60a #62a60a #4d9200;',\r\n                    onClick: function () {\r\n                        //刷新前保存所有节点\r\n                        var ruleNode = $(\".settingJson\");\r\n                        ruleNode.each(function () {\r\n                            var that = $(this);\r\n                            var curNodeId = that.attr(\"id\");\r\n                            if (!curNodeId) {\r\n                                that.find(\".saveCondition\").trigger(\"click\");\r\n                            }\r\n                        });\r\n\r\n                        //只有所有节点全被保存才执行刷新\r\n                        var refreshNode = function () {\r\n                            for (var i = 0; i < ruleNode.length; i++) {\r\n                                var nodeId = $(ruleNode[i]).attr(\"id\");\r\n                                if (!nodeId) {\r\n                                    return false;\r\n                                }\r\n                            }\r\n\r\n                            PERSONALIZE.refresh({\r\n                                \"individuationSettingKey\": _settingSpan.getAttribute(\"data-nav\"),\r\n                                \"groupKey\": getGroupKey()\r\n                            }, function () {\r\n                                var obj = this.data;\r\n                                $(\".filterVipCount\").text(obj.total);\r\n                                $(\".settingJson\").each(function () {\r\n                                    var that = $(this);\r\n                                    var ruleId = that.attr(\"id\");\r\n                                    that.find(\".matchCount\").text(obj[ruleId]);\r\n                                });\r\n                                //判断调用添加接口还是更新接口\r\n                                judgePort();\r\n                            });\r\n                        };\r\n                        //节点保存成功后刷新\r\n                        setTimeout(refreshNode(), 3000);\r\n                    }\r\n                }\r\n            ],\r\n            //内容区域\r\n            contents: [{\r\n                id: 'condition',\r\n                label: '',\r\n                title: '',\r\n                elements: [{\r\n                    type: 'html',\r\n                    html: '<div id=' + divId + '></div>'\r\n                }]\r\n            }],\r\n            //endregion\r\n\r\n            //region 窗口显示时事件\r\n            onShow: function () {\r\n                var ele = this.getElement().getDocument().getById(divId);\r\n                ele.setHtml(\"\");\r\n                ele.getParent().setHtml(createEle());\r\n                //删除第一个条件\r\n                $(\".settingJson\").remove();\r\n                var selection = editor.getSelection();\r\n                var selTxt = selection.getSelectedText();\r\n\r\n                element = selection.getStartElement();\r\n\r\n                if (!$(element.getParent().$).data(\"nav\") && !$(element.$).data(\"nav\") && !element.hasClass(\"editorImg\")) {\r\n                    //标出编辑内容\r\n                    var tempId = \"temp_\" + (new Date()).getTime();\r\n                    var creSpan = editor.document.createElement('nav');\r\n                    creSpan.addClass(\"specific\");\r\n                    creSpan.addClass(\"marker\");\r\n                    creSpan.setAttribute(\"id\", tempId);\r\n\r\n                    if (selTxt && element) {\r\n                        if (element.getName() == 'td'\r\n                            || element.getName() == 'p'\r\n                            || element.getName() == 'span'\r\n                            || element.getName() == 'strong'\r\n                            || element.getName() == 'h3'\r\n                            || element.getName() == 'li'\r\n                            || element.getName() == 'div') {\r\n                            creSpan.setText(selTxt);\r\n                            var _span = element.getOuterHtml().replace(selTxt, creSpan.getOuterHtml());\r\n                            element.setHtml(_span);\r\n                        }\r\n                        if (element.hasClass(\"specific\")) {\r\n                            creSpan.setText(selTxt);\r\n                            test = element.getParent().getOuterHtml().replace(selTxt, creSpan.getOuterHtml());\r\n                            element.getParent().setHtml(test);\r\n                        }\r\n                        $(\"#spanText\").val(selTxt);\r\n                        $(\".nonJumpHref\").val($(element.$).attr(\"href\"));\r\n                    }\r\n\r\n                    if (element) {\r\n                        if (element.getName() == 'img') {\r\n                            $(\".nonJumpHref\").val($(element.$).parent(\"a\").attr(\"href\"));\r\n                            if (!element.getParent().hasClass(\"specific\")) {\r\n                                var fTd = element.getParent();\r\n                                element.addClass(\"editorImg\");\r\n                                creSpan.setStyle('display', 'block');\r\n                                var childEle = element.appendTo(creSpan);\r\n                                var test = element.getOuterHtml();\r\n                                var repEle = test.replace(test, childEle.getOuterHtml());\r\n                                //解决点击确定bug\r\n                                $(fTd.$).append(repEle);\r\n                            }\r\n                            var $spanVal = $(\"#spanText\");\r\n                            var srcVal = element.getAttribute(\"src\");\r\n\r\n                            $spanVal.val(srcVal).after('<button id=\"checkImg\" data-container=\"body\" ' +\r\n                                'data-toggle=\"popover\" data-placement=\"bottom\" ' +\r\n                                'data-content=\"<img src=' + srcVal + '>\" style=\"margin-left:5px;' +\r\n                                'color: #23C6C8;\">' + TxtContent.check + '</button>');\r\n                            $(\"#addsettingJson\").after('<div style=\"text-align: center;margin-top: 8px;color: #ed5565;\">' + TxtContent.ckeitor.condition + '</div>');\r\n\r\n                        } else {\r\n                            if (!selTxt) {\r\n                                selTxt = element.getText();\r\n                                creSpan.setText(selTxt);\r\n                                test = element.getParent().getOuterHtml().replace(selTxt, creSpan.getOuterHtml());\r\n                                element.getParent().setHtml(test);\r\n                            } else if (selTxt && element.getName() == 'a') {\r\n                                creSpan.setText(selTxt);\r\n                                test = element.getParent().getOuterHtml().replace(selTxt, creSpan.getOuterHtml());\r\n                                element.getParent().setHtml(test);\r\n                            }\r\n                        }\r\n                        _settingSpan = editor.document.getById(tempId);\r\n                        if (_settingSpan) {\r\n                            _settingSpan.removeAttribute(\"id\");\r\n                        }\r\n\r\n                        judgePort();\r\n                    }\r\n                } else {\r\n                    var span = element;\r\n                    if (element.getName() == \"img\") {\r\n                        span = span.getParent();\r\n                    }\r\n                    if (span.getName() == \"a\") {\r\n                        span = span.getParent();\r\n                    }\r\n                    var kId = span.getAttribute(\"data-nav\");\r\n                    _settingSpan = span;\r\n\r\n                    if (kId && kId.indexOf('temp_') == -1) {\r\n                        //加载数据\r\n                        var data = PERSONALIZE.getIndividuationSetting({\"data\": kId});\r\n                        urlGroupKey = data.groupKey;\r\n                        loadIndividuation(data);\r\n                    }\r\n                }\r\n\r\n                var $checkImg = $(\"#checkImg\");\r\n                $checkImg.popover({html: true, trigger: 'click'});\r\n                $checkImg.on(\"show.bs.popover\", function () {\r\n                    var that = $(this);\r\n                    that.data(\"bs.popover\").tip().css({\"position\": \"absolute\", \"z-index\": 99999});\r\n                    setTimeout(function () {\r\n                        that.click();\r\n                    }, 2000)\r\n                });\r\n\r\n                //扩展链接\r\n                $(\"#extendHref\").on(\"click\", function () {\r\n                    var $extendPersonality = $(\".extendPersonality\").show();\r\n                    if ($extendPersonality.is(\":visible\")) {\r\n                        addATag();\r\n                    } else {\r\n                        delATag();\r\n                    }\r\n                }).trigger(\"click\");\r\n\r\n                //添加新规则\r\n                $(\"#addsettingJson\").unbind().bind(\"click\", function () {\r\n                    var state = $(\".extendPersonality\").css(\"display\");\r\n                    var rule = $(createRule());\r\n                    var currentExtend = rule.find(\".extendPersonality\");\r\n                    if (state == \"none\") {\r\n                        currentExtend.css(\"display\", \"none\");\r\n                    } else {\r\n                        currentExtend.css(\"display\", \"block\");\r\n                    }\r\n                    appendOption();\r\n\r\n                    $(\".delConditon\", rule).hide();\r\n                });\r\n\r\n                //离开页面时执行\r\n                $(window).on(\"beforeunload\", function () {\r\n                    return TxtContent.skipPrompt;\r\n                });\r\n\r\n                //region 加载会员分组\r\n                //添加option\r\n                var addMemberOption = function (obj) {\r\n                    var member = $(\"#vipGroup\");\r\n                    //添加options\r\n                    XREWIN.addOptions(obj, \"key\", \"name\", member, \"count\");\r\n                    member.on(\"change\", function () {\r\n                        var that = $(this);\r\n                        var count = that.find(\"option:selected\").attr(\"extend\");\r\n                        $(\".filterVipCount\").text(count == \"-1\" ? 0 : count);\r\n                    });\r\n\r\n                };\r\n                //执行加载会员分组\r\n                if (urlGroupKey || localStorage[\"group_key\"]) {\r\n                    SMARTGROUP.listGroup(function () {\r\n                        var obj = this.data;\r\n                        var member = $(\"#vipGroup\");\r\n                        //添加options\r\n                        XREWIN.addOptions(obj, \"key\", \"name\", member, \"count\");\r\n                        member.find(\"option\").each(function () {\r\n                            var that = $(this);\r\n                            var opVal = that.attr(\"value\");\r\n                            if (opVal == (urlGroupKey || localStorage[\"group_key\"])) {\r\n                                that.attr(\"selected\", \"selected\");\r\n                                $(\".filterVipCount\").text(that.attr(\"extend\"));\r\n                            }\r\n                        });\r\n                        urlGroupKey = '';\r\n                    });\r\n                } else {\r\n                    SMARTGROUP.listGroup(function () {\r\n                        addMemberOption(this.data);\r\n                    });\r\n                }\r\n\r\n                //endregion\r\n            },\r\n            //endregion\r\n            onOk: function () {\r\n                judgePort();\r\n                //刷新前保存所有节点\r\n                var ruleNode = $(\".settingJson\");\r\n                ruleNode.each(function () {\r\n                    var that = $(this);\r\n                    var curNodeId = that.attr(\"id\");\r\n                    if (!curNodeId) {\r\n                        that.find(\".saveCondition\").trigger(\"click\");\r\n                    }\r\n                });\r\n                if (!$(\".nonJumpHref\").val() && !localStorage[\"addLink\"]) {\r\n                    delATag();\r\n                    localStorage[\"addLink\"] = '';\r\n                }\r\n            }\r\n        };\r\n    });\r\n})();"]}